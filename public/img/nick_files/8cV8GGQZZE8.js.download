if (self.CavalryLogger) { CavalryLogger.start_js(["7g7Y2"]); }

__d("IrisProtocolMessageLifetime",[],(function a(b,c,d,e,f,g){f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};}),null);
__d("MessageLiveLocationClientSyncProtocolStopReason",[],(function a(b,c,d,e,f,g){f.exports={EXPIRED:1,CANCELED:2,ARRIVED:3};}),null);
__d('DockTabsViewportFantaTabUtils',[],(function a(b,c,d,e,f,g){'use strict';var h=269;function i(){return h+1;}function j(m){return Math.floor(m/h);}function k(m){if(!m)return null;var n=m.fantaTabModelStateGetter;return n?n():null;}function l(m){return m?m.size:0;}f.exports={getTabCountToFitWidth:j,getMinRequiredWidthForFirstFantaTab:i,getFantaTabModelFromCallbacks:k,getNumFantaTabsFromModel:l};}),null);
__d('DockTabsViewportPinnedConversationTabUtils',[],(function a(b,c,d,e,f,g){'use strict';var h=496+9+2,i=210+9+2,j=52;function k(){return h;}function l(){return i;}function m(){return j;}function n(r){return r.getIsRaised()?k():l();}function o(){return k()+j;}function p(r){var s=r||{},t=s.pinnedConvoTabStateGetter;return t?t():null;}function q(r){return r?r.getTotalTabCount():0;}f.exports={getRaisedPinnedConvoTabWidth:k,getLoweredPinnedConvoTabWidth:l,getPinnedConvoSelectorWidth:m,getPinnedConvoTabWidth:n,getMinRequiredWidthForFirstConvoTab:o,getPinnedConvoTabsStateFromCallbacks:p,getNumPinnedConvoTabsFromModel:q};}),null);
__d('DockTabsViewportCalculator',['csx','Arbiter','DataStore','Dock','DockTabsViewportFantaTabUtils','DockTabsViewportPinnedConversationTabUtils','DOM','Event','FullScreen','PinnedConversationNubsConfig','SubscriptionsHandler','Vector','ViewportBounds','ge','getViewportDimensions','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=50,j=35,k=j,l='dock-tab-viewport-inst',m=c('DockTabsViewportFantaTabUtils').getMinRequiredWidthForFirstFantaTab,n=c('DockTabsViewportFantaTabUtils').getFantaTabModelFromCallbacks,o=c('DockTabsViewportFantaTabUtils').getNumFantaTabsFromModel,p=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab,q=c('DockTabsViewportPinnedConversationTabUtils').getNumPinnedConvoTabsFromModel,r=c('DockTabsViewportPinnedConversationTabUtils').getPinnedConvoTabsStateFromCallbacks;function s(u){return u?c('Vector').getElementDimensions(u).x:0;}function t(u){this.$DockTabsViewportCalculatorImpl1=u;this.$DockTabsViewportCalculatorImpl3=0;this.$DockTabsViewportCalculatorImpl4=0;this.$DockTabsViewportCalculatorImpl5=null;this.$DockTabsViewportCalculatorImpl6=null;this.$DockTabsViewportCalculatorImpl7=false;this.$DockTabsViewportCalculatorImpl8=false;this.$DockTabsViewportCalculatorImpl9=false;this.$DockTabsViewportCalculatorImpl2=new (c('SubscriptionsHandler'))();this.$DockTabsViewportCalculatorImpl10();this.$DockTabsViewportCalculatorImpl11();}t.prototype.$DockTabsViewportCalculatorImpl10=function(){var u=this.$DockTabsViewportCalculatorImpl12.bind(this);this.$DockTabsViewportCalculatorImpl2.addSubscriptions(c('Event').listen(window,'resize',u),c('Dock').subscribe('resize',u),c('Arbiter').subscribeOnce('sidebar/initialized',u,c('Arbiter').SUBSCRIBE_NEW),c('FullScreen').subscribe('changed',function(){if(c('FullScreen').isFullScreen()){this.$DockTabsViewportCalculatorImpl7=true;this.$DockTabsViewportCalculatorImpl8=false;}else{this.$DockTabsViewportCalculatorImpl7=false;if(this.$DockTabsViewportCalculatorImpl8){c('setImmediate')(function(){u();});this.$DockTabsViewportCalculatorImpl8=false;}}}.bind(this)));};t.prototype.registerFantaTabCallbacks=function(u){this.$DockTabsViewportCalculatorImpl5=u;};t.prototype.registerPinnedConvoTabCallbacks=function(u){this.$DockTabsViewportCalculatorImpl6=u;};t.prototype.forceRecalculateFBDockWidth=function(){this.$DockTabsViewportCalculatorImpl11();this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:false,pinnedConvoUpdateData:null});};t.prototype.forceRecalculateChatTabs=function(){this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:true,pinnedConvoUpdateData:null});};t.prototype.forceRecalculatePinnedConvoTabs=function(u){this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:true,pinnedConvoUpdateData:u});};t.prototype.$DockTabsViewportCalculatorImpl12=function(){if(c('FullScreen').isFullScreen()||this.$DockTabsViewportCalculatorImpl7){this.$DockTabsViewportCalculatorImpl8=true;return;}this.forceRecalculateFBDockWidth();};t.prototype.$DockTabsViewportCalculatorImpl13=function(u){var v=u.forceRecalculateChatTabs,w=u.pinnedConvoUpdateData,x=this.$DockTabsViewportCalculatorImpl14(),y=x.chatTabAvailableWidth,z=x.pinnedConvoTabAvailableWidth;this.$DockTabsViewportCalculatorImpl15(y,!!v);this.$DockTabsViewportCalculatorImpl16(z,w);};t.prototype.$DockTabsViewportCalculatorImpl16=function(u,v){var w=this.$DockTabsViewportCalculatorImpl6||{},x=w.onAvailableWidthChanged;x&&x(u,v);};t.prototype.$DockTabsViewportCalculatorImpl15=function(u,v){var w=this.$DockTabsViewportCalculatorImpl5||{},x=w.onAvailableWidthChanged;x&&x(u);};t.prototype.$DockTabsViewportCalculatorImpl17=function(){var u=n(this.$DockTabsViewportCalculatorImpl5);return o(u);};t.prototype.$DockTabsViewportCalculatorImpl18=function(){return m();};t.prototype.$DockTabsViewportCalculatorImpl14=function(){var u=this.$DockTabsViewportCalculatorImpl3,v={chatTabAvailableWidth:u,pinnedConvoTabAvailableWidth:0},w={chatTabAvailableWidth:0,pinnedConvoTabAvailableWidth:u},x=this.$DockTabsViewportCalculatorImpl17(),y=r(this.$DockTabsViewportCalculatorImpl6),z=q(y);if(!y||z===0){return v;}else if(x===0)return w;var aa=this.$DockTabsViewportCalculatorImpl18();if(u<=aa)return v;var ba=p(),ca=u-aa,da=0;if(ca<ba){if(c('PinnedConversationNubsConfig').chatTabTypingPriority&&y&&(y.anyTabHasText()||y.anyTabHasFocus())){return w;}else return v;}else da=ba;var ea=da,fa=Math.max(aa,u-da);return {chatTabAvailableWidth:fa,pinnedConvoTabAvailableWidth:ea};};t.prototype.$DockTabsViewportCalculatorImpl11=function(){this.$DockTabsViewportCalculatorImpl3=this.$DockTabsViewportCalculatorImpl19();this.$DockTabsViewportCalculatorImpl20('DockTabsViewportCalculator/recalcTotalDock_FOR_TEST_ONLY');};t.prototype.$DockTabsViewportCalculatorImpl21=function(){var u=this.$DockTabsViewportCalculatorImpl1;if(!u)return {buddyListNubWidth:0,employeeNubsWidth:0};var v=s(u),w=s(c('DOM').find(u,"._56ox")),x=s(c('DOM').scry(u,"._56oy")[0]),y=s(c('DOM').scry(u,"._ph1")[0]),z=Math.max(v-w-x-y,0);return {buddyListNubWidth:w,employeeNubsWidth:z};};t.prototype.$DockTabsViewportCalculatorImpl19=function(){var u=c('getViewportDimensions').withoutScrollbars().width;u-=c('ViewportBounds').getLeft()+c('ViewportBounds').getRight();u-=i;var v=this.$DockTabsViewportCalculatorImpl21(),w=v.buddyListNubWidth,x=v.employeeNubsWidth;u-=w;this.$DockTabsViewportCalculatorImpl4=Math.max(this.$DockTabsViewportCalculatorImpl4,x);u-=this.$DockTabsViewportCalculatorImpl4;u-=k;return Math.max(u,0);};t.prototype.enableTestInforms_FOR_TEST_ONLY=function(){this.$DockTabsViewportCalculatorImpl9=true;};t.prototype.$DockTabsViewportCalculatorImpl20=function(u){if(this.$DockTabsViewportCalculatorImpl9)c('Arbiter').inform(u);};t.prototype.getChatTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl14().chatTabAvailableWidth;};t.prototype.getPinnedConvoTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl14().pinnedConvoTabAvailableWidth;};t.prototype.getAvailableTotalWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl3;};f.exports={getInstance:function u(v){var w=c('ge')('pagelet_dock');if(!w||!c('DOM').contains(w,v))return null;var x=c('DataStore').get(w,l);if(x instanceof t)return x;var y=c('DOM').scry(w,'.fbDockWrapperRight .fbDock')[0];x=new t(y);c('DataStore').set(w,l,x);return x;}};}),null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,j);return this;};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this;};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this;};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this;};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this;};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h;}),null);
__d('OmniMEventTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$OmniMEventTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$OmniMEventTypedLogger1=babelHelpers['extends']({},this.$OmniMEventTypedLogger1,j);return this;};h.prototype.setActionID=function(j){this.$OmniMEventTypedLogger1.action_id=j;return this;};h.prototype.setActionSubTypeFromBlob=function(j){this.$OmniMEventTypedLogger1.action_sub_type_from_blob=j;return this;};h.prototype.setActionTypeFromBlob=function(j){this.$OmniMEventTypedLogger1.action_type_from_blob=j;return this;};h.prototype.setAgentName=function(j){this.$OmniMEventTypedLogger1.agent_name=j;return this;};h.prototype.setAppID=function(j){this.$OmniMEventTypedLogger1.appid=j;return this;};h.prototype.setAppversion=function(j){this.$OmniMEventTypedLogger1.appversion=j;return this;};h.prototype.setClientUserID=function(j){this.$OmniMEventTypedLogger1.client_userid=j;return this;};h.prototype.setClienttime=function(j){this.$OmniMEventTypedLogger1.clienttime=j;return this;};h.prototype.setConfidence=function(j){this.$OmniMEventTypedLogger1.confidence=j;return this;};h.prototype.setConfidenceRemapped=function(j){this.$OmniMEventTypedLogger1.confidence_remapped=j;return this;};h.prototype.setContextUserID=function(j){this.$OmniMEventTypedLogger1.context_user_id=j;return this;};h.prototype.setCuApp=function(j){this.$OmniMEventTypedLogger1.cu_app=j;return this;};h.prototype.setDetectedLanguage=function(j){this.$OmniMEventTypedLogger1.detected_language=j;return this;};h.prototype.setEventName=function(j){this.$OmniMEventTypedLogger1.event_name=j;return this;};h.prototype.setIntentID=function(j){this.$OmniMEventTypedLogger1.intent_id=j;return this;};h.prototype.setLiveLocationSuggestionsEnabled=function(j){this.$OmniMEventTypedLogger1.live_location_suggestions_enabled=j;return this;};h.prototype.setLocationSuggestionsEnabled=function(j){this.$OmniMEventTypedLogger1.location_suggestions_enabled=j;return this;};h.prototype.setMBarDisplayedOnThreadEnter=function(j){this.$OmniMEventTypedLogger1.m_bar_displayed_on_thread_enter=j;return this;};h.prototype.setMessageID=function(j){this.$OmniMEventTypedLogger1.message_id=j;return this;};h.prototype.setMessageLength=function(j){this.$OmniMEventTypedLogger1.message_length=j;return this;};h.prototype.setName=function(j){this.$OmniMEventTypedLogger1.name=j;return this;};h.prototype.setPersonalization=function(j){this.$OmniMEventTypedLogger1.personalization=j;return this;};h.prototype.setPigeonID=function(j){this.$OmniMEventTypedLogger1.pigeon_id=j;return this;};h.prototype.setPosition=function(j){this.$OmniMEventTypedLogger1.position=j;return this;};h.prototype.setRemovedLocationSuggestions=function(j){this.$OmniMEventTypedLogger1.removed_location_suggestions=j;return this;};h.prototype.setSerializedActions=function(j){this.$OmniMEventTypedLogger1.serialized_actions=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSource=function(j){this.$OmniMEventTypedLogger1.source=j;return this;};h.prototype.setSuggestionData=function(j){this.$OmniMEventTypedLogger1.suggestion_data=c('GeneratedLoggerUtils').serializeMap(j);return this;};h.prototype.setSuggestionIds=function(j){this.$OmniMEventTypedLogger1.suggestion_ids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSuggestionMode=function(j){this.$OmniMEventTypedLogger1.suggestion_mode=j;return this;};h.prototype.setSuggestionTitle=function(j){this.$OmniMEventTypedLogger1.suggestion_title=j;return this;};h.prototype.setSuggestionType=function(j){this.$OmniMEventTypedLogger1.suggestion_type=j;return this;};h.prototype.setThreadID=function(j){this.$OmniMEventTypedLogger1.thread_id=j;return this;};h.prototype.setTotalSuggestions=function(j){this.$OmniMEventTypedLogger1.total_suggestions=j;return this;};h.prototype.setVC=function(j){this.$OmniMEventTypedLogger1.vc=j;return this;};var i={action_id:true,action_sub_type_from_blob:true,action_type_from_blob:true,agent_name:true,appid:true,appversion:true,client_userid:true,clienttime:true,confidence:true,confidence_remapped:true,context_user_id:true,cu_app:true,detected_language:true,event_name:true,intent_id:true,live_location_suggestions_enabled:true,location_suggestions_enabled:true,m_bar_displayed_on_thread_enter:true,message_id:true,message_length:true,name:true,personalization:true,pigeon_id:true,position:true,removed_location_suggestions:true,serialized_actions:true,source:true,suggestion_data:true,suggestion_ids:true,suggestion_mode:true,suggestion_title:true,suggestion_type:true,thread_id:true,total_suggestions:true,vc:true};f.exports=h;}),null);
__d("XGroupsJoinChatController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groups\/join_chat\/",{link_hash:{type:"String"}});}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingBlockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/block_messages\/",{});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinThroughPrivateLinkController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_invite\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingUnblockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/unblock_messages\/",{});}),null);
__d("XNFXIgnoreMessagesActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/ignore_messages\/",{thread_fbid:{type:"Int",required:true},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','ReloadPage','URI','XGroupsJoinChatController','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupJoinThroughPrivateLinkController','XMessagingGroupSetApprovalController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController','XMessagingBlockMessagesController','XMessagingUnblockMessagesController','XNFXIgnoreMessagesActionController','ex'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.updateReactionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeReactionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{reactions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=c('MercuryIDs').getUserIDFromThreadID(n);if(o===null)throw new Error(c('ex')('Expected user ID to unblock messages for, got null'));var p=JSON.stringify({reportable_ent_token:o,initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:p})).send();};m.prototype.ignoreMessages=function(n){var o=c('XNFXIgnoreMessagesActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.blockOnMessengerDotCom=function(n){var o=c('XMessagingBlockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.unblockOnMessengerDotCom=function(n){var o=c('XMessagingUnblockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.joinThroughPrivateLink=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughPrivateLinkController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.chatJoinThroughHash=function(n){var o={link_hash:n},p=c('XGroupsJoinChatController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).setHandler(function(q){return c('ReloadPage').now();}).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerSharedMediaActions',['MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i='MessengerSharedMedia',j={Types:h,Namespace:i,currentLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.CURRENT_LOADED,namespace:i,data:l});},deletePhotos:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m});},loadCurrent:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m});},loadMorePrevious:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n});},loadMoreLatest:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n});},previousLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l});},latestLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.LATEST_LOADED,namespace:i,data:l});}};f.exports=j;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=u.thread_id&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=v==c('MercuryActionType').REACTION_UPDATE,z=v==c('MercuryActionType').LIVE_LOCATION_UPDATE,aa=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,ba=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa||ba;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x===c('MercuryActionType').LIVE_LOCATION_UPDATE){if(this.$MercuryMessages30(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages31(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages33(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages34(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages35(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages36(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages37(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages35(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);if(q.action_type!==c('MercuryActionType').REACTION_UPDATE&&q.action_type!==c('MercuryActionType').LIVE_LOCATION_UPDATE)p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages38(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages38=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages35(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));if(!s)delete v[t];this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.messageId,r=p.liveLocation,s=this.$MercuryMessages17(q);if(!s||!s.attachments||s.attachments.length!==1)return false;var t=s.attachments[0];if(!t||!t.share)return false;var u=t.share.target;if(!u||!u.live_location_id)return false;var v=babelHelpers['extends']({},t,{share:babelHelpers['extends']({},t.share,{target:babelHelpers['extends']({},r,{live_location_id:u.live_location_id})})});this.$MercuryMessages22(q,s,{attachments:[v]});return true;};l.prototype.$MercuryMessages31=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.meta_ranges)t.meta_ranges=p.meta_ranges;if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages34=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages39(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages33=function(p,q){var r=this.$MercuryMessages39(p,q);this.$MercuryMessages38(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages39=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages36=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages35=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages35(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.reduce(function(r,s){var t=this.$MercuryMessages17(s);if(t)r.push(t);return r;}.bind(this),[]);return q.reverse();};l.prototype.$MercuryMessages37=function(p,q){var r=q.filter(function(s){return m(this.$MercuryMessages17(s));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get(),k='source:messenger_growth:event_upcoming_bump';function l(m,n){c('MercuryAssert').isThreadID(m);j.getThreadMeta(m,function(o){i.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1],r=[];if(q.tags!==undefined)r=r.concat(q.tags);if(q.log_message_data&&(q.log_message_data.message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST||q.log_message_data.message_type==c('MessagingGenericAdminTextType').WORK_INVITE_CLAIMED)){n(h._("New contact added"));}else if(r.indexOf(k)!==-1){n(h._("You have an upcoming event."));}else if(q&&q.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(q.author,function(s){var t=s.short_name,u=o.custom_nickname;if(u){var v=c('MercuryIDs').getUserIDFromParticipantID(s.id);if(u[v])t=u[v];}if(o.name){n(h._("{senderName} messaged {groupName}",[h.param('senderName',t),h.param('groupName',o.name)]));}else if(c('MercuryIDs').isGroupChat(m)){n(h._("{name} messaged your group",[h.param('name',t)]));}else n(h._("{name} messaged you",[h.param('name',t)]));});}else n(h._("New message!"));});});}f.exports={renderDocumentTitle:l};}),null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryDispatcher','MercuryPayloadSource','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c('MercuryDispatcher').getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe('update-messages',this.$MercuryTimestampTracker4.bind(this));}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source===c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp;}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('ChatTitleBarBlinker',['ChatActivity','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c('PresenceState').doSync();}}var p={blink:function u(v,w){if(!k&&l<w)c('MercuryNotificationRenderer').renderDocumentTitle(v,function(x){if(!k)k=c('DocumentTitle').blink(x);});},stopBlinking:function u(){o();},blinkingElsewhere:function u(){m=true;}};function q(u){var v=c('PresenceState').verifyNumber(u.sb2);if(!v||v<=l)return null;return v;}function r(u){var v=u&&q(u);if(v){l=v;j.debug('load',l);n();m=false;}}function s(u){var v=q(u);if(!v){j.debug('store',l);u.sb2=l;m=false;}return u;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x);});c('ChatActivity').subscribe('activity',function(){return o();});var t=c('PresenceState').getInitial();if(t)l=q(t)||0;f.exports=p;}),null);
__d('bs_js_boolean',[],(function a(b,c,d,e,f,g){'use strict';function h(i){if(i){return true;}else return false;}g.to_js_boolean=h;}),null);
__d('bs_js_exn',['bs_caml_exceptions'],(function a(b,c,d,e,f,g){'use strict';var h=c('bs_caml_exceptions').create("Js_exn.Error");function i(q){if(c('bs_caml_exceptions').isCamlExceptionOrOpenVariant(q)){return q;}else return [h,q];}function j(q){throw new Error(q);}function k(q){throw new EvalError(q);}function l(q){throw new RangeError(q);}function m(q){throw new ReferenceError(q);}function n(q){throw new SyntaxError(q);}function o(q){throw new TypeError(q);}function p(q){throw new URIError(q);}g.$$Error=h;g.internalToOCamlException=i;g.raiseError=j;g.raiseEvalError=k;g.raiseRangeError=l;g.raiseReferenceError=m;g.raiseSyntaxError=n;g.raiseTypeError=o;g.raiseUriError=p;}),null);
__d('bs_array',['bs_curry','bs_js_exn','bs_caml_array','bs_caml_exceptions','bs_caml_builtin_exceptions'],(function a(b,c,d,e,f,g){'use strict';function h(da,ea){if(da){if(da<0){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Array.init"];}else{var fa=c('bs_caml_array').caml_make_vect(da,c('bs_curry')._1(ea,0));for(var ga=1,ha=da-1|0;ga<=ha;++ga)fa[ga]=c('bs_curry')._1(ea,ga);return fa;}}else return [];}function i(da,ea,fa){var ga=c('bs_caml_array').caml_make_vect(da,[]);for(var ha=0,ia=da-1|0;ha<=ia;++ha)ga[ha]=c('bs_caml_array').caml_make_vect(ea,fa);return ga;}function j(da){var ea=da.length;if(ea){return c('bs_caml_array').caml_array_sub(da,0,ea);}else return [];}function k(da,ea){var fa=da.length;if(fa){if(ea.length){return da.concat(ea);}else return c('bs_caml_array').caml_array_sub(da,0,fa);}else return j(ea);}function l(da,ea,fa){if(fa<0||ea>(da.length-fa|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Array.sub"];}else return c('bs_caml_array').caml_array_sub(da,ea,fa);}function m(da,ea,fa,ga){if(ea<0||fa<0||ea>(da.length-fa|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Array.fill"];}else{for(var ha=ea,ia=(ea+fa|0)-1|0;ha<=ia;++ha)da[ha]=ga;return 0;}}function n(da,ea,fa,ga,ha){if(ha<0||ea<0||ea>(da.length-ha|0)||ga<0||ga>(fa.length-ha|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Array.blit"];}else return c('bs_caml_array').caml_array_blit(da,ea,fa,ga,ha);}function o(da,ea){for(var fa=0,ga=ea.length-1|0;fa<=ga;++fa)c('bs_curry')._1(da,ea[fa]);return 0;}function p(da,ea){var fa=ea.length;if(fa){var ga=c('bs_caml_array').caml_make_vect(fa,c('bs_curry')._1(da,ea[0]));for(var ha=1,ia=fa-1|0;ha<=ia;++ha)ga[ha]=c('bs_curry')._1(da,ea[ha]);return ga;}else return [];}function q(da,ea){for(var fa=0,ga=ea.length-1|0;fa<=ga;++fa)c('bs_curry')._2(da,fa,ea[fa]);return 0;}function r(da,ea){var fa=ea.length;if(fa){var ga=c('bs_caml_array').caml_make_vect(fa,c('bs_curry')._2(da,0,ea[0]));for(var ha=1,ia=fa-1|0;ha<=ia;++ha)ga[ha]=c('bs_curry')._2(da,ha,ea[ha]);return ga;}else return [];}function s(da){var ea=da.length-1|0,fa=0;while(true){var ga=fa,ha=ea;if(ha<0){return ga;}else{fa=[da[ha],ga];ea=ha-1|0;continue;}}}function t(da,ea){while(true){var fa=ea,ga=da;if(fa){ea=fa[1];da=ga+1|0;continue;}else return ga;}}function u(da){if(da){var ea=c('bs_caml_array').caml_make_vect(t(0,da),da[0]),fa=1,ga=da[1];while(true){var ha=ga,ia=fa;if(ha){ea[ia]=ha[0];ga=ha[1];fa=ia+1|0;continue;}else return ea;}}else return [];}function v(da,ea,fa){var ga=ea;for(var ha=0,ia=fa.length-1|0;ha<=ia;++ha)ga=c('bs_curry')._2(da,ga,fa[ha]);return ga;}function w(da,ea,fa){var ga=fa;for(var ha=ea.length-1|0;ha>=0;--ha)ga=c('bs_curry')._2(da,ea[ha],ga);return ga;}var x=c('bs_caml_exceptions').create("Array.Bottom");function y(da,ea){var fa=function oa(pa,qa){var ra=((qa+qa|0)+qa|0)+1|0,sa=ra;if((ra+2|0)<pa){if(c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(ea,ra),c('bs_caml_array').caml_array_get(ea,ra+1|0))<0)sa=ra+1|0;if(c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(ea,sa),c('bs_caml_array').caml_array_get(ea,ra+2|0))<0)sa=ra+2|0;return sa;}else if((ra+1|0)<pa&&c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(ea,ra),c('bs_caml_array').caml_array_get(ea,ra+1|0))<0){return ra+1|0;}else if(ra<pa){return ra;}else throw [x,qa];},ga=function oa(pa,qa,ra){try{var sa=pa,ta=qa,ua=ra;while(true){var va=ta,wa=fa(sa,va);if(c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(ea,wa),ua)>0){c('bs_caml_array').caml_array_set(ea,va,c('bs_caml_array').caml_array_get(ea,wa));ta=wa;continue;}else return c('bs_caml_array').caml_array_set(ea,va,ua);}}catch(ya){var xa=c('bs_js_exn').internalToOCamlException(ya);if(xa[0]===x){return c('bs_caml_array').caml_array_set(ea,xa[1],ra);}else throw xa;}},ha=function oa(pa,qa){try{var ra=pa,sa=qa;while(true){var ta=sa,ua=fa(ra,ta);c('bs_caml_array').caml_array_set(ea,ta,c('bs_caml_array').caml_array_get(ea,ua));sa=ua;continue;}}catch(wa){var va=c('bs_js_exn').internalToOCamlException(wa);if(va[0]===x){return va[1];}else throw va;}},ia=function oa(pa,qa){while(true){var ra=pa,sa=(ra-1|0)/3|0;if(ra===sa)throw [c('bs_caml_builtin_exceptions').assert_failure,["array.ml",168,4]];if(c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(ea,sa),qa)<0){c('bs_caml_array').caml_array_set(ea,ra,c('bs_caml_array').caml_array_get(ea,sa));if(sa>0){pa=sa;continue;}else return c('bs_caml_array').caml_array_set(ea,0,qa);}else return c('bs_caml_array').caml_array_set(ea,ra,qa);}},ja=ea.length;for(var ka=((ja+1|0)/3|0)-1|0;ka>=0;--ka)ga(ja,ka,c('bs_caml_array').caml_array_get(ea,ka));for(var la=ja-1|0;la>=2;--la){var ma=c('bs_caml_array').caml_array_get(ea,la);c('bs_caml_array').caml_array_set(ea,la,c('bs_caml_array').caml_array_get(ea,0));ia(ha(la,0),ma);}if(ja>1){var na=c('bs_caml_array').caml_array_get(ea,1);c('bs_caml_array').caml_array_set(ea,1,c('bs_caml_array').caml_array_get(ea,0));return c('bs_caml_array').caml_array_set(ea,0,na);}else return 0;}function z(da,ea){var fa=function ma(na,oa,pa,qa,ra,sa,ta){var ua=na+oa|0,va=qa+ra|0,wa=na,xa=c('bs_caml_array').caml_array_get(ea,na),ya=qa,za=c('bs_caml_array').caml_array_get(pa,qa),ab=ta;while(true){var bb=ab,cb=za,db=ya,eb=xa,fb=wa;if(c('bs_curry')._2(da,eb,cb)<=0){c('bs_caml_array').caml_array_set(sa,bb,eb);var gb=fb+1|0;if(gb<ua){ab=bb+1|0;xa=c('bs_caml_array').caml_array_get(ea,gb);wa=gb;continue;}else return n(pa,db,sa,bb+1|0,va-db|0);}else{c('bs_caml_array').caml_array_set(sa,bb,cb);var hb=db+1|0;if(hb<va){ab=bb+1|0;za=c('bs_caml_array').caml_array_get(pa,hb);ya=hb;continue;}else return n(ea,fb,sa,bb+1|0,ua-fb|0);}}},ga=function ma(na,oa,pa,qa){for(var ra=0,sa=qa-1|0;ra<=sa;++ra){var ta=c('bs_caml_array').caml_array_get(ea,na+ra|0),ua=(pa+ra|0)-1|0;while(ua>=pa&&c('bs_curry')._2(da,c('bs_caml_array').caml_array_get(oa,ua),ta)>0){c('bs_caml_array').caml_array_set(oa,ua+1|0,c('bs_caml_array').caml_array_get(oa,ua));ua=ua-1|0;}c('bs_caml_array').caml_array_set(oa,ua+1|0,ta);}return 0;},ha=function ma(na,oa,pa,qa){if(qa<=5){return ga(na,oa,pa,qa);}else{var ra=qa/2|0,sa=qa-ra|0;ma(na+ra|0,oa,pa+ra|0,sa);ma(na,ea,na+sa|0,ra);return fa(na+sa|0,ra,oa,pa+ra|0,sa,oa,pa);}},ia=ea.length;if(ia<=5){return ga(0,ea,0,ia);}else{var ja=ia/2|0,ka=ia-ja|0,la=c('bs_caml_array').caml_make_vect(ka,c('bs_caml_array').caml_array_get(ea,0));ha(ja,la,0,ka);ha(0,ea,ka,ja);return fa(ka,ja,la,0,ka,ea,0);}}var aa=i,ba=c('bs_caml_array').caml_array_concat,ca=z;g.init=h;g.make_matrix=i;g.create_matrix=aa;g.append=k;g.concat=ba;g.sub=l;g.copy=j;g.fill=m;g.blit=n;g.to_list=s;g.of_list=u;g.iter=o;g.map=p;g.iteri=q;g.mapi=r;g.fold_left=v;g.fold_right=w;g.sort=y;g.stable_sort=z;g.fast_sort=ca;}),null);
__d('utilsRe',['bs_array','bs_curry','bs_js_boolean','bs_js_primitive','bs_caml_builtin_exceptions'],(function a(b,c,d,e,f,g){'use strict';function h(q){if(c('bs_js_primitive').is_nil_undef(q)){return 0;}else return +q;}function i(q,r){if(q){return q[0];}else return r;}function j(q){return +(c('bs_js_primitive').null_undefined_to_opt(q)!==0);}function k(q){if(q){return q[0];}else return 0;}function l(q){if(c('bs_js_primitive').is_nil_undef(q)){return 0;}else return [+q];}function m(q){if(q){return c('bs_js_boolean').to_js_boolean(q[0]);}else return undefined;}function n(q){if(q){return c('bs_js_boolean').to_js_boolean(q[0]);}else return false;}function o(q,r){var s=q,t=r,u=0;while(true){var v=u,w=t;if(w){var x=w[1],y=c('bs_curry')._1(s,w[0]);if(y){u=[y[0],v];t=x;continue;}else{t=x;continue;}}else return v;}}function p(q){return c('bs_array').map(function(r){if(r){return r[0];}else throw [c('bs_caml_builtin_exceptions').invalid_argument,"arrayCompact: sorry, something went wrong."];},q.filter(function(r){if(r){return 1;}else return 0;}));}g.isTruthy=h;g.$pipe$unknown=i;g.isDefined=j;g.isSomeTrue=k;g.nullUndefinedBooleanToOptionBool=l;g.optionBoolToNullUndefinedBoolean=m;g.optionBoolToBoolean=n;g.listFilterMap=o;g.arrayCompact=p;}),null);
__d('mercuryBlockedParticipantsRe',['Set','utilsRe','bs_caml_obj','bs_js_boolean','MercuryIDs','CurrentUser','bs_js_primitive','MercuryDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h={};function i(p,q){var r=h[p];if(r!==undefined){var s=q.participants.filter(function(t){return c('bs_caml_obj').caml_notequal(t,c('MercuryIDs').getParticipantIDFromUserID(p));});return s.filter(function(t){return +(+r.has(t)!==0);});}else return [];}function j(p,q){return c('bs_js_boolean').to_js_boolean(1- +q.is_canonical&&+(i(p,q).length>0));}function k(p,q){if(q.is_canonical){return [];}else return i(p,q);}function l(p,q){var r=h[p],s=+q.is_canonical;if(s!==0){if(r!==undefined){var t=q.participants.filter(function(u){return c('bs_caml_obj').caml_notequal(u,c('MercuryIDs').getParticipantIDFromUserID(p));});return c('bs_js_boolean').to_js_boolean(1- +t.every(function(u){return 1- +r.has(u);}));}else return false;}else return false;}function m(p){var q=h[p];if(q===undefined){h[p]=new (c('Set'))();var r=c('MercuryDispatcher').getForFBID(p);r.subscribe("update-blocked-users",function(s,t){var u=h[p],v=t.message_blocked_ids;if(!c('bs_js_primitive').is_nil_undef(v)){var w=new (c('Set'))(v);h[p]=w;}var x=c('utilsRe').$pipe$unknown(c('bs_js_primitive').null_undefined_to_opt(t.participants),[]);x.forEach(function(y){var z=c('utilsRe').nullUndefinedBooleanToOptionBool(y.is_messenger_blocked),aa=y.fbid;if(z){if(z[0]!==0){if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){u.add(c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){+u['delete'](c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else return 0;});return 0;});}return {findIntersection:function s(t){return i(p,t);},isPresentInGroupThread:function s(t){return j(p,t);},inGroupThread:function s(t){return k(p,t);},isMessageBlocked:function s(t){return l(p,t);},__fbid:p};}function n(){return m(c('CurrentUser').getID());}var o=c('utilsRe').$pipe$unknown;g.$pipe$unknown=o;g.blockedIdsPerFBID=h;g.findIntersection=i;g.isPresentInGroupThread=j;g.inGroupThread=k;g.isMessageBlocked=l;g.getForFBID=m;g.get=n;}),null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','Event','Map','mercuryBlockedParticipantsRe','MercuryIDs','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryThreads').get(),j=3,k=600000,l=new (c('Map'))(),m=0;function n(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function o(){l=new (c('Map'))();}function p(r){if(c('ChatOptions').getSetting('sound')&&!n())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],r,false);}var q=Object.assign({init:function r(){c('Event').listen(window,'focus',function(){o();clearInterval(m);});c('Event').listen(window,'blur',function(){m=setInterval(o,k);});},messageReceived:function r(s){if(s.author&&c('MercuryViewer').isViewer(s.author)||!s.is_unread||s.folder!=c('MessagingTag').INBOX&&s.folder!=c('MessagingTag').ARCHIVED)return;var t=s.thread_id,u=c('ChatActivity').isActive();if(u){var v=false;q.inform('before-alert',{threadID:t,cancelAlert:function w(){v=true;}});}i.getThreadMeta(t,function(w){var x=c('MercuryThreadInfo').isMuted(w),y=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(x)if(!c('MercuryThreadInfo').areMentionsMuted(w)){if(!s.profile_ranges||!s.profile_ranges.some||!s.profile_ranges.some(function(ba){return ba.id===y;}))return;}else return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u){!v&&p(z);}else{c('ChatTitleBarBlinker').blink(t,z);var aa=l.get(t)||0;if(aa<j){l.set(t,aa+1);p(z);}}c('ChatTitleBarBlinker').blinkingElsewhere();});}},c('ArbiterMixin'));f.exports=q;}),null);
__d('ChatAppActionTypes',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';f.exports=c('keyMirror')({INITIAL_DISPLAY_DONE:null,HIDE:null,LOAD:null,TTI:null,UNHIDE:null});}),null);
__d('ChatAppActions',['ChatDispatcher','ChatAppActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={tti:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').TTI});},hide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').HIDE});},unhide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').UNHIDE});},setInitialDisplayDone:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').INITIAL_DISPLAY_DONE});},load:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').LOAD});}};f.exports=h;}),null);
__d('ChatAppStore',['ChatAppActionTypes','ChatDispatcher','FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('ChatDispatcher'));this.$ChatAppStore2={initialDisplayDone:false,isHidden:false,isInitialized:false,isLoaded:false};this.$ChatAppStore1=babelHelpers['extends']({},this.$ChatAppStore2);}j.prototype.__onDispatch=function(k){var l=k.type;this.$ChatAppStore1=babelHelpers['extends']({},this.$ChatAppStore2);switch(l){case c('ChatAppActionTypes').INITIAL_DISPLAY_DONE:this.$ChatAppStore2.initialDisplayDone=true;this.__emitChange();break;case c('ChatAppActionTypes').HIDE:this.$ChatAppStore2.isHidden=true;this.__emitChange();break;case c('ChatAppActionTypes').UNHIDE:this.$ChatAppStore2.isHidden=false;this.__emitChange();break;case c('ChatAppActionTypes').TTI:this.$ChatAppStore2.isInitialized=this.$ChatAppStore2.isLoaded=true;this.__emitChange();break;case c('ChatAppActionTypes').LOAD:this.$ChatAppStore2.isLoaded=true;this.__emitChange();break;}};j.prototype.getPreviousState=function(){return this.$ChatAppStore1;};j.prototype.getState=function(){return this.$ChatAppStore2;};f.exports=new j();}),null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],(function a(b,c,d,e,f,g){var h=function i(j,k){this._userID=j;this._logger=c('JSLogger').create('blackbird');this._getState=function(){if(c('ChatVisibility').isOnline())return c('PresencePrivacy').allows(this._userID)?i.NORMAL:i.BLOCKED;return i.OFFLINE;};this._togglePrivacy=function(){var m=this._getState();switch(this._getState()){case i.OFFLINE:if(c('ChatVisibility').isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});c('ChatVisibility').goOnline(function(){if(!c('PresencePrivacy').allows(this._userID)){if(this._getState()!==i.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case i.BLOCKED:c('PresencePrivacy').allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case i.NORMAL:c('PresencePrivacy').disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var l=function(){k&&k(this._getState());}.bind(this);l();this._subscribeToken=c('PresencePrivacy').subscribe('privacy-changed',l);};h.OFFLINE='offline';h.BLOCKED='blocked';h.NORMAL='normal';Object.assign(h.prototype,{togglePrivacy:function i(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function i(){this._subscribeToken&&c('PresencePrivacy').unsubscribe(this._subscribeToken);}});f.exports=h;}),null);
__d('MontageDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MontageActions',['MontageDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({REQUEST_UPDATE:null,HAS_UPDATED:null}),i={Types:h,requestUpdate:function j(k){c('MontageDispatcher').dispatch({type:h.REQUEST_UPDATE,threadFBID:k});},hasUpdated:function j(k){c('MontageDispatcher').dispatch({type:h.HAS_UPDATED,threadFBID:k});}};f.exports=i;}),null);
__d('MercuryCanonicalGroupThreadManager',['Bootloader','KeyedCallbackManager','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher','SubscriptionsHandler'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new (c('KeyedCallbackManager'))();this.$MercuryCanonicalGroupThreadManager3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager6=c('MercuryThreads').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4={};this.$MercuryCanonicalGroupThreadManager8();this.$MercuryCanonicalGroupThreadManager9();this.$MercuryCanonicalGroupThreadManager7={};}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){j=this.$MercuryCanonicalGroupThreadManager10(j);var l=this.$MercuryCanonicalGroupThreadManager11(j),m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager12(j);return m;};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j);};h.prototype.$MercuryCanonicalGroupThreadManager11=function(j){return j.sort().join(',');};h.prototype.$MercuryCanonicalGroupThreadManager13=function(j,k){var l=c('MercuryIDs').getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);this.$MercuryCanonicalGroupThreadManager4[l]=j;};h.prototype.$MercuryCanonicalGroupThreadManager12=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(j),l={canonical_group_key:k,participants:j};c('MercuryServerDispatcher').trySend('/ajax/mercury/search_canonical_groups.php',l,null,this.$MercuryCanonicalGroupThreadManager1);};h.prototype.$MercuryCanonicalGroupThreadManager8=function(){c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(j){this.handleUpdate(j);}.bind(this)}});};h.prototype.$MercuryCanonicalGroupThreadManager10=function(j){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);return j;};h.prototype.handleUpdate=function(j){if(j.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(j.mercury_payload);var k=j.canonical_group;if(k)for(var l in k)this.$MercuryCanonicalGroupThreadManager13(l,k[l]);};h.prototype.getNow=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(this.$MercuryCanonicalGroupThreadManager10(j));return this.$MercuryCanonicalGroupThreadManager2.getResource(k);};h.prototype.$MercuryCanonicalGroupThreadManager9=function(){c('Bootloader').loadModules(["MercuryThreadInformer"],function(j){var k=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1),l=new (c('SubscriptionsHandler'))();l.addSubscriptions(k.subscribe('threads-deleted',function(m,n){for(var o in n)if(this.$MercuryCanonicalGroupThreadManager4[o]){this.$MercuryCanonicalGroupThreadManager2.setResource(this.$MercuryCanonicalGroupThreadManager4[o],undefined);delete this.$MercuryCanonicalGroupThreadManager4[o];}}.bind(this)));this.$MercuryCanonicalGroupThreadManager5=l;}.bind(this),'MercuryCanonicalGroupThreadManager');};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('FantaGetMessageActions',['FantaDispatcher','MercuryCanonicalGroupThreadManager','MercuryIDs','MercuryTypeaheadConstants','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({ADD_PARTICIPANTS:null,CLEAR_PARTICIPANTS:null,CLEAR_PREVIEW:null,FETCH_MORE_MESSAGES:null,ON_BOOTLOAD_TYPEAHEAD:null,ON_GET_THREAD_PREVIEW_RESPONSE:null,ON_GET_THREAD_RESPONSE:null,ON_MESSAGE_STORE_RESPONSE:null,ON_PAGE_NULL_RESPONSE:null,ON_PRIVACY_STATE_CHANGE:null,ON_SHOW_CONTEXT_BANNER_TIMER:null,REFRESH_THREAD:null,THREADS_UPDATED:null}),i={Types:h,addParticipants:function j(k,l){var m,n=l.length===1&&l[0].getInfo().render_type===c('MercuryTypeaheadConstants').THREAD_TYPE,o=void 0;if(n){var p=l[0].getInfo().mercury_thread;if(p)o=c('MercuryIDs').getThreadIDFromThreadFBID(p.thread_fbid);}else if(l.length===1){var q=l[0].info&&l[0].info.uid;if(q)o=c('MercuryIDs').getThreadIDFromUserID(q);}else if(l.length===0){c('FantaDispatcher').dispatch({type:h.CLEAR_PARTICIPANTS,tabID:k});return;}else (function(){var r=c('MercuryCanonicalGroupThreadManager').get(),s=l.map(function(u){return u.info.uid;});c('FantaDispatcher').dispatch({type:h.CLEAR_PREVIEW,tabID:k,tokens:l});var t=r.getCanonicalGroupThreadIDForParticipants(Array.from(s),function(u){r.unsubscribe(t);if(u)c('FantaDispatcher').dispatch({type:h.ADD_PARTICIPANTS,previewTabID:u,tabID:k,tokens:l});});})();if(o)c('FantaDispatcher').dispatch({type:h.ADD_PARTICIPANTS,previewTabID:o,tabID:k,tokens:l});},onBootloadTypeahead:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_BOOTLOAD_TYPEAHEAD,tabID:k,thread:l});},fetchMoreMessages:function j(k){c('FantaDispatcher').dispatch({type:h.FETCH_MORE_MESSAGES,threadID:k});},refreshThread:function j(k){c('FantaDispatcher').dispatch({type:h.REFRESH_THREAD,threadID:k});},onGetThreadResponse:function j(k){c('FantaDispatcher').dispatch({type:h.ON_GET_THREAD_RESPONSE,thread:k});},onGetThreadPreviewResponse:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_GET_THREAD_PREVIEW_RESPONSE,tabID:k,thread:l});},onShowContextBannerTimer:function j(k){c('FantaDispatcher').dispatch({type:h.ON_SHOW_CONTEXT_BANNER_TIMER,threadID:k});},onMessageStoreResponse:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_MESSAGE_STORE_RESPONSE,messages:k,tabID:l});},threadsUpdated:function j(k){c('FantaDispatcher').dispatch({type:h.THREADS_UPDATED,threads:k});},onPrivacyStateChange:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_PRIVACY_STATE_CHANGE,threadID:k,privacyState:l});},onPageNullResponse:function j(k,l,m){c('FantaDispatcher').dispatch({type:h.ON_PAGE_NULL_RESPONSE,threadID:k,nullPageTitle:l,nullPageID:m});}};f.exports=i;}),null);
__d('FantaTabSheetActions',['FantaDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CLOSE_ADD_FRIENDS_SHEET:null,CLOSE_ADD_MORE_FRIENDS_SHEET:null,CLOSE_EMPLOYEE_PERSONAL_USER_SHEET:null,CLOSE_EMPLOYEE_WORK_USER_SHEET:null,CLOSE_NAME_CONVERSATION_TAB_SHEET:null,CLOSE_PAGE_INDICATOR_SHEET:null,CLOSE_READ_ONLY_PERMANENT_SHEET:null,CLOSE_READ_ONLY_SHEET:null,CLOSE_USER_FOCUS_AND_BYPASS_SHEET:null,CLOSE_USER_TIMEZONE_SHEET:null,ON_BOOTLOAD_EVENT_REMINDER:null,ON_IS_PAGE_TAB:null,OPEN_ADD_MORE_FRIENDS_SHEET:null,OPEN_APPOINTMENT_SHEET:null,OPEN_BYPASS_FOCUS_SHEET:null,OPEN_EMPLOYEE_AWAY_SHEET:null,OPEN_EMPLOYEE_PERSONAL_USER_SHEET:null,OPEN_EMPLOYEE_WORK_USER_SHEET:null,OPEN_NAME_CONVERSATION_TAB_SHEET:null,OPEN_PAGE_INDICATOR_SHEET:null,OPEN_READ_ONLY_PERMANENT_SHEET:null,OPEN_READ_ONLY_SHEET:null,OPEN_USER_FOCUS_SHEET:null,OPEN_USER_TIMEZONE_SHEET:null}),i={Types:h,openUserFocusSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_USER_FOCUS_SHEET,tabID:k});},openBypassFocusSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_BYPASS_FOCUS_SHEET,tabID:k});},closeUserFocusAndBypassSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_USER_FOCUS_AND_BYPASS_SHEET,tabID:k});},openUserTimezoneSheet:function j(k,l){c('FantaDispatcher').dispatch({type:h.OPEN_USER_TIMEZONE_SHEET,tabID:k,timezoneInfo:l});},closeUserTimezoneSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_USER_TIMEZONE_SHEET,tabID:k});},openAddMoreFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_ADD_MORE_FRIENDS_SHEET,tabID:k});},closeAddMoreFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_ADD_MORE_FRIENDS_SHEET,tabID:k});},closeAddFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_ADD_FRIENDS_SHEET,tabID:k});},openNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_NAME_CONVERSATION_TAB_SHEET,tabID:k});},closeNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_NAME_CONVERSATION_TAB_SHEET,tabID:k});},openReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_SHEET,tabID:k});},closeReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_SHEET,tabID:k});},openReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_PERMANENT_SHEET,tabID:k});},closeReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_PERMANENT_SHEET,tabID:k});},openEmployeeAwaySheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_AWAY_SHEET,tabID:k});},openEmployeePersonalUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_PERSONAL_USER_SHEET,tabID:k});},closeEmployeePersonalUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_EMPLOYEE_PERSONAL_USER_SHEET,tabID:k});},openEmployeeWorkUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_WORK_USER_SHEET,tabID:k});},closeEmployeeWorkUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_EMPLOYEE_WORK_USER_SHEET,tabID:k});},openPageIndicatorSheet:function j(k,l){c('FantaDispatcher').dispatch({type:h.OPEN_PAGE_INDICATOR_SHEET,description:l,tabID:k});},closePageIndicatorSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_PAGE_INDICATOR_SHEET,tabID:k});},onIsPageTab:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_IS_PAGE_TAB,pageIndicator:l,tabID:k});},onBootloadEventReminder:function j(k){c('FantaDispatcher').dispatch({type:h.ON_BOOTLOAD_EVENT_REMINDER,tabID:k});},openAppointmentBannerSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_APPOINTMENT_SHEET,tabID:k});}};f.exports=i;}),null);
__d('MercurySheetPolicy',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h={ChatThreadIsMutedTabSheet:{isPermanent:false,isSheetWithInput:false},ChatUserFocusSheet:{isPermanent:true,isSheetWithInput:true},ChatUserFocusBypassSheet:{isPermanent:true,isSheetWithInput:true},ChatUserTimezoneSheet:{isPermanent:true,isSheetWithInput:true},ChatUserBlockedTabSheet:{isPermanent:true,isSheetWithInput:false},ChatUploadWarningTabSheet:{isPermanent:false,isSheetWithInput:false},ChatThreadIsMessageBlockedSheet:{isPermanent:true,isSheetWithInput:false},ChatReadOnlyTabSheet:{isPermanent:false,isSheetWithInput:false},ChatReadOnlyPermanentTabSheet:{isPermanent:true,isSheetWithInput:false},ChatOfflineTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNoRecipientsTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNewMessagesTabSheet:{isPermanent:true,isSheetWithInput:true},ChatNameConversationTabSheet:{isPermanent:true,isSheetWithInput:true},ChatEmployeeAwaySheet:{isPermanent:true,isSheetWithInput:false},ChatUserIsPersonalUserSheet:{isPermanent:true,isSheetWithInput:false},ChatUserIsWorkUserSheet:{isPermanent:true,isSheetWithInput:true},ChatEventReminderTabSheet:{isPermanent:true,isSheetWithInput:false},ChatAppointmentBanner:{isPermanent:true,isSheetWithInput:false},ChatMontageSheet:{isPermanent:false,isSheetWithInput:false},ChatJoinCallSheet:{isPermanent:true,isSheetWithInput:false},FantaAddFriendsSheet:{isPermanent:true,isSheetWithInput:true},FantaAddMoreFriendsSheet:{isPermanent:true,isSheetWithInput:true},ChatRoomAssociatedObjectSheet:{isPermanent:false,isSheetWithInput:false}},i={canReplaceOpenSheet:function j(k,l){var m=this.getType(l),n=this.isPermanent(l),o=this.isSheetWithInput(l),p=this.getType(k),q=this.isPermanent(k),r=this.isSheetWithInput(k);if(r)return !!(m!==p&&o);if(q&&!n)return false;if(p===this.sheets.ChatThreadIsMessageBlockedSheet)return false;return true;},getType:function j(k){var l=k.getType||k.type&&k.type.getType||function(){return k;},m=l.call(k);return m;},isPermanent:function j(k){if(typeof k==='string'&&h[k])return h[k].isPermanent;var l=k.isPermanent||k.type&&k.type.isPermanent||function(){return false;},m=l.call(k);return m;},isSheetWithInput:function j(k){if(typeof k==='string'&&h[k])return h[k].isSheetWithInput;var l=k.isSheetWithInput||k.type&&k.type.isSheetWithInput||function(){return false;},m=l.call(k);return m;},sheets:c('keyMirror')(h)};f.exports=i;}),null);
__d('FantaComposeViewReducers',['Bootloader','FantaGetMessageActions','FantaTabSheetActions','MercuryDataSourceWrapper','MercurySheetPolicy','MercuryTypeaheadConstants','MessengerRoomPrivacyMode','ifRequired'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaGetMessageActions').Types,i=c('FantaTabSheetActions').Types;function j(r,s){switch(s.type){case h.ON_GET_THREAD_RESPONSE:case h.ON_GET_THREAD_PREVIEW_RESPONSE:var t=s.thread,u=s.tabID||t.thread_id;r=k(r,t,u);}return r;}function k(r,s,t){if(s.participants.length===0){r=m(r,t,s);r=p(r,t,c('MercurySheetPolicy').sheets.FantaAddFriendsSheet);}return r;}function l(r,s){switch(s.type){case h.ON_BOOTLOAD_TYPEAHEAD:var t=s.thread,u=t.thread_id;r=m(r,u,t);}return r;}function m(r,s,t){if(r.mercury.tabContents.get(s).typeahead)return r;c('ifRequired')('ChatTabTypeaheadRenderer',function(u){c('ifRequired')('ContextualTypeaheadView',function(v){c('ifRequired')('MercuryTypeahead',function(w){if(!r.mercury.tabContents.get(s))return;var x=!!(t&&t.participants&&t.participants.length===0),y=!!(t&&t.associated_object&&t.associated_object.privacy_mode===c('MessengerRoomPrivacyMode').WHITELISTED_MODE),z=x?c('MercuryDataSourceWrapper').chat_typeahead_source:y?c('MercuryDataSourceWrapper').chat_add_people_froup_source:c('MercuryDataSourceWrapper').chat_add_people_source;z.setShowThreads(x);if(y)z.setQueryData({thread_id:t.thread_fbid});var aa=new w(z,v);aa.setViewOption('renderer',u);aa.setExcludedParticipantsFromThreadMeta(t);r=r.mergeIn(['mercury','tabContents',s],{typeahead:aa});},function(){return o(s,t);});},function(){return o(s,t);});},function(){return o(s,t);});return r;}function n(r,s){switch(s.type){case i.OPEN_ADD_MORE_FRIENDS_SHEET:var t=s.tabID,u=r.mercury.tabContents.get(t).thread;if(u){r=m(r,t,u);return p(r,s.tabID,c('MercurySheetPolicy').sheets.FantaAddMoreFriendsSheet);}}return r;}function o(r,s){c('Bootloader').loadModules(["ChatTabTypeaheadRenderer","ContextualTypeaheadView","MercuryTypeahead"],function(t,u,v){c('FantaGetMessageActions').onBootloadTypeahead(r,s);},'FantaComposeViewReducers');}function p(r,s,t){var u=r.mercury.tabContents.get(s),v=r.tabGroup.tabs.get(s);if(!v||!u)return r;var w=u.openSheet;if(w&&!c('MercurySheetPolicy').canReplaceOpenSheet(w,t))return r;r=r.mergeIn(['mercury','tabContents',s],{openSheet:t});return r;}function q(r,s){switch(s.type){case h.ADD_PARTICIPANTS:var t=s.tokens,u=s.tabID,v=t.length===1&&t[0].getInfo().render_type===c('MercuryTypeaheadConstants').THREAD_TYPE;if(!v)return p(r,u,c('MercurySheetPolicy').sheets.FantaAddFriendsSheet);}return r;}f.exports={addParticipants:q,onBootloadTypeahead:l,onGetThreadResponse:j,openAddMoreFriends:n};}),null);
__d('FantaMessageActions',['Bootloader','FantaDispatcher','MercuryConfig','ifRequired','keyMirror','emptyFunction','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CANCEL_FILE_UPLOAD:null,COMPOSER_TEXT_UPDATE:null,LINK_PREVIEW:null,LOADED_SHARE_DATA:null,LOADING_SHARE_DATA:null,PREPARE_FILES_FOR_SEND:null,RECEIVED_NEW_MESSAGE:null,REMOVE_SHARE_PREVIEW:null,SEND_GROUP_MESSAGE:null,SEND_HOT_LIKE:null,SEND_MESSAGE:null,SEND_PHOTO:null,SEND_STICKER:null,UPDATE_GROUP_NAME:null,UPLOAD_FILE_FAILED:null,UPLOADED_FILE:null});function i(){var l=document.createElement('form');l.action=c('MercuryConfig').upload_url;l.method='post';return l;}function j(l,m){var n=document.createElement('input');n.type='file';n.name='attachment[]';n.multiple=true;if(m)n.onchange=m;l.appendChild(n);return n;}var k={Types:h,prepareFilesForSend:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.PREPARE_FILES_FOR_SEND,tabID:m,files:n});});},openUploadFilePicker:function l(m){var n=i(),o=j(n,function(){k.prepareFilesForSend(m,this.files);});o.click();},uploadedFile:function l(m,n,o){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOADED_FILE,tabID:m,uploadID:n,payload:o});});},uploadFileFailed:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOAD_FILE_FAILED,tabID:m,uploadID:n});});},cancelFileUpload:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.CANCEL_FILE_UPLOAD,tabID:m,uploadID:n});});},linkPreview:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LINK_PREVIEW,tabID:m,uri:n});});},loadedShareData:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADED_SHARE_DATA,tabID:m,attachmentData:n});});},loadingShareData:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADING_SHARE_DATA,tabID:m});});},removeSharePreview:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.REMOVE_SHARE_PREVIEW,tabID:m});});},receivedNewMessage:function l(m,n){c('FantaDispatcher').dispatch({type:h.RECEIVED_NEW_MESSAGE,tabID:m,message:n});},updateGroupName:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.UPDATE_GROUP_NAME,threadID:m,newName:n});});},sendGroupMessage:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_GROUP_MESSAGE,threadID:m,onSendSuccess:n});});},sendMessage:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_MESSAGE,threadID:m,message:n,onSendSuccess:o});});},sendPhoto:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_PHOTO,onSendSuccess:o,photoData:n,threadID:m});});},sendHotLike:function l(m,n,o,p,q){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_HOT_LIKE,emoji:n,onSendSuccess:q,size:o,source:p,threadID:m});});},sendSticker:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_STICKER,threadID:m,stickerID:n,onSendSuccess:o});});},composerTextUpdate:function l(m,n){if(n.length>0)c('ifRequired')('FantaReducersSendMessages',c('emptyFunction'),function(){return this.dispatchOrBootloadSendMessages(c('emptyFunction'));}.bind(this));this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.COMPOSER_TEXT_UPDATE,threadID:m,message:n});});},dispatchOrBootloadSendMessages:function l(m){c('ifRequired')('FantaReducersSendMessages',function(){c('setImmediate')(m);},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSendMessages"],function(n,o){n.addReducers(o);c('setImmediate')(m);},'FantaMessageActions');});},dispatchOrBootloadUploader:function l(m){c('ifRequired')('FantaReducersFileUploader',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersFileUploader"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});},dispatchOrBootloadSharePreview:function l(m){c('ifRequired')('FantaReducersSharePreview',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSharePreview"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});}};f.exports=k;}),null);
__d('FantaReducersCookie',['FantaMessageActions','FantaTabActions','MercuryConfig','PresenceState','debounce','emptyFunction'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j=c('MercuryConfig').FRC?c('debounce')(c('PresenceState').doSync,300):c('emptyFunction');function k(n,o){switch(o.type){case h.RECEIVED_NEW_MESSAGE:case i.CLOSE_ALL_TABS:case i.CLOSE_AND_TAB_NEXT:case i.CLOSE_TAB:case i.DELETE_TAB:case i.MINIMIZE_ALL_TABS:case i.MINIMIZE_TAB:case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:case i.REPLACE_TAB:case i.UNMINIMIZE_TAB:j();return m(n);}return n;}function l(n,o){switch(o.type){case i.LOAD_FROM_DATA:return n.mergeIn(['tabGroup'],{updatedTime:o.tabData.updatedTime});}return n;}function m(n){return n.mergeIn(['tabGroup'],{updatedTime:Date.now()});}f.exports={updateCookie:k,loadFromData:l};}),null);
__d('FantaReducersDockCalculator',['Arbiter','FantaTabActions','FantaMessageActions','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaTabActions').Types,i=c('FantaMessageActions').Types,j=null;function k(n){j=n;c('setImmediate')(function(){c('Arbiter').inform('FantaReducersDockCalculator/shouldRecalculate');});}function l(n){if(!j||n.size!==j.size){k(n);}else{var o=false;n.forEach(function(p){var q=j&&j.get(p.id);if(!q||p.isMinimized!==q.isMinimized)o=true;});if(o)k(n);}}function m(n,o){var p=n.tabGroup.tabs;switch(o.type){case h.CLOSE_ALL_TABS:case h.CLOSE_AND_TAB_NEXT:case h.CLOSE_TAB:case h.DELETE_TAB:case h.MINIMIZE_ALL_TABS:case h.MINIMIZE_TAB:case h.OPEN_TAB:case h.OPEN_TAB_WITH_INTERSTITIAL_DATA:case h.UNMINIMIZE_TAB:k(p);break;case h.LOAD_FROM_DATA:case i.RECEIVED_NEW_MESSAGE:l(p);break;}return n;}f.exports={recalculateDock:m};}),null);
__d('FantaAvailableStatus',['AvailableListConstants','ChatVisibility','MercuryIDs','PresenceStatus','ShortProfiles'],(function a(b,c,d,e,f,g){'use strict';f.exports={isAvailable:function h(i,j){var k=void 0,l=this.getStatus(i,j),m=c('MercuryIDs').getUserIDFromThreadID(j);if(m)k=c('ShortProfiles').getNow(m);return l===c('AvailableListConstants').ACTIVE&&(k===undefined||k===null||!k.is_messenger_only);},getStatus:function h(i,j){var k=c('AvailableListConstants').OFFLINE,l=c('MercuryIDs').getUserIDFromThreadID(j);if(l){k=c('PresenceStatus').get(l);}else if(i){var m=i.participants.map(function(n){return c('MercuryIDs').getUserIDFromParticipantID(n);});k=c('PresenceStatus').getGroup(m);}if(!c('ChatVisibility').isOnline())k=c('AvailableListConstants').OFFLINE;return k;}};}),null);
__d('FantaTypeJoinableThread',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={admins:[],approvalMode:0,associatedObject:null,description:null,friendsInParticipants:[],imageURL:null,isViewerSubscribed:false,joinableMode:{mode:0,link:''},linkHash:'',participants:[],threadID:null,threadFBID:null,threadName:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeFileUploader',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={ANIMATED_IMAGE:'animated_image',AUDIO:'audio',FILE:'file',GENERIC_ATTACHMENT:'generic_attachment',IMAGE:'image',VIDEO:'video'},k={uploadedFiles:c('immutable').Map(),uploadingFiles:c('immutable').Map()};h=babelHelpers.inherits(l,c('immutable').Record(k));i=h&&h.prototype;l.prototype.getTypeIDs=function(m){return this.uploadedFiles.reduce(function(n,o){if(o.type===m&&o.uploadedID)n=n.concat(o.uploadedID);return n;},[]);};function l(){h.apply(this,arguments);}l.fileTypes=j;f.exports=l;}),null);
__d('FantaTypeSharePreview',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={isLoading:false,params:null,type:null,uri:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeTabContents',['ChatPrivacyActionController','FantaGetMessageActions','FantaTypeFileUploader','FantaTypeSharePreview','immutable','MercuryIDs','emptyFunction','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={composerText:'',fileUploader:new (c('FantaTypeFileUploader'))(),hasFetchedAll:false,id:'',isScrolledToBottom:true,messages:c('immutable').List(),messageStore:null,nullPageID:null,nullPageTitle:null,openSheet:null,pageIndicator:null,pageIndicatorDescription:null,privacyController:null,sharePreview:new (c('FantaTypeSharePreview'))(),showContextBanner:false,showUnseenMessages:c('emptyFunction'),signatureID:null,joinableInterstitialData:null,thread:null,threadPreviewID:null,threadPreviewRecipients:null,timezoneInfo:null,typeahead:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(l){var m=void 0,n=c('MercuryIDs').getUserIDFromThreadID(l.id);if(n)m=new (c('ChatPrivacyActionController'))(n,function(o){c('setImmediate')(function(){c('FantaGetMessageActions').onPrivacyStateChange(l.id,o);});});i.constructor.call(this,babelHelpers['extends']({privacyController:m},l));}f.exports=k;}),null);
__d('getPageIDFromThreadID',['FBID','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('MercuryIDs').getUserIDFromThreadID(i);if(!j||c('FBID').isUser(j))return null;return j;}f.exports=h;}),null);
__d('FantaReducersMercury',['Arbiter','AsyncSignal','AvailableList','AvailableListConstants','Bootloader','FantaAvailableStatus','FantaGetMessageActions','FantaMessageActions','FantaTabActions','FantaTabSheetActions','FantaTypeJoinableThread','FantaTypeTabContents','JSLogger','MercuryIDs','MercuryThreadIDMap','WorkFocusMode','getPageIDFromThreadID','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadIDMap').get(),i=c('JSLogger').create('FantaReducersMercury'),j=c('FantaMessageActions').Types,k=c('FantaTabActions').Types,l=c('FantaGetMessageActions').Types;function m(){return Math.floor(Math.random()*2147483648).toString(16);}function n(ha,ia){switch(ia.type){case k.OPEN_TAB:case k.OPEN_TAB_WITH_INTERSTITIAL_DATA:var ja=ia.tabID;c('ifRequired')('FantaTabsReactApp',function(ma){if(!c('MercuryIDs').isValidThreadID(ja)){ha=ha.deleteIn(['tabGroup','tabs',ja]);v(ja);}else{da(ha,ja);ea(ja);}},function(){return ha=o(ha,ia.tabID);});ha=q(ha,ja);var ka=m();ha=ha.mergeIn(['mercury','tabContents',ja],{signatureID:ka});new (c('AsyncSignal'))('/ajax/chat/opentab_tracking.php',{threadID:ja,userID:c('MercuryIDs').getUserIDFromThreadID(ja),signatureID:ka}).send();if(ia.interstitialData){var la=new (c('FantaTypeJoinableThread'))(ia.interstitialData);ha=ha.mergeIn(['mercury','tabContents',ja],{joinableInterstitialData:la});}c('Arbiter').inform('jewel/hide');return ha;}return ha;}function o(ha,ia){c('ifRequired')('FantaTabsSlimApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}else{da(ha,ia);ea(ia);}},function(){da(ha,ia);ea(ia);});return ha;}function p(ha,ia){switch(ia.type){case j.RECEIVED_NEW_MESSAGE:ha=q(ha,ia.tabID);}return ha;}function q(ha,ia){var ja,ka=ha.mercury.tabContents.get(ia);if(!ka){var ja=function(){var la=c('getPageIDFromThreadID')(ia);if(la)c('Bootloader').loadModules(["PagesMercuryChatTabIndicatorHandler"],function(ma){var na=c('AvailableListConstants').OFFLINE,oa=new ma(la,na,function(pa){c('setImmediate')(function(){c('FantaTabSheetActions').openPageIndicatorSheet(ia,pa);});},function(){c('setImmediate')(function(){return c('FantaTabSheetActions').closePageIndicatorSheet(ia);});});c('setImmediate')(function(){c('FantaTabSheetActions').onIsPageTab(ia,oa);});oa.checkResponsiveness();},'FantaReducersMercury');return {v:ha.setIn(['mercury','tabContents',ia],new (c('FantaTypeTabContents'))({id:ia}))};}();if(typeof ja==="object")return ja.v;}return ha;}function r(ha,ia){switch(ia.type){case k.REPLACE_TAB:ha=u(ha,ia.newTabID);ha=q(ha,ia.newTabID);return ha;}return ha;}function s(ha,ia){switch(ia.type){case l.ADD_PARTICIPANTS:var ja=ia.tabID,ka=ia.previewTabID;if(!ha.mercury.tabContents.get(ja))return ha;ha=ha.mergeIn(['mercury','tabContents',ja],{threadPreviewID:ka});return ha;}return ha;}function t(ha,ia){switch(ia.type){case l.CLEAR_PARTICIPANTS:var ja=ia.tabID;ha=ha.setIn(['mercury','tabContents',ja],new (c('FantaTypeTabContents'))({id:ja}));}return ha;}function u(ha,ia){c('ifRequired')('FantaTabsReactApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}},function(){c('ifRequired')('FantaTabsSlimApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}});});return ha;}function v(ha){h.getClientIDFromServerID(ha,function(ia){return c('setImmediate')(function(){if(c('MercuryIDs').isValidThreadID(ia)){c('FantaTabActions').openTab(ia);}else i.error('invalid id',ha);});});}function w(ha,ia){switch(ia.type){case k.FOCUS_TAB:da(ha,ia.tabID);}return ha;}function x(ha,ia){switch(ia.type){case k.CLOSE_TAB:var ja=ia.tabID;ha=z(ha,ja);}return ha;}function y(ha,ia){switch(ia.type){case k.DELETE_TAB:var ja=ia.tabID;ha=z(ha,ja);ha=ha.deleteIn(['mercury','tabContents',ja]);}return ha;}function z(ha,ia){c('ifRequired')('MessengerVideoAutoplayActions',function(ja){ja.deleteThread(ia);});c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ia);return ha;}function aa(ha,ia){switch(ia.type){case k.CLOSE_ALL_TABS:c('ifRequired')('MessengerVideoAutoplayActions',function(ja){ja.deleteAllThreads();});return ha;}return ha;}function ba(ha,ia){switch(ia.type){case k.FOCUS_NEXT_TAB:case k.FOCUS_PREVIOUS_TAB:case k.CLOSE_AND_TAB_NEXT:var ja=ha.tabGroup.focusedTabID;if(ja)da(ha,ja);}return ha;}function ca(ha,ia){switch(ia.type){case k.CLOSE_AND_TAB_NEXT:var ja=ia.tabID;c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ja);}return ha;}function da(ha,ia){var ja=c('MercuryIDs').getUserIDFromThreadID(ia);if(ja)c('AvailableList').updateForID(ja);var ka=ha.mercury.tabContents.get(ia);if(ka){var la=ka.thread,ma=ka.pageIndicator;if(ma)ma.notifyPageOnlineStatusChanged(c('FantaAvailableStatus').getStatus(la,ia));}}function ea(ha){if(!c('MercuryIDs').isValidThreadID(ha))return;c('Bootloader').loadModules(["GroupChatMessageBlockAlert","mercuryBlockedParticipantsRe","MercuryThreadActions","MercuryThreads"],function(ia,ja,ka,la){var ma=ka.get(),na=la.get(),oa=ja.get();na.getThreadMeta(ha,function(pa){if(oa.isPresentInGroupThread(pa))ia.show(oa.inGroupThread(pa),function(){c('FantaTabActions').focusTab(ha);},function(){c('FantaTabActions').closeTab(ha);ma.leaveGroup(ha);});});},'FantaReducersMercury');}function fa(ha,ia){switch(ia.type){case k.UNMINIMIZE_TAB:da(ha,ia.tabID);}return ha;}function ga(ha,ia){switch(ia.type){case k.LOAD_FROM_DATA:for(var ja=ha.tabGroup.tabs.keys(),ka=Array.isArray(ja),la=0,ja=ka?ja:ja[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ma;if(ka){if(la>=ja.length)break;ma=ja[la++];}else{la=ja.next();if(la.done)break;ma=la.value;}var na=ma;ha=q(ha,na);}}return ha;}f.exports={addParticipants:s,clearParticipants:t,closeAllTabs:aa,closeAndTabNext:ca,closeTab:x,deleteTab:y,focusTab:w,focusTabEvents:ba,loadFromData:ga,openTab:n,receivedNewMessage:p,replaceTab:r,unminimizeTab:fa};}),null);
__d('FantaReducersMessages',['FantaGetMessageActions','FantaMessageActions','FantaTabActions','MercuryBrowserAlerts'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j=c('FantaGetMessageActions').Types;function k(r,s){switch(s.type){case h.RECEIVED_NEW_MESSAGE:var t=s.message;c('MercuryBrowserAlerts').messageReceived(t);return r;}return r;}function l(r,s){switch(s.type){case h.COMPOSER_TEXT_UPDATE:var t=s.message,u=s.threadID;if(!r.mercury.tabContents.get(u))return r;return r.mergeIn(['mercury','tabContents',u],{composerText:t});}return r;}function m(r,s){switch(s.type){case i.CLOSE_TAB:if(!r.mercury.tabContents.get(s.tabID))return r;return r.mergeIn(['mercury','tabContents',s.tabID],{composerText:''});}return r;}function n(r,s){switch(s.type){case i.CLOSE_ALL_TABS:var t=r.mercury.tabContents;t.forEach(function(u){var v=u.id;r=r.setIn(['mercury','tabContents',v],u.set('composerText',''));});return r;}return r;}function o(r,s){switch(s.type){case i.SCROLL_BOTTOM_CHANGED:var t=s.tabID,u=s.isScrolledToBottom,v=s.showUnseenMessages;if(!r.mercury.tabContents.get(t))return r;r=r.mergeIn(['mercury','tabContents',t],{isScrolledToBottom:u,showUnseenMessages:v});}return r;}function p(r,s){switch(s.type){case i.SHOW_UNSEEN_MESSAGES:var t=s.tabID,u=r.mercury.tabContents.get(t);if(u)u.showUnseenMessages();}return r;}function q(r,s){switch(s.type){case j.ON_GET_THREAD_RESPONSE:var t=s.thread,u=t.thread_id,v=r.mercury.tabContents.get(u);if(!v)return r;r=r.mergeIn(['mercury','tabContents',u],{thread:t});break;}return r;}f.exports={closeAllTabs:n,closeTab:m,composerTextUpdate:l,onGetThreadResponse:q,receivedNewMessage:k,scrollBottomChanged:o,showUnseenMessages:p};}),null);
__d('FantaTypeTab',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={focusCounter:0,id:'',isHovered:false,isMinimized:false,openCounter:0,entryPoint:'unknown'};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeTabGroup',['FantaConst','immutable','MercuryConfig'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={allowedRaisedTabs:c('FantaConst').DEFAULT_ALLOWED_RAISED_TABS,focusedTabID:null,tabs:c('immutable').Map({}),updatedTime:0};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;k.prototype.getRaisedandUnraisedTabs=function(){var l=void 0,m=void 0;if(c('MercuryConfig').FantaTabOrdering){m=function q(r){return r.openCounter*-1;};l=function q(r){return r.focusCounter*-1;};}else{m=function q(r){return r.openCounter;};l=function q(r){return r.focusCounter*-1;};}var n=this.tabs.sortBy(l),o=n.slice(this.allowedRaisedTabs),p=n.take(this.allowedRaisedTabs).sortBy(m);return {raisedTabs:p,unraisedTabs:o};};function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d("isWebMessengerURI",[],(function a(b,c,d,e,f,g){function h(i){return /^(\/messages)/.test(i.getPath());}f.exports=h;}),null);
__d('FantaReducersTabs',['EventProfiler','FantaConst','FantaMessageActions','FantaTabActions','FantaTypeTab','FantaTypeTabGroup','LogHistory','PinnedConversationNubsConfig','URI','isWebMessengerURI'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j='tab_',k=c('LogHistory').getInstance('fanta_tabs'),l=1,m=1,n=1;function o(na,oa){switch(oa.type){case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:k.debug(oa.type,JSON.stringify({id:oa.tabID}));if(m===1)c('EventProfiler').tagCurrentActiveInteractionsAs('FirstChatTabOpen');return v(na,oa.tabID||j+n++,true,oa.entryPoint);}return na;}function p(na,oa){switch(oa.type){case i.REPLACE_TAB:var pa=oa.tabID,qa=oa.newTabID,ra=na.tabGroup,sa=ra.tabs,ta=sa.get(pa);k.debug(oa.type,JSON.stringify({id:pa,isExisting:!!ta,newID:qa}));if(ta){var ua=ta.id===na.tabGroup.focusedTabID;na=na.setIn(['tabGroup','tabs',qa],ta.merge({id:qa})).deleteIn(['tabGroup','tabs',pa]);return v(na,qa,ua,'replace_tab');}return v(na,qa,false,'replace_tab');}return na;}function q(na,oa){switch(oa.type){case i.MINIMIZE_TAB:return w(na,oa.tabID,true);}return na;}function r(na,oa){switch(oa.type){case i.UNMINIMIZE_TAB:return w(na,oa.tabID,false);}return na;}function s(na,oa){switch(oa.type){case i.FOCUS_TAB:var pa=oa.tabID;return ca(na,pa);}return na;}function t(na,oa){switch(oa.type){case i.BLUR_TAB:return da(na,oa.tabID);}return na;}function u(na,oa){switch(oa.type){case h.RECEIVED_NEW_MESSAGE:var pa=oa.tabID,qa=na.tabGroup.tabs.get(pa);k.debug(oa.type,JSON.stringify({id:pa,isOpen:!!qa}));if(!qa){var ra=na.tabGroup.focusedTabID;na=v(na,pa,false,'message_received');var sa=c('URI').getNextURI();if(c('isWebMessengerURI')(sa)){return na=w(na,pa,true);}else if(ra)return ca(na,ra);}}return na;}function v(na,oa,pa){var qa=arguments.length<=3||arguments[3]===undefined?'unknown':arguments[3],ra=na.tabGroup,sa=ra.tabs,ta=sa.get(oa);if(!ta){ta=new (c('FantaTypeTab'))({id:oa,focusCounter:l,openCounter:m++,entryPoint:qa});na=na.setIn(['tabGroup','tabs',oa],ta);}else if(ta.isMinimized&&pa)na=w(na,oa,false);if(pa)return ca(na,oa);return na;}function w(na,oa,pa){var qa=na.tabGroup,ra=qa.tabs.get(oa);if(ra)na=na.mergeIn(['tabGroup','tabs',oa],{isMinimized:pa});return na;}function x(na,oa){switch(oa.type){case i.MINIMIZE_ALL_TABS:for(var pa=na.tabGroup.tabs.keys(),qa=Array.isArray(pa),ra=0,pa=qa?pa:pa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var sa;if(qa){if(ra>=pa.length)break;sa=pa[ra++];}else{ra=pa.next();if(ra.done)break;sa=ra.value;}var ta=sa;na=w(na,ta,true);}return na;}return na;}function y(na,oa){switch(oa.type){case i.CLOSE_TAB:case i.DELETE_TAB:var pa=oa.tabID;k.debug(oa.type,JSON.stringify({id:pa}));return z(na,pa);}return na;}function z(na,oa){na=da(na,oa);return na.deleteIn(['tabGroup','tabs',oa]);}function aa(na,oa){switch(oa.type){case i.CLOSE_ALL_TABS:k.debug(oa.type);na=da(na,na.tabGroup.focusedTabID);return na.setIn(['tabGroup','tabs'],na.tabGroup.tabs.clear());}return na;}function ba(na,oa){switch(oa.type){case i.CLOSE_AND_TAB_NEXT:k.debug(oa.type,JSON.stringify({id:oa.tabID}));na=z(na,oa.tabID);return la(na);}return na;}function ca(na,oa){var pa=arguments.length<=2||arguments[2]===undefined?false:arguments[2],qa=na.tabGroup,ra=qa.tabs.get(oa);if(ra)na=na.mergeIn(['tabGroup','tabs',oa],{focusCounter:l++});var sa=pa?null:oa;na=na.mergeIn(['tabGroup'],{focusedTabID:sa});return na;}function da(na,oa){if(na.tabGroup.focusedTabID===oa)return na.mergeIn(['tabGroup'],{focusedTabID:null});return na;}function ea(na,oa){switch(oa.type){case i.HOVERED_TAB:var pa=oa.tabID;return ga(na,pa,true);}return na;}function fa(na,oa){switch(oa.type){case i.UNHOVERED_TAB:var pa=oa.tabID;return ga(na,pa,false);}return na;}function ga(na,oa,pa){var qa=na.tabGroup,ra=qa.tabs.get(oa);if(ra)na=na.mergeIn(['tabGroup','tabs',oa],{isHovered:pa});return na;}function ha(na,oa){switch(oa.type){case i.SET_ALLOWED_RAISED_TABS:var pa=oa.allowedRaisedTabs;if(pa!==na.tabGroup.allowedRaisedTabs)k.debug(oa.type,JSON.stringify({count:pa}));return ia(na,pa);}return na;}function ia(na){var oa=arguments.length<=1||arguments[1]===undefined?c('FantaConst').DEFAULT_ALLOWED_RAISED_TABS:arguments[1];if(oa===na.tabGroup.allowedRaisedTabs)return na;if(!c('PinnedConversationNubsConfig').chatTabTypingPriority)oa=Math.max(1,oa);return na.mergeIn(['tabGroup'],{allowedRaisedTabs:oa});}function ja(na,oa){switch(oa.type){case i.LOAD_FROM_DATA:var pa=na.tabGroup,qa=oa.tabData,ra=pa.updatedTime;if(ra>=qa.updatedTime||qa.updatedTime===undefined)return na;na=ia(na.set('tabGroup',new (c('FantaTypeTabGroup'))()),pa.allowedRaisedTabs);var sa=[];qa.tabs.sort(function(ta,ua){return ta.openCounter-ua.openCounter;}).forEach(function(ta){sa.push(ta.id);na=v(na,ta.id,false,'loaded_from_data');if(ta.isMinimized)na=w(na,ta.id,ta.isMinimized);});qa.tabs.sort(function(ta,ua){return ta.focusCounter-ua.focusCounter;}).forEach(function(ta){na=ca(na,ta.id,true);});k.debug(oa.type,JSON.stringify({updatedTime:ra,newerTime:qa.updatedTime,opened:sa}));na=qa.focusedTabID?ca(na,qa.focusedTabID,true):da(na);}return na;}function ka(na,oa){switch(oa.type){case i.FOCUS_NEXT_TAB:return la(na);}return na;}function la(na){var oa=na.tabGroup.focusedTabID,pa=na.tabGroup.getRaisedandUnraisedTabs(),qa=pa.raisedTabs,ra=qa.count();if(ra===0){return na;}else if(qa.count()===1)return ca(na,qa.first().id);var sa=qa.skipUntil(function(ta){return ta.id===oa;}).rest();if(sa.count()===0){return ca(na,qa.first().id);}else return ca(na,sa.first().id);}function ma(na,oa){switch(oa.type){case i.FOCUS_PREVIOUS_TAB:var pa=na.tabGroup.focusedTabID,qa=na.tabGroup.getRaisedandUnraisedTabs(),ra=qa.raisedTabs;if(ra.count()<2)return na;var sa=ra.reverse().skipUntil(function(ta){return ta.id===pa;}).rest();if(sa.count()===0){return ca(na,ra.last().id);}else return ca(na,sa.first().id);}return na;}f.exports={blurTab:t,closeAllTabs:aa,closeAndTabNext:ba,closeTab:y,focusNextTab:ka,focusPreviousTab:ma,focusTab:s,hoveredTab:ea,loadFromData:ja,minimizAllTabs:x,minimizeTab:q,openTab:o,receivedNewMessage:u,replaceTab:p,setAllowedRaisedTabs:ha,unhoveredTab:fa,unminimizeTab:r};}),null);
__d('FantaTypeMercuryState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={tabContents:c('immutable').Map({})};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeAppState',['FantaTypeMercuryState','FantaTypeTabGroup','immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={tabGroup:new (c('FantaTypeTabGroup'))(),mercury:new (c('FantaTypeMercuryState'))()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaAppStore',['FantaDispatcher','FantaReducersCookie','FantaReducersDockCalculator','FantaReducersMercury','FantaReducersMessages','FantaReducersTabs','FantaComposeViewReducers','FantaTypeAppState','FluxReduceStore','MercuryConfig','PresenceState'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=[].concat(Object.values(c('FantaReducersTabs')),Object.values(c('FantaReducersMercury')),Object.values(c('FantaReducersMessages')),Object.values(c('FantaReducersDockCalculator')),Object.values(c('FantaReducersCookie')),Object.values(c('FantaComposeViewReducers')));h=babelHelpers.inherits(k,c('FluxReduceStore'));i=h&&h.prototype;k.prototype.getInitialState=function(){return new (c('FantaTypeAppState'))();};k.prototype.ignoreReducer=function(m){var n=Object.values(m);j=j.filter(function(o){return !n.find(function(p){return p===o;});});};k.prototype.addReducers=function(m){this.ignoreReducer(m);j=j.concat(Object.values(m));};k.prototype.reduce=function(m,n){return j.reduce(function(o,p){return p(o,n);},m);};function k(){h.apply(this,arguments);}var l=new k(c('FantaDispatcher'));if(!c('MercuryConfig').FRC)l.addListener(function(){return c('PresenceState').doSync();});f.exports=l;}),null);
__d('FantaCookieUtil',['FantaConst','Map','MercuryIDs','MercuryThreads','WorkModeConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreads').get(),i={convertCookieData:function j(k,l,m){var n={tabs:[],focusedTabID:null,updatedTime:0,interstitialData:m},o=[],p=this._getCookieKeys();k=k||{};if(k[p.tabs])o=k[p.tabs];o.forEach(function(v){n.tabs.push({id:v.i,isMinimized:!v.r,openCounter:v.o,focusCounter:v.f});});if(l)for(var q=l.tabs.values(),r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var t;if(r){if(s>=q.length)break;t=q[s++];}else{s=q.next();if(s.done)break;t=s.value;}var u=t;if(h.isEmptyLocalThread(u.id))n.tabs.push({id:u.id,isMinimized:u.isMinimized,openCounter:u.openCounter,focusCounter:u.focusCounter});}n.focusedTabID=k[p.focusedTabID];n.updatedTime=k[p.updatedTime];return n;},createCookieData:function j(k,l){var m=[],n=this._getCookieKeys();for(var o=k.tabs.values(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r;if(!c('MercuryIDs').isLocalThread(s.id))m.push({i:s.id,r:s.isMinimized?undefined:1,o:s.openCounter,f:s.focusCounter});}l[n.tabs]=m;l[n.focusedTabID]=k.focusedTabID;l[n.updatedTime]=k.updatedTime;return l;},_getCookieKeys:function j(){var k=c('WorkModeConfig').is_work_user;return {tabs:k?c('FantaConst').cookieIDs.WORK_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_COOKIE_ID,focusedTabID:k?c('FantaConst').cookieIDs.WORK_FOCUS_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_FOCUS_COOKIE_ID,updatedTime:k?c('FantaConst').cookieIDs.WORK_TIME_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_TIME_COOKIE_ID};}};f.exports=i;}),null);
__d('FantaMercuryThreadEventsBootloaded',['Bootloader','MercuryThreadInformer','MercuryThreads','MercuryViewer'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get(),j={onMessagesReceived:function k(l){h.subscribe('messages-received',function(m,n){var o,p=function r(s){var t,u=n[s],v=function x(y){var z=u[y];if(z.author!=c('MercuryViewer').getID()){if(!z.is_unread)return 'continue';i.getThreadMeta(s,function(aa){c('Bootloader').loadModules(["ChatTabPolicy"],function(ba){ba.messageIsAllowed(aa,z,function(){l(s,z);});},'FantaMercuryThreadEventsBootloaded');});}};for(var w=0;w<u.length;w++){var t=v(w);if(t==='continue')continue;}};for(var q in n)p(q);});}};f.exports=j;}),null);
__d('FantaTabViewportManager',['Arbiter','DockTabsViewportCalculator','DockTabsViewportFantaTabUtils','FantaTabActions','immutable','ifRequired','isWebMessengerURI','setImmediate'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('DockTabsViewportCalculator').getInstance(i);if(!j)return;j.registerFantaTabCallbacks({fantaTabModelStateGetter:function k(){var l=c('immutable').Map({});c('ifRequired')('FantaAppStore',function(m){l=m.getState().tabGroup.tabs;});return l;},onAvailableWidthChanged:function k(l){c('setImmediate')(function(){c('FantaTabActions').setAllowedRaisedTabs(c('DockTabsViewportFantaTabUtils').getTabCountToFitWidth(l));});}});c('Arbiter').subscribe('FantaReducersDockCalculator/shouldRecalculate',function(){j.forceRecalculateChatTabs();});j.forceRecalculateFBDockWidth();c('Arbiter').subscribe('page_transition',function(k,l){if(c('isWebMessengerURI')(l.uri))c('setImmediate')(function(){return c('FantaTabActions').minimizeAllTabs();});});}f.exports={init:h};}),null);
__d('HotLikeSound',['MercurySoundsConfig','SoundPlayer','StickerConstants'],(function a(b,c,d,e,f,g){'use strict';var h=[c('MercurySoundsConfig').hot_like_grow_mp3_url,c('MercurySoundsConfig').hot_like_grow_ogg_url],i=[c('MercurySoundsConfig').hot_like_pop_mp3_url,c('MercurySoundsConfig').hot_like_pop_ogg_url],j=[c('MercurySoundsConfig').hot_like_outgoing_small_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_small_ogg_url],k=[c('MercurySoundsConfig').hot_like_outgoing_medium_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_medium_ogg_url],l=[c('MercurySoundsConfig').hot_like_outgoing_large_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_large_ogg_url],m=function o(){return false;},n={setCheckSoundEnabledFunc:function o(p){m=p;},start:function o(){this._play(h);},stop:function o(){c('SoundPlayer').stop(h);},pop:function o(){this.stop();this._play(i);},snap:function o(p){this.stop();if(p===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function o(p){if(m())c('SoundPlayer').play(p);}};f.exports=n;}),null);
__d('mercuryRogerRe',['bs_array','Arbiter','utilsRe','bs_caml_obj','JSLogger','immutable','bs_js_boolean','CurrentUser','bs_js_primitive','MercuryThreads','MercuryDispatcher','MercuryActionStatus'],(function a(b,c,d,e,f,g){'use strict';var h={};function i(q,r,s,t){var u=+(r>=q.timestamp),v=q.status,w=1-t||c('bs_caml_obj').caml_notequal(s,q.author);if(u!==0){if(c('bs_js_primitive').is_nil_undef(v)){if(w!==0){return 1;}else return 0;}else if(w!==0&&c('bs_caml_obj').caml_equal(v,c('MercuryActionStatus').SUCCESS)){return 1;}else return 0;}else return 0;}function j(q,r,s){if(c('bs_js_primitive').is_nil_undef(r)){return [];}else{var t=q[0][r.thread_id];if(t!==undefined){return t.reduce(function(u,v,w,x){if(i(r,v.watermark,w,c('utilsRe').isTruthy(s))){return c('bs_array').append(u,[w]);}else return u;},[]);}else return [];}}function k(q,r){var s=q[0][r.thread_id];if(s!==undefined){return c('bs_js_boolean').to_js_boolean(s.reduce(function(t,u,v,w){if(t){return i(r,u.watermark,v,0);}else return 0;},1));}else return false;}function l(q,r){var s=q[0][r];if(s!==undefined){return s;}else return c('immutable').OrderedMap();}function m(q,r,s){var t=q[0][r];if(t!==undefined){var u=t.get(s);if(u!==undefined){return u;}else return null;}else return null;}function n(q){var r=h[q];if(r!==undefined){return r;}else{var s=[{}],t=new (c('Arbiter'))(),u={__fbid:q,getSeenBy:function y(z,aa){return j(s,z,aa);},wasSeenByAll:function y(z){return k(s,z);},getSeenTimestamp:function y(z,aa){return m(s,z,aa);},getSeenTimestamps:function y(z){return l(s,z);},subscribe:function y(z,aa){return t.subscribe(z,aa);},mockInform:function y(z,aa){t.inform(z,aa);return 0;}};h[q]=u;var v=[[]],w=c('MercuryDispatcher').getForFBID(q),x=c('MercuryThreads').getForFBID(q);w.subscribe("update-roger",function(y,z){if(c('bs_js_primitive').is_nil_undef(z)){return 0;}else{Object.keys(z).forEach(function(aa){var ba=x.getThreadMetaNow(aa);Object.keys(z[aa]).forEach(function(da){var ea=s[0][aa],fa=ea!==undefined?ea:c('immutable').OrderedMap(),ga=c('bs_js_primitive').is_nil_undef(ba)?0:[ba.participants],ha=0;if(ga){if(ga[0].indexOf(da)===-1){v[0].push(fa);return 0;}else ha=1;}else ha=1;if(ha===1){var ia=fa.get(da),ja=z[aa][da],ka=0;if(ia!==undefined){if(ja.watermark<=ia.watermark){return 0;}else ka=2;}else ka=2;if(ka===2){s[0][aa]=fa.set(da,ja);return 0;}}});var ca=s[0][aa];if(ca!==undefined){s[0][aa]=ca.sort(function(da,ea){return da.watermark-ea.watermark|0;});return 0;}else return 0;});t.inform("change",z);return 0;}});w.subscribe("invalidate-global-state",function(y,z){s[0]={};v[0]=[];return 0;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(y,z){z.read_receipts={valid_receipts:s[0],bad_receipts:v[0]};return 0;});return u;}}function o(){return n(c('CurrentUser').getID());}var p=c('utilsRe').$pipe$unknown;g.$pipe$unknown=p;g.rogersPerFBID=h;g._wasSeen=i;g.getSeenBy=j;g.wasSeenByAll=k;g.getSeenTimestamps=l;g.getSeenTimestamp=m;g.getForFBID=n;g.get=o;}),null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','mercuryRogerRe','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','mixin','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){var h,i,j=c('MercuryConfig')['roger.seen_delay'];h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o);}.bind(this));}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c('mercuryRogerRe').getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe('change',function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p);}.bind(this));this.$MercuryDelayedRoger3=c('MercuryThreadInformer').getForFBID(m);this.$MercuryDelayedRoger6=c('MercuryMessages').getForFBID(m);this.$MercuryDelayedRoger7=c('MercuryThreads').getForFBID(m);this.$MercuryDelayedRoger3.subscribe('messages-received',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-reordered',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-updated',this.$MercuryDelayedRoger9);}k.prototype.getSeenBy=function(m,n){'use strict';if(this.$MercuryDelayedRoger5[m])return [];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n);};k.prototype.wasSeenByAll=function(m){'use strict';if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m));};k.prototype.$MercuryDelayedRoger10=function(m){'use strict';if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp};}return this.$MercuryDelayedRoger4[m];};k.prototype.$MercuryDelayedRoger11=function(m){'use strict';var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c('MercuryActionStatus').SUCCESS)q-=c('LiveTimer').getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m];}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c('setTimeoutAcrossTransitions')(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m);}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true;}.bind(this));return n;};k.prototype.$MercuryDelayedRoger8=function(m){'use strict';var n={};n[m]=true;this.$MercuryDelayedRoger12(n);};k.prototype.$MercuryDelayedRoger12=function(m){'use strict';this.inform('state-changed',m);this.inform('change');};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this.$MercuryDeliveryReceipts2=l;this.$MercuryDeliveryReceipts3=new (c('Map'))();this.$MercuryDeliveryReceipts1=c('MercuryDispatcher').getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(m,n){if(n.delivery_receipts)for(var o in n.delivery_receipts){var p=n.delivery_receipts[o],q=this.$MercuryDeliveryReceipts3.get(o)||0;if(p>q){this.$MercuryDeliveryReceipts3.set(o,p);this.informDeliveryStatusChanged(o);}}}.bind(this));}j.getForFBID=function(l){'use strict';return k.getForFBID(l);};j.get=function(){'use strict';return k.get();};j.prototype.informDeliveryStatusChanged=function(l){'use strict';var m=new (c('Map'))();m.set(l,true);this.inform('change',m);};j.prototype.getDeliveryTime=function(l){'use strict';return this.$MercuryDeliveryReceipts3.get(l)||0;};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;}),null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c('MercuryThreadIDMap').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c('MercuryDispatcher').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c('MercuryServerRequests').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(k,l){return this.$MercuryDelayedDispatcher7();}.bind(this));}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push({thread_fbid:k,payload:j});}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k);};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2.shift(),k=j.thread_fbid,l=j.payload;this.handleUpdateWaitForThread(l,k);}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(j);}else this.$MercuryDelayedDispatcher6.handleUpdate(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncChannelMonitor',['Arbiter','ChannelConstants','CurrentUser','MercurySingletonProvider','MercurySyncFakeDFFSender'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.handleAwfulChannelEvent=function(){if(!c('CurrentUser').isLoggedInNow()){this.killSubscriptions();return;}c('MercurySyncFakeDFFSender').getForFBID(this.$MercurySyncChannelMonitor1).sendGlobalDFF();}.bind(this);this.$MercurySyncChannelMonitor1=j;this.$MercurySyncChannelMonitor2=false;}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.setupSubscriptions=function(){if(!this.$MercurySyncChannelMonitor2){this.$MercurySyncChannelMonitor4=c('Arbiter').subscribe(c('ChannelConstants').JUMPSTART,this.handleAwfulChannelEvent);this.$MercurySyncChannelMonitor3=c('Arbiter').subscribe(c('ChannelConstants').THROTTLED,this.handleAwfulChannelEvent);this.$MercurySyncChannelMonitor2=true;}};h.prototype.killSubscriptions=function(){if(this.$MercurySyncChannelMonitor2){c('Arbiter').unsubscribe(this.$MercurySyncChannelMonitor4);c('Arbiter').unsubscribe(this.$MercurySyncChannelMonitor3);this.$MercurySyncChannelMonitor2=false;}};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryMessageCustomizations',[],(function a(b,c,d,e,f,g){'use strict';function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k;});return m.length>0?m[0].customization_value:null;}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]});});return l;}f.exports={getCustomizationValue:h,parseCustomizations:i};}),null);
__d('MercuryProfileRanges',['idx'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(!i.id&&i.i)return {id:i.i,offset:i.o,length:i.l};return i;}f.exports={extractFromDelta:function i(j){var k,l=(k=j)!=null?(k=k.data)!=null?k.prng:k:k;if(!l)return undefined;var m=[];try{m=JSON.parse(l);if(m.length>0)return m.map(h);}catch(n){}return m;}};}),null);
__d("MNCommerceBubbleType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FB_RETAIL_RECEIPT:1,FB_RETAIL_CANCELLATION:2,FB_RETAIL_SHIPMENT:3,FB_RETAIL_SHIPMENT_TRACKING_EVENT_ETA:4,FB_RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:5,FB_RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:6,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:7,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:8,FB_RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:9,FB_RETAIL_SHIPMENT_ETA:10,FB_RETAIL_NOW_IN_STOCK:11,FB_RETAIL_AGENT_ITEM_SUGGESTION:12,FB_RETAIL_AGENT_ITEM_RECEIPT:13,FB_RETAIL_PROMOTIONAL_MSG:14});}),null);
__d('bs_js_undefined',[],(function a(b,c,d,e,f,g){'use strict';function h(k,l){if(k!==undefined){return l(k);}else return undefined;}function i(k,l){if(k!==undefined){return l(k);}else return 0;}function j(k){if(k){return k[0];}else return undefined;}g.bind=h;g.iter=i;g.from_opt=j;}),null);
__d('bs_char',['bs_caml_string','bs_caml_builtin_exceptions'],(function a(b,c,d,e,f,g){'use strict';function h(m){if(m<0||m>255){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Char.chr"];}else return m;}function i(m){var n=0;if(m>=40){if(m!==92){n=m>=127?1:2;}else return "\\\\";}else if(m>=32){if(m>=39){return "\\'";}else n=2;}else if(m>=14){n=1;}else switch(m){case 8:return "\\b";case 9:return "\\t";case 10:return "\\n";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:n=1;break;case 13:return "\\r";}switch(n){case 1:var o=new Array(4);o[0]=92;o[1]=48+(m/100|0)|0;o[2]=48+(m/10|0)%10|0;o[3]=48+m%10|0;return c('bs_caml_string').bytes_to_string(o);case 2:var p=new Array(1);p[0]=m;return c('bs_caml_string').bytes_to_string(p);}}function j(m){if(m>=65&&m<=90||m>=192&&m<=214||m>=216&&m<=222){return m+32|0;}else return m;}function k(m){if(m>=97&&m<=122||m>=224&&m<=246||m>=248&&m<=254){return m-32|0;}else return m;}function l(m,n){return m-n|0;}g.chr=h;g.escaped=i;g.lowercase=j;g.uppercase=k;g.compare=l;}),null);
__d('bs_bytes',['bs_char','bs_list','bs_curry','bs_caml_obj','bs_caml_int32','bs_pervasives','bs_caml_string','bs_caml_builtin_exceptions'],(function a(b,c,d,e,f,g){'use strict';function h(ta,ua){var va=c('bs_caml_string').caml_create_string(ta);c('bs_caml_string').caml_fill_string(va,0,ta,ua);return va;}function i(ta,ua){var va=c('bs_caml_string').caml_create_string(ta);for(var wa=0,xa=ta-1|0;wa<=xa;++wa)va[wa]=c('bs_curry')._1(ua,wa);return va;}var j=[];function k(ta){var ua=ta.length,va=c('bs_caml_string').caml_create_string(ua);c('bs_caml_string').caml_blit_bytes(ta,0,va,0,ua);return va;}function l(ta){return c('bs_caml_string').bytes_to_string(k(ta));}function m(ta){return k(c('bs_caml_string').bytes_of_string(ta));}function n(ta,ua,va){if(ua<0||va<0||ua>(ta.length-va|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.sub / Bytes.sub"];}else{var wa=c('bs_caml_string').caml_create_string(va);c('bs_caml_string').caml_blit_bytes(ta,ua,wa,0,va);return wa;}}function o(ta,ua,va){return c('bs_caml_string').bytes_to_string(n(ta,ua,va));}function p(ta,ua,va){var wa=(ta.length+ua|0)+va|0,xa=c('bs_caml_string').caml_create_string(wa),ya=ua<0?[-ua|0,0]:[0,ua],za=ya[1],ab=ya[0],bb=c('bs_pervasives').min(ta.length-ab|0,wa-za|0);if(bb>0)c('bs_caml_string').caml_blit_bytes(ta,ab,xa,za,bb);return xa;}function q(ta,ua,va,wa){if(ua<0||va<0||ua>(ta.length-va|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.fill / Bytes.fill"];}else return c('bs_caml_string').caml_fill_string(ta,ua,va,wa);}function r(ta,ua,va,wa,xa){if(xa<0||ua<0||ua>(ta.length-xa|0)||wa<0||wa>(va.length-xa|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"Bytes.blit"];}else return c('bs_caml_string').caml_blit_bytes(ta,ua,va,wa,xa);}function s(ta,ua,va,wa,xa){if(xa<0||ua<0||ua>(ta.length-xa|0)||wa<0||wa>(va.length-xa|0)){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.blit / Bytes.blit_string"];}else return c('bs_caml_string').caml_blit_string(ta,ua,va,wa,xa);}function t(ta,ua){for(var va=0,wa=ua.length-1|0;va<=wa;++va)c('bs_curry')._1(ta,ua[va]);return 0;}function u(ta,ua){for(var va=0,wa=ua.length-1|0;va<=wa;++va)c('bs_curry')._2(ta,va,ua[va]);return 0;}function v(ta,ua){if(ua){var va=ua[0],wa=[0],xa=[0];c('bs_list').iter(function(ab){wa[0]=wa[0]+1|0;xa[0]=xa[0]+ab.length|0;return 0;},ua);var ya=c('bs_caml_string').caml_create_string(xa[0]+c('bs_caml_int32').imul(ta.length,wa[0]-1|0)|0);c('bs_caml_string').caml_blit_bytes(va,0,ya,0,va.length);var za=[va.length];c('bs_list').iter(function(ab){c('bs_caml_string').caml_blit_bytes(ta,0,ya,za[0],ta.length);za[0]=za[0]+ta.length|0;c('bs_caml_string').caml_blit_bytes(ab,0,ya,za[0],ab.length);za[0]=za[0]+ab.length|0;return 0;},ua[1]);return ya;}else return j;}function w(ta,ua){return ta.concat(ua);}function x(ta){var ua=ta-9|0;if(ua>4||ua<0){if(ua!==23){return 0;}else return 1;}else if(ua!==2){return 1;}else return 0;}function y(ta){var ua=ta.length,va=0;while(va<ua&&x(ta[va]))va=va+1|0;var wa=ua-1|0;while(wa>=va&&x(ta[wa]))wa=wa-1|0;if(wa>=va){return n(ta,va,(wa-va|0)+1|0);}else return j;}function z(ta){var ua=0;for(var va=0,wa=ta.length-1|0;va<=wa;++va){var xa=ta[va],ya;if(xa>=32){var za=xa-34|0;ya=za>58||za<0?za>=93?4:1:za>57||za<1?2:1;}else ya=xa>=11?xa!==13?4:2:xa>=8?2:4;ua=ua+ya|0;}if(ua===ta.length){return k(ta);}else{var ab=c('bs_caml_string').caml_create_string(ua);ua=0;for(var bb=0,cb=ta.length-1|0;bb<=cb;++bb){var db=ta[bb],eb=0;if(db>=35){if(db!==92){if(db>=127){eb=1;}else ab[ua]=db;}else eb=2;}else if(db>=32){if(db>=34){eb=2;}else ab[ua]=db;}else if(db>=14){eb=1;}else switch(db){case 8:ab[ua]=92;ua=ua+1|0;ab[ua]=98;break;case 9:ab[ua]=92;ua=ua+1|0;ab[ua]=116;break;case 10:ab[ua]=92;ua=ua+1|0;ab[ua]=110;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:eb=1;break;case 13:ab[ua]=92;ua=ua+1|0;ab[ua]=114;break;}switch(eb){case 1:ab[ua]=92;ua=ua+1|0;ab[ua]=48+(db/100|0)|0;ua=ua+1|0;ab[ua]=48+(db/10|0)%10|0;ua=ua+1|0;ab[ua]=48+db%10|0;break;case 2:ab[ua]=92;ua=ua+1|0;ab[ua]=db;break;}ua=ua+1|0;}return ab;}}function aa(ta,ua){var va=ua.length;if(va){var wa=c('bs_caml_string').caml_create_string(va);for(var xa=0,ya=va-1|0;xa<=ya;++xa)wa[xa]=c('bs_curry')._1(ta,ua[xa]);return wa;}else return ua;}function ba(ta,ua){var va=ua.length;if(va){var wa=c('bs_caml_string').caml_create_string(va);for(var xa=0,ya=va-1|0;xa<=ya;++xa)wa[xa]=c('bs_curry')._2(ta,xa,ua[xa]);return wa;}else return ua;}function ca(ta){return aa(c('bs_char').uppercase,ta);}function da(ta){return aa(c('bs_char').lowercase,ta);}function ea(ta,ua){if(ua.length){var va=k(ua);va[0]=c('bs_curry')._1(ta,ua[0]);return va;}else return ua;}function fa(ta){return ea(c('bs_char').uppercase,ta);}function ga(ta){return ea(c('bs_char').lowercase,ta);}function ha(ta,ua,va,wa){while(true){var xa=va;if(xa>=ua){throw c('bs_caml_builtin_exceptions').not_found;}else if(ta[xa]===wa){return xa;}else{va=xa+1|0;continue;}}}function ia(ta,ua){return ha(ta,ta.length,0,ua);}function ja(ta,ua,va){var wa=ta.length;if(ua<0||ua>wa){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.index_from / Bytes.index_from"];}else return ha(ta,wa,ua,va);}function ka(ta,ua,va){while(true){var wa=ua;if(wa<0){throw c('bs_caml_builtin_exceptions').not_found;}else if(ta[wa]===va){return wa;}else{ua=wa-1|0;continue;}}}function la(ta,ua){return ka(ta,ta.length-1|0,ua);}function ma(ta,ua,va){if(ua<-1||ua>=ta.length){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.rindex_from / Bytes.rindex_from"];}else return ka(ta,ua,va);}function na(ta,ua,va){var wa=ta.length;if(ua<0||ua>wa){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.contains_from / Bytes.contains_from"];}else try{ha(ta,wa,ua,va);return 1;}catch(xa){if(xa===c('bs_caml_builtin_exceptions').not_found){return 0;}else throw xa;}}function oa(ta,ua){return na(ta,0,ua);}function pa(ta,ua,va){if(ua<0||ua>=ta.length){throw [c('bs_caml_builtin_exceptions').invalid_argument,"String.rcontains_from / Bytes.rcontains_from"];}else try{ka(ta,ua,va);return 1;}catch(wa){if(wa===c('bs_caml_builtin_exceptions').not_found){return 0;}else throw wa;}}var qa=c('bs_caml_obj').caml_compare,ra=c('bs_caml_string').bytes_to_string,sa=c('bs_caml_string').bytes_of_string;g.make=h;g.init=i;g.empty=j;g.copy=k;g.of_string=m;g.to_string=l;g.sub=n;g.sub_string=o;g.extend=p;g.fill=q;g.blit=r;g.blit_string=s;g.concat=v;g.cat=w;g.iter=t;g.iteri=u;g.map=aa;g.mapi=ba;g.trim=y;g.escaped=z;g.index=ia;g.rindex=la;g.index_from=ja;g.rindex_from=ma;g.contains=oa;g.contains_from=na;g.rcontains_from=pa;g.uppercase=ca;g.lowercase=da;g.capitalize=fa;g.uncapitalize=ga;g.compare=qa;g.unsafe_to_string=ra;g.unsafe_of_string=sa;}),null);
__d('bs_string',['bs_list','bs_bytes','bs_caml_int32','bs_caml_string'],(function a(b,c,d,e,f,g){'use strict';function h(ha,ia){return c('bs_caml_string').bytes_to_string(c('bs_bytes').make(ha,ia));}function i(ha,ia){return c('bs_caml_string').bytes_to_string(c('bs_bytes').init(ha,ia));}function j(ha){return c('bs_caml_string').bytes_to_string(c('bs_bytes').copy(c('bs_caml_string').bytes_of_string(ha)));}function k(ha,ia,ja){return c('bs_caml_string').bytes_to_string(c('bs_bytes').sub(c('bs_caml_string').bytes_of_string(ha),ia,ja));}function l(ha,ia){if(ia){var ja=ia[0],ka=[0],la=[0];c('bs_list').iter(function(oa){ka[0]=ka[0]+1|0;la[0]=la[0]+oa.length|0;return 0;},ia);var ma=c('bs_caml_string').caml_create_string(la[0]+c('bs_caml_int32').imul(ha.length,ka[0]-1|0)|0);c('bs_caml_string').caml_blit_string(ja,0,ma,0,ja.length);var na=[ja.length];c('bs_list').iter(function(oa){c('bs_caml_string').caml_blit_string(ha,0,ma,na[0],ha.length);na[0]=na[0]+ha.length|0;c('bs_caml_string').caml_blit_string(oa,0,ma,na[0],oa.length);na[0]=na[0]+oa.length|0;return 0;},ia[1]);return c('bs_caml_string').bytes_to_string(ma);}else return "";}function m(ha,ia){return c('bs_bytes').iter(ha,c('bs_caml_string').bytes_of_string(ia));}function n(ha,ia){return c('bs_bytes').iteri(ha,c('bs_caml_string').bytes_of_string(ia));}function o(ha,ia){return c('bs_caml_string').bytes_to_string(c('bs_bytes').map(ha,c('bs_caml_string').bytes_of_string(ia)));}function p(ha,ia){return c('bs_caml_string').bytes_to_string(c('bs_bytes').mapi(ha,c('bs_caml_string').bytes_of_string(ia)));}function q(ha){var ia=ha-9|0;if(ia>4||ia<0){if(ia!==23){return 0;}else return 1;}else if(ia!==2){return 1;}else return 0;}function r(ha){if(ha===""||!(q(ha.charCodeAt(0))||q(ha.charCodeAt(ha.length-1|0)))){return ha;}else return c('bs_caml_string').bytes_to_string(c('bs_bytes').trim(c('bs_caml_string').bytes_of_string(ha)));}function s(ha){var ia=function ja(ka){while(true){var la=ka;if(la>=ha.length){return 0;}else{var ma=ha.charCodeAt(la);if(ma>=32){var na=ma-34|0;if(na>58||na<0){if(na>=93){return 1;}else{ka=la+1|0;continue;}}else if(na>57||na<1){return 1;}else{ka=la+1|0;continue;}}else return 1;}}};if(ia(0)){return c('bs_caml_string').bytes_to_string(c('bs_bytes').escaped(c('bs_caml_string').bytes_of_string(ha)));}else return ha;}function t(ha,ia){return c('bs_bytes').index(c('bs_caml_string').bytes_of_string(ha),ia);}function u(ha,ia){return c('bs_bytes').rindex(c('bs_caml_string').bytes_of_string(ha),ia);}function v(ha,ia,ja){return c('bs_bytes').index_from(c('bs_caml_string').bytes_of_string(ha),ia,ja);}function w(ha,ia,ja){return c('bs_bytes').rindex_from(c('bs_caml_string').bytes_of_string(ha),ia,ja);}function x(ha,ia){return c('bs_bytes').contains(c('bs_caml_string').bytes_of_string(ha),ia);}function y(ha,ia,ja){return c('bs_bytes').contains_from(c('bs_caml_string').bytes_of_string(ha),ia,ja);}function z(ha,ia,ja){return c('bs_bytes').rcontains_from(c('bs_caml_string').bytes_of_string(ha),ia,ja);}function aa(ha){return c('bs_caml_string').bytes_to_string(c('bs_bytes').uppercase(c('bs_caml_string').bytes_of_string(ha)));}function ba(ha){return c('bs_caml_string').bytes_to_string(c('bs_bytes').lowercase(c('bs_caml_string').bytes_of_string(ha)));}function ca(ha){return c('bs_caml_string').bytes_to_string(c('bs_bytes').capitalize(c('bs_caml_string').bytes_of_string(ha)));}function da(ha){return c('bs_caml_string').bytes_to_string(c('bs_bytes').uncapitalize(c('bs_caml_string').bytes_of_string(ha)));}var ea=c('bs_caml_string').caml_string_compare,fa=c('bs_bytes').fill,ga=c('bs_bytes').blit_string;g.make=h;g.init=i;g.copy=j;g.sub=k;g.fill=fa;g.blit=ga;g.concat=l;g.iter=m;g.iteri=n;g.map=o;g.mapi=p;g.trim=r;g.escaped=s;g.index=t;g.rindex=u;g.index_from=v;g.rindex_from=w;g.contains=x;g.contains_from=y;g.rcontains_from=z;g.uppercase=aa;g.lowercase=ba;g.capitalize=ca;g.uncapitalize=da;g.compare=ea;}),null);
__d('messengerStoryAttachmentTransformerRe',['fbt','URI','bs_array','bs_string','bs_caml_array','bs_js_boolean','bs_caml_format','CurrentUser','bs_js_primitive','bs_js_undefined','FundsAvailability','bs_js_null_undefined','P2PTransferStatus','MNCommerceBubbleType','PaymentModulesClient','MercuryAttachmentType','bs_caml_builtin_exceptions','P2PPaymentRequestStatus','ServicesCalendarSyncType','MNCommerceCallToActionType','MNCommerceShipmentTrackingEventTypes','LeadGenInfoFieldTypes'],(function a(b,c,d,e,f,g,h){'use strict';function i(qa){return c('bs_array').map(function(ra){var sa=ra.user_confirmation,ta=c('bs_js_primitive').is_nil_undef(sa)?[null,null,null,null,false]:[sa.cancel_button_label,sa.continue_button_label,sa.confirmation_message,sa.confirmation_title,true],ua=ra.payment_metadata;return {action_link:ra.action_link,action_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceCallToActionType')[ra.action_open_type])),title:ra.title,confirmation_cancel_label:ta[0],confirmation_continue_label:ta[1],confirmation_message:ta[2],confirmation_title:ta[3],id:ra.id,is_disabled:ra.is_disabled,is_mutable_by_server:ra.is_mutable_by_server,payment_metadata:c('bs_js_primitive').is_nil_undef(ua)?{payment_module_config:null,total_price:null}:{payment_module_config:ua.payment_module_config,total_price:ua.total_price},render_style:ra.render_style,webview_metadata:{messenger_extensions:ra.webview_metadata.messenger_extensions,webview_height_ratio:ra.webview_metadata.webview_height_ratio,webview_share_button:ra.webview_metadata.webview_share_button},should_show_user_confirmation:ta[4]};},qa);}function j(qa){return c('bs_array').map(function(ra){var sa=ra.url,ta=c('bs_js_primitive').is_nil_undef(sa)?null:new (c('URI'))(sa).getUnqualifiedURI().toString();return {title:ra.title,uri:ta};},qa);}function k(qa){if(!c('bs_js_primitive').is_nil_undef(qa)&&qa!==""){return "#"+c('bs_string').sub(qa,2,qa.length-2|0);}else return null;}function l(qa){if(c('bs_js_primitive').is_nil_undef(qa)){return null;}else return {url:qa.uri,src:qa.uri,width:qa.width,height:qa.height};}function m(qa){return {id:qa.id,name:qa.name,desc:qa.desc,thumb_url:qa.thumb_url,item_url:qa.item_url,title:qa.name,text:qa.desc,source:qa.source,image_aspect_ratio:qa.image_aspect_ratio,metalines:{metaline_1:qa.first_metaline,metaline_2:qa.second_metaline,metaline_3:qa.third_metaline},call_to_actions:i(qa.call_to_actions)};}function n(qa){return {city:qa.city,country:qa.country,latitude:qa.latitude,longitude:qa.longitude,postal_code:qa.postal_code,state:qa.state,street_1:qa.streets.length?c('bs_caml_array').caml_array_get(qa.streets,0):null,street_2:qa.streets.length>1?c('bs_caml_array').caml_array_get(qa.streets,1):null,timezone:qa.timezone};}function o(qa){var ra=qa.retail_carrier,sa=qa.shipdate_for_display,ta={};c('bs_array').iter(function(za){var ab=za.messenger_commerce_location;if(c('bs_js_primitive').is_nil_undef(ab)){return 0;}else{ta[za.id]=n(ab);return 0;}},qa.shipment_tracking_events.nodes);var ua={};c('bs_array').iter(function(za){var ab=m(za);ua[ab.id]=ab;return 0;},qa.retail_shipment_items.nodes);var va=ra.logo,wa=ra.legal_terms_of_service_text,xa=qa.receipt,ya=qa.recipient;return {id:qa.id,shipment_id:qa.id,tracking_number:qa.tracking_number,carrier:ra.name,carrier_tracking_url:ra.carrier_tracking_url,carrier_logo:c('bs_js_primitive').is_nil_undef(va)?null:{url:va.uri,width:va.width,height:va.height},display_ship_date:sa,estimated_delivery_display_time:qa.estimated_delivery_time_for_display,origin:n(qa.commerce_origin),destination:n(qa.commerce_destination),items:ua,tracking_event_polyline:ta,legal_text:c('bs_js_primitive').is_nil_undef(wa)?null:wa.text,receipt_id:c('bs_js_primitive').is_nil_undef(xa)?null:xa.receipt_id,recipient_name:c('bs_js_primitive').is_nil_undef(ya)?null:ya.name,delivered:c('bs_array').fold_left(function(za,ab){if(ab.shipment_tracking_event_type==="DELIVERED"){return true;}else return za;},false,qa.shipment_tracking_events.nodes),messenger_commerce_bubble_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceBubbleType')[qa.bubble_type]))};}function p(qa){var ra=qa.shipment.estimated_delivery_time_for_display,sa=qa.shipment.shipdate_for_display,ta=qa.shipment.retail_carrier,ua={};c('bs_array').iter(function(xa){var ya=xa.messenger_commerce_location;if(c('bs_js_primitive').is_nil_undef(ya)){return 0;}else{ua[xa.id]=n(ya);return 0;}},qa.shipment.shipment_tracking_events.nodes);var va=qa.messenger_commerce_location,wa=ta.logo;return {id:qa.id,shipment_id:qa.shipment.id,tracking_number:qa.shipment.tracking_number,display_ship_date:sa,estimated_delivery_display_time:ra===""?sa:ra,origin:n(qa.shipment.commerce_origin),destination:n(qa.shipment.commerce_destination),carrier:ta.name,carrier_tracking_url:ta.carrier_tracking_url,display_time:qa.tracking_event_time_for_display,tracking_event_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceShipmentTrackingEventTypes')[qa.shipment_tracking_event_type])),tracking_event_location:c('bs_js_primitive').is_nil_undef(va)?null:n(va),tracking_event_description:qa.tracking_event_description,tracking_event_polyline:ua,carrier_logo:c('bs_js_primitive').is_nil_undef(wa)?null:{url:wa.uri,width:wa.width,height:wa.height},items:c('bs_array').map(m,qa.shipment.retail_shipment_items.nodes),messenger_commerce_bubble_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceBubbleType')[qa.bubble_type])),delivered:c('bs_js_boolean').to_js_boolean(+(qa.shipment_tracking_event_type==="DELIVERED"))};}function q(qa){var ra=qa.itinerary_legs.nodes,sa=[],ta=[];c('bs_array').iter(function(ua){var va=ua.segments.nodes;c('bs_array').iter(function(wa){var xa=wa.flight_info;sa.push({departure_datetime_for_display:xa.departure_time_info.formatted_datetime_for_display,destination_airport_code:xa.arrival_airport.airport_code,destination_airport_name:xa.arrival_airport.city,labels:ua.number_of_stops_label,source_airport_code:xa.departure_airport.airport_code,source_airport_name:xa.departure_airport.city});return 0;},va);c('bs_array').iter(function(wa){var xa=wa.flight_info,ya=xa.arrival_time_info;ta.push({flight_info:{aircraft_type:xa.aircraft_type,arrival_airport:{airport_code:xa.arrival_airport.airport_code,city:xa.arrival_airport.city,terminal:xa.arrival_airport.terminal},arrival_time:c('bs_js_primitive').is_nil_undef(ya)?null:ya.formatted_time_for_display,departure_airport:{airport_code:xa.departure_airport.airport_code,city:xa.departure_airport.city,terminal:xa.departure_airport.terminal},departure_date:xa.departure_time_info.formatted_date_for_display,departure_time:xa.departure_time_info.formatted_time_for_display,flight_number:xa.flight_number},passenger:c('bs_array').map(function(za){return {name:za.passenger.name,passenger:{name:za.passenger.name,ticket_number:za.passenger.ticket_number},product_infos:c('bs_array').map(function(ab){return {title:ab.title,value:ab.value};},za.product_items),seat:za.seat,seat_type:za.seat_type,travel_class:za.travel_class};},wa.passenger_details)});return 0;},va);return 0;},ra);return {base_cost:qa.formatted_base_price,confirmation_number:qa.confirmation_number,logo:l(qa.logo),passenger_names:c('bs_array').map(function(ua){return ua.name;},qa.passenger_infos),pnr_number:qa.pnr_number,price_info:c('bs_array').map(function(ua){return {title:ua.title,value:ua.formatted_amount};},qa.itemized_price_infos),tax:qa.formatted_tax,theme_color:k(qa.tint_color),total_cost:qa.formatted_total,connections:sa,labels:{aircraft_type_label:qa.aircraft_type_label,arrival_time_label:qa.arrival_time_label,base_price_label:qa.base_price_label,booking_number_label:qa.booking_number_label,cabin_type_label:qa.cabin_type_label,departure_time_label:qa.departure_time_label,flight_confirmation_label:qa.flight_confirmation_label,flight_date_label:qa.flight_date_label,flight_label:qa.flight_label,flight_terminal_label:qa.flight_terminal_label,itinerary_error_title_label:qa.itinerary_error_title_label,itinerary_title_label:qa.itinerary_title_label,passenger_name_label:qa.passenger_name_label,passenger_names_label:qa.passenger_names_label,passenger_seat_label:qa.passenger_seat_label,purchase_summary_label:qa.purchase_summary_label,taxes_label:qa.taxes_label,total_label:qa.total_label,view_details_cta_label:qa.view_details_cta_label},flight_segments:ta};}function r(qa){var ra=qa.flight_info,sa=ra.arrival_time_info;return {pnr_number:qa.pnr_number,theme_color:k(qa.tint_color),update_type:qa.update_type,hightlighted_labels:qa.hightlighted_labels,labels:{arrival_time_label:qa.arrival_time_label,booking_number_label:qa.booking_number_label,departure_time_label:qa.departure_time_label,flight_gate_label:qa.flight_gate_label,flight_label:qa.flight_label,flight_status_label:qa.flight_status_label,passenger_names_label:qa.passenger_names_label,passenger_seat_label:qa.passenger_seat_label},logo:l(qa.logo),update_flight_info:{arrival_airport:{airport_code:ra.arrival_airport.airport_code,city:ra.arrival_airport.city},arrival_time:c('bs_js_primitive').is_nil_undef(sa)?null:sa.formatted_time_for_display,departure_airport:{airport_code:ra.departure_airport.airport_code,city:ra.departure_airport.city},departure_gate:ra.departure_airport.gate,flight_number:ra.flight_number,departure_time:ra.departure_time_info.formatted_time_for_display}};}function s(qa){var ra=c('bs_array').map(function(sa){var ta=sa.arrival_time_info;return {arrival_airport:{airport_code:sa.arrival_airport.airport_code,city:sa.arrival_airport.city},departure_airport:{airport_code:sa.departure_airport.airport_code,city:sa.departure_airport.city},flight_number:sa.flight_number,departure_time:sa.departure_time_info.formatted_time_for_display,arrival_time:c('bs_js_primitive').is_nil_undef(ta)?null:ta.formatted_time_for_display};},qa.flight_infos);return {pnr_number:qa.pnr_number,theme_color:k(qa.tint_color),checkin_url:qa.checkin_url,flight_info:ra,labels:{flight_label:qa.flight_label,arrival_time_label:qa.arrival_time_label,departure_time_label:qa.departure_time_label,checkin_cta_label:qa.checkin_cta_label,booking_number_label:qa.booking_number_label},logo:l(qa.logo)};}function t(qa){var ra=qa.boarding_passes.nodes,sa;if(ra.length){var ta=c('bs_caml_array').caml_array_get(ra,0),ua=ta.flight_info,va=ua.boarding_time_info;sa={flight_number:ua.flight_number,boarding_time_for_display:c('bs_js_primitive').is_nil_undef(va)?null:va.formatted_time_for_display,departure_time_for_display:ua.departure_time_info.formatted_time_for_display,departure_terminal:ua.departure_airport.terminal,departure_gate:ua.departure_airport.gate,destination_airport_code:ua.arrival_airport.airport_code,destination_airport_name:ua.arrival_airport.city,source_airport_code:ua.departure_airport.airport_code,source_airport_name:ua.departure_airport.city};}else sa=null;return {flight_information:sa,theme_color:k(qa.tint_color),passenger_seat_assignment:c('bs_array').map(function(wa){return {name:wa.passenger.passenger.name,seat:wa.passenger.seat};},ra),labels:{flight_label:qa.flight_label,boarding_time_label:qa.boarding_time_label,departure_label:qa.departure_label,passenger_names_label:qa.passenger_names_label,passenger_seat_label:qa.passenger_seat_label,flight_terminal_label:qa.flight_terminal_label,flight_gate_label:qa.flight_gate_label,view_boarding_pass_cta_label:qa.view_boarding_pass_cta_label,share_cta_label:qa.share_cta_label,message_cta_label:qa.message_cta_label,boarding_pass_title_label:qa.boarding_pass_title_label,boarding_pass_error_title_label:qa.boarding_pass_error_title_label},logo:l(qa.logo),boarding_pass:c('bs_array').map(function(wa){var xa=wa.header_text_field;return {source_page_id:0,logo_image_url:wa.airline_logo_image_url,header_image_url:wa.header_image_url,auxiliary_fields:c('bs_array').map(function(ya){return {label:ya.title,value:ya.value};},wa.auxiliary_fields),secondary_fields:c('bs_array').map(function(ya){return {label:ya.title,value:ya.value};},wa.secondary_fields),qr_code_header_image_url:wa.qr_code_header_image_url,qr_code_url:wa.qr_code_image_url,passenger_name:wa.passenger.passenger.name,header_text_field:c('bs_js_primitive').is_nil_undef(xa)?null:{label:xa.title,value:xa.value}};},ra)};}function u(qa,ra){var sa=ra.cover_photo,ta;if(c('bs_js_primitive').is_nil_undef(sa)){ta=[null,null,null];}else{var ua=sa.photo.image,va=c('bs_js_primitive').is_nil_undef(ua)?[null,null]:[ua.uri,{height:ua.height,width:ua.width}];ta=[sa.photo.id,va[0],va[1]];}var wa=ra.location,xa=c('bs_js_primitive').is_nil_undef(wa)?[null,null]:[wa.latitude,wa.longitude],ya=ra.overall_star_rating;return {address:ra.address.single_line_full_address,category:ra.top_category_name,coverPhotoID:ta[0],coverPhotoURL:ta[1],coverPhotoDimensions:ta[2],latitude:xa[0],longitude:xa[1],name:ra.name,rating:c('bs_js_primitive').is_nil_undef(ya)?null:ya.value,pageID:ra.id,priceRange:ra.price_range_description,viewerID:qa};}function v(qa){var ra=qa.group_commerce_item_seller,sa=qa.primary_photo,ta;if(c('bs_js_primitive').is_nil_undef(sa)){ta=null;}else{var ua=sa.image;ta=c('bs_js_primitive').is_nil_undef(ua)?null:ua.uri;}return {caption:qa.group_commerce_item_description.text,desc:qa.group_commerce_item_description.text,owner_id:c('bs_js_primitive').is_nil_undef(ra)?null:ra.id,price:qa.formatted_price.text,text:qa.group_commerce_item_description.text,title:qa.group_commerce_item_title,thumb_url:ta,url:qa.url};}function w(qa){return {app_name:qa.application_name,artists:qa.artist_names,audio_url:qa.audio_url,duration_ms:qa.duration_ms,title:qa.music_title};}function x(qa){var ra=qa.payment;return {id:qa.id,desc:qa.desc,display_total_cost:qa.total_cost,merchant_name:qa.merchant_name,target_url:qa.target_url,thumb_url:qa.thumb_url,raw_amount:qa.raw_amount,payment_id:c('bs_js_primitive').is_nil_undef(ra)?null:ra.id,total_cost:{amount:c('bs_caml_format').caml_float_of_string(qa.price_amount),currency:qa.price_currency},name:qa.name};}function y(qa){return {id:qa.id,canDonate:qa.canDonate,hasViewerDonated:qa.hasViewerDonated,fundraiserDetailedProgressText:qa.fundraiserDetailedProgressText,fundraiserSubtitleText:qa.fundraiserSubtitleText,focusedCoverPhoto:qa.focusedCoverPhoto};}function z(qa){return {id:qa.id,name:qa.name,desc:qa.desc,thumb_url:qa.thumb_url,item_url:qa.item_url,title:qa.name,text:qa.desc,source:qa.source,image_aspect_ratio:qa.image_aspect_ratio,metalines:{metaline_1:qa.first_metaline,metaline_2:qa.second_metaline,metaline_3:qa.third_metaline},call_to_actions:i(qa.call_to_actions)};}function aa(qa){var ra=qa.guestStatus,sa=qa.event_place,ta=qa.social_context;return {eventID:qa.eventID,guestStatus:c('bs_js_primitive').is_nil_undef(ra)?"unknown":c('bs_string').lowercase(ra),canViewerJoin:qa.canViewerJoin,timeString:qa.timeString,locationString:c('bs_js_primitive').is_nil_undef(sa)?null:sa.name,socialOrTimeContextString:c('bs_js_primitive').is_nil_undef(ta)?null:ta.text,connectedButtonText:h._("Joined"),unconnectedButtonText:h._("Going"),watchStatus:c('bs_string').lowercase(qa.watchStatus),showInterestedAction:c('bs_js_boolean').to_js_boolean(+(qa.connection_style==="INTERESTED")),canViewerWatch:qa.canViewerWatch};}function ba(qa){var ra=function qb(rb){var sb=rb.page_call_to_action;if(c('bs_js_primitive').is_nil_undef(sb)){return undefined;}else return sb.id;},sa=function qb(rb){var sb=rb.page_call_to_action;if(c('bs_js_primitive').is_nil_undef(sb)){return false;}else{var tb=sb.component_flow_service_config;if(c('bs_js_primitive').is_nil_undef(tb)){return false;}else return true;}},ta=qa.page,ua=c('bs_js_primitive').is_nil_undef(ta)?[undefined,undefined,undefined,false]:[ta.id,c('bs_js_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('ServicesCalendarSyncType')[ta.calendar_sync_type])),ra(ta),sa(ta)],va=qa.native_component_flow_request,wa;if(c('bs_js_primitive').is_nil_undef(va)){wa=null;}else{var xa=va.page,ya=va.page,za=va.page,ab;if(c('bs_js_primitive').is_nil_undef(za)){ab=undefined;}else{var bb=za.profile_picture;ab=c('bs_js_primitive').is_nil_undef(bb)?undefined:bb.uri;}var cb=va.suggested_time_range,db=va.product_item,eb=va.product_item,fb=va.product_item,gb=va.product_item,hb;if(c('bs_js_primitive').is_nil_undef(gb)){hb=undefined;}else{var ib=gb.profile_picture;hb=c('bs_js_primitive').is_nil_undef(ib)?undefined:ib.uri;}var jb=va.user,kb=va.user,lb=va.user,mb;if(c('bs_js_primitive').is_nil_undef(lb)){mb=undefined;}else{var nb=lb.profile_picture;mb=c('bs_js_primitive').is_nil_undef(nb)?undefined:nb.uri;}wa={requestAdminApprovalType:va.request_admin_approval_type,availability:va.availability,calendarSyncType:c('bs_js_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('ServicesCalendarSyncType')[va.calendar_sync_type])),hasSavedToCalendar:va.has_saved_to_calendar,generalInfo:va.service_general_info,id:va.id,pageID:c('bs_js_primitive').is_nil_undef(xa)?undefined:xa.id,pageName:c('bs_js_primitive').is_nil_undef(ya)?undefined:ya.name,pageProfilePic:ab,preferredTimeRange:c('bs_js_primitive').is_nil_undef(cb)?null:{end:cb.end,start:cb.start},price:c('bs_js_primitive').is_nil_undef(db)?null:db.experimental_freeform_price,duration:c('bs_js_primitive').is_nil_undef(eb)?null:eb.duration_in_seconds,requestedTime:va.requested_time,serviceName:c('bs_js_primitive').is_nil_undef(fb)?null:fb.name,serviceProfilePic:hb,specialRequest:va.special_request,status:va.booking_status_value,statusLabel:va.status,userID:c('bs_js_primitive').is_nil_undef(jb)?undefined:jb.id,username:c('bs_js_primitive').is_nil_undef(kb)?undefined:kb.short_name,userProfilePic:mb};}var ob=qa.message_bubble_type,pb;switch(ob){case "CANCELLED":pb=["Cancelled",h._("Cancelled")];break;case "DECLINED":pb=["Declined",h._("Declined")];break;case "REQUESTED":pb=["Requested",h._("Requested")];break;case "SCHEDULEED":pb=["Scheduled",h._("Scheduled")];break;default:throw [c('bs_caml_builtin_exceptions').invalid_argument,"Erroneous target status"];}return {id:qa.id,pageID:ua[0],calendarSyncType:ua[1],ctaID:ua[2],hasServiceConfig:ua[3],userID:qa.user.id,status:pb[0],statusLabel:pb[1],viewerID:c('CurrentUser').getAccountID(),requestMetadata:wa};}function ca(qa){return {live_location_id:qa.live_location_id,is_expired:c('bs_js_boolean').to_js_boolean(qa.is_expired),expiration_time:qa.expiration_time,sender:qa.sender,coordinate:qa.coordinate,location_title:qa.location_title,sender_destination:qa.sender_destination,stop_reason:qa.stop_reason};}function da(qa){var ra=qa.first_metaline;return {desc:qa.description,id:qa.id,image_aspect_ratio:qa.image_aspect_ratio,item_url:qa.target_url,metalines:c('bs_js_primitive').is_nil_undef(ra)?{}:{metaline_1:ra},name:qa.name,source:qa.source_name,text:qa.description,thumb_url:qa.image_url,title:qa.name,call_to_actions:i(qa.call_to_actions),media_blob_attachments:qa.media_blob_attachments};}function ea(qa){var ra=c('bs_array').map(da,qa.business_items.nodes),sa=i(qa.call_to_actions);return {message:qa.message,call_to_actions:sa,items:ra};}function fa(qa){return {message:qa.message,call_to_actions:i(qa.call_to_actions),items:c('bs_array').map(da,qa.promotion_items.nodes)};}function ga(qa){var ra=qa.partner_logo;return {account_holder_name:qa.account_holder_name,adjustments:c('bs_array').map(function(sa){return {adjustment_type:sa.adjustment_type,display_adjustment_amount:sa.adjustment_amount};},qa.adjustments),cancellation_url:qa.cancellation_url,items:c('bs_array').map(da,qa.items.nodes),merchant_name:qa.merchant_name,messenger_commerce_bubble_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceBubbleType')[qa.messenger_commerce_bubble_type])),order_id:qa.order_id,order_time:qa.order_time,order_url:qa.order_url,payment_method:qa.payment_method,receipt_id:qa.receipt_id,recipient_name:qa.recipient_name,shipping_cost:qa.shipping_cost,shipping_method:qa.shipping_method,status:qa.status,structured_address:{city:qa.structured_address.city,state:qa.structured_address.state,country:qa.structured_address.country,postal_code:qa.structured_address.postal_code,street_1:c('bs_caml_array').caml_array_get(qa.structured_address.streets,0),street_2:c('bs_caml_array').caml_array_get(qa.structured_address.streets,1)},subtotal:qa.subtotal,total_cost:qa.total_cost,total_tax:qa.total_tax,partner_logo:c('bs_js_primitive').is_nil_undef(ra)?undefined:ra.uri};}function ha(qa,ra){return {payment_modules_client:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('PaymentModulesClient')[ra.payment_modules_client])),is_viewer_seller:ra.is_viewer_seller,payment_snippet:ra.payment_snippet,item_list:c('bs_array').map(function(sa){return {item_id:sa.item_id,name:sa.name,subtitle:sa.subtitle,description:sa.description,unit_price:sa.unit_price,image_urls:c('bs_array').map(function(ta){return ta.uri;},sa.images),quantity:sa.quantity};},ra.item_list),components:ra.components,payment_call_to_actions:ra.payment_call_to_actions,click_action:ra.click_action,actor_id:qa,invoicer_id:ra.invoicer_id};}var ia=function qa(ra){var sa=c("LeadGenInfoFieldTypes"),ta={},ua=[];for(var va=ra.field_data_list,wa=Array.isArray(va),xa=0,va=wa?va:va[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ya;if(wa){if(xa>=va.length)break;ya=va[xa++];}else{xa=va.next();if(xa.done)break;ya=xa.value;}var za=ya,ab=za.field_type,bb=za.label,cb=za.values;if(ab===sa.CUSTOM){ua.push({label:bb,values:cb});}else ta[ab]={label:bb,values:cb};}ta.questions=ua;return ta;};function ja(qa,ra){var sa=ra.invite_recipient,ta=c('bs_js_primitive').is_nil_undef(sa)?null:sa.id,ua=ra.invite_sender,va=c('bs_js_primitive').is_nil_undef(ua)?null:ua.id;return {quick_invite_id:ra.id,recipient_id:ta,sender_id:va,is_viewer_recipient:c('bs_js_boolean').to_js_boolean(+(qa===ta))};}function ka(qa){var ra=function ua(va){if(c('bs_js_primitive').is_nil_undef(va)){return null;}else return va.uri;},sa=qa.listing_category,ta=c('bs_js_primitive').is_nil_undef(sa)?[null,null]:[sa.offer_image,sa.request_image];return {listingType:qa.listing_type,mapURI:ra(qa.map_image),offerURI:ra(ta[0]),requestURI:ra(ta[1])};}function la(qa){var ra=qa.receiver_profile,sa;if(c('bs_js_primitive').is_nil_undef(ra)){sa=null;}else{var ta=ra.profile_picture;sa={id:ra.id,name:ra.short_name,full_name:ra.name,picture:c('bs_js_primitive').is_nil_undef(ta)?null:ta.uri,profile_url:ra.url};}var ua=qa.sender,va;if(c('bs_js_primitive').is_nil_undef(ua)){va={};}else{var wa=ua.profile_picture;va={id:ua.id,name:ua.name,full_name:ua.full_name,picture:c('bs_js_primitive').is_nil_undef(wa)?null:wa.uri,profile_uri:ua.url};}var xa=qa.transfer_context,ya;if(c('bs_js_primitive').is_nil_undef(xa)){ya=[null,null,null];}else{var za=xa.transfer_theme;ya=[xa.memoText,c('bs_array').map(function(cb){var db=cb.image;if(c('bs_js_primitive').is_nil_undef(db)){return null;}else return db.uri;},xa.memo_images),c('bs_js_primitive').is_nil_undef(za)?null:za.id];}var ab=qa.platform_item,bb=c('bs_js_primitive').is_nil_undef(ab)?null:{name:ab.name,description:ab.description,image:c('bs_array').map(function(cb){var db=cb.image;if(c('bs_js_primitive').is_nil_undef(db)){return null;}else return db.uri;},ab.photos),refURL:ab.url};return {sender:va,amountWithSymbol:qa.transaction_amount.formatted_amount,status:c('bs_js_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('P2PTransferStatus')[qa.transfer_status])),receiver:sa,transfer_id:qa.transfer_id,completedTime:qa.completedTime,updatedTime:qa.updatedTime,creationTime:qa.creationTime,amount:qa.transaction_amount.amount,memoText:ya[0],memoPhotoURLs:ya[1],themeID:ya[2],discountAmount:qa.amount_fb_discount.formatted,fundsAvailability:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('FundsAvailability')[qa.funds_availability])),groupThreadFBID:qa.group_thread_fbid,platform_item:bb,statusDescription:{markup:qa.status_description}};}function ma(qa){var ra=qa.requester,sa;if(c('bs_js_primitive').is_nil_undef(ra)){sa=undefined;}else{var ta=ra.profile_picture;sa={id:ra.id,name:ra.short_name,full_name:ra.name,picture:c('bs_js_primitive').is_nil_undef(ta)?null:ta.uri,profile_url:ra.url};}var ua=qa.requestee,va;if(c('bs_js_primitive').is_nil_undef(ua)){va=undefined;}else{var wa=ua.profile_picture;va={id:ua.id,name:ua.short_name,full_name:ua.name,picture:c('bs_js_primitive').is_nil_undef(wa)?null:wa.uri,profile_url:ua.url};}var xa=c('bs_js_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('P2PPaymentRequestStatus')[qa.request_status])),ya=qa.transfer,za=c('bs_js_primitive').is_nil_undef(ya)?[null,""]:[la(ya),ya.id],ab=qa.request_theme;return {amount:qa.transaction_amount.amount,amountWithSymbol:qa.amount.formatted,requestee:va,requester:sa,currentStatus:xa,currency:qa.amount.currency,creationTime:qa.creation_time,groupThreadFBID:qa.group_thread_fbid,id:qa.id,memoText:qa.memo_text,themeID:c('bs_js_primitive').is_nil_undef(ab)?null:ab.id,transfer:za[0],transferID:za[1],updatedTime:qa.updated_time,statusDescription:{markup:qa.status_description}};}function na(qa){var ra=ma({amount:qa.amount,transaction_amount:qa.transaction_amount,requester:qa.requester,requestee:qa.requestee,request_status:qa.request_status,request_theme:qa.request_theme,id:qa.id,memo_text:qa.memo_text,transfer:qa.transfer,creation_time:qa.creation_time,group_thread_fbid:qa.group_thread_fbid,updated_time:qa.updated_time,status_description:qa.status_description}),sa={individualRequests:c('bs_array').map(ma,qa.individual_requests)};return Object.assign(ra,sa);}function oa(qa,ra){var sa=ra.media,ta=c('bs_js_primitive').is_nil_undef(sa)?null:sa.animated_image,ua=c('bs_js_primitive').is_nil_undef(sa)?null:sa.image,va={};c('bs_array').iter(function(jb){var kb=jb.value;va[jb.key]=c('bs_js_primitive').is_nil_undef(kb)?null:kb.text;return 0;},ra.properties);var wa=ra.target,xa;if(c('bs_js_primitive').is_nil_undef(wa)){xa=null;}else switch(wa.tag|0){case 0:xa=ka(wa[0]);break;case 1:xa=la(wa[0]);break;case 2:xa=na(wa[0]);break;case 3:xa=ha(qa,wa[0]);break;case 6:xa=fa(wa[0]);break;case 7:xa=ea(wa[0]);break;case 9:xa=ia(wa[0]);break;case 10:xa=ca(wa[0]);break;case 11:xa=ja(qa,wa[0]);break;case 12:xa=ba(wa[0]);break;case 13:var ya=wa[0],za=ya.genie_sender,ab=c('bs_js_primitive').is_nil_undef(za)?[null,null]:[za.messaging_actor.id,za.messaging_actor.name],bb=ab[0],cb=ya.story_attachment,db=c('bs_js_primitive').is_nil_undef(cb)?null:pa(qa,{legacy_attachment_id:bb,story_attachment:{action_links:cb.action_links,messaging_attribution:cb.messaging_attribution,deduplication_key:cb.deduplication_key,description:cb.description,media:cb.media,properties:cb.properties,source:cb.source,style_list:cb.style_list,title_with_entities:cb.title_with_entities,url:cb.url,subattachments:[],target:null}});xa={genie_id:bb,genie_name:ab[1],attachment:db};break;case 14:xa=aa(wa[0]);break;case 15:xa=w(wa[0]);break;case 17:xa=z(wa[0]);break;case 18:xa=x(wa[0]);break;case 19:xa=y(wa[0]);break;case 20:xa=ga(wa[0]);break;case 22:xa=v(wa[0]);break;case 23:xa=u(qa,wa[0]);break;case 25:xa=t(wa[0]);break;case 26:xa=s(wa[0]);break;case 27:xa=r(wa[0]);break;case 28:xa=q(wa[0]);break;case 29:xa=p(wa[0]);break;case 30:xa=o(wa[0]);break;default:xa=wa[0];}var eb=ra.target,fb=!c('bs_js_primitive').is_nil_undef(eb)&&eb.tag===6?0:null,gb=ra.description,hb=ra.source,ib=ra.title_with_entities;return {description:c('bs_js_primitive').is_nil_undef(gb)?null:gb.text,media:{animated_image:c('bs_js_primitive').is_nil_undef(ta)?null:ta.uri,animated_image_size:c('bs_js_primitive').is_nil_undef(ta)?{height:null,width:null}:{height:ta.height,width:ta.width},image:c('bs_js_primitive').is_nil_undef(ua)?null:ua.uri,image_size:c('bs_js_primitive').is_nil_undef(ua)?{height:null,width:null}:{height:ua.height,width:ua.width},duration:c('bs_js_primitive').is_nil_undef(sa)?null:sa.playable_duration,playable:c('bs_js_primitive').is_nil_undef(sa)?null:sa.is_playable,source:c('bs_js_primitive').is_nil_undef(sa)?null:sa.playable_url},source:c('bs_js_primitive').is_nil_undef(hb)?null:hb.text,style_list:ra.style_list,title:c('bs_js_primitive').is_nil_undef(ib)?null:ib.text,action_links:j(ra.action_links),messaging_attribution:ra.messaging_attribution,properties:va,uri:ra.url,deduplication_key:ra.deduplication_key,target:xa,label:fb};}function pa(qa,ra){var sa=ra.story_attachment,ta;if(c('bs_js_primitive').is_nil_undef(sa)){ta=null;}else{var ua={share_id:ra.legacy_attachment_id,subattachments:c('bs_array').map(function(wa){return oa(qa,wa);},sa.subattachments)},va={description:sa.description,media:sa.media,source:sa.source,style_list:sa.style_list,title_with_entities:sa.title_with_entities,properties:sa.properties,url:sa.url,deduplication_key:sa.deduplication_key,action_links:sa.action_links,messaging_attribution:sa.messaging_attribution,target:sa.target};ta=Object.assign(ua,oa(qa,va));}return {app_attribution:null,attach_type:c('MercuryAttachmentType').SHARE,name:null,url:null,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:null,metadata:null,share:ta,thumbnail_url:null};}g._getCallToActions=i;g._getActionLinks=j;g._getColor=k;g._getLogo=l;g._getCommerceLocation=n;g._getMessengerRetailShipmentTarget=o;g._getShipmentTrackingEventTarget=p;g._getAirlineItineraryMessageTarget=q;g._getAirlineUpdateMessageTarget=r;g._getAirlineCheckInReminderTarget=s;g._getAirlineBoardingPassCollectionTarget=t;g._getPageTarget=u;g._getGroupCommerceProductItemTarget=v;g._getExternalSongTarget=w;g._getAgentSuggestionItemTarget=x;g._getFundraiserTarget=y;g._getRetailItemTarget=z;g._getEventTarget=aa;g._getPagesPlatformBookingMessageTarget=ba;g._getMessageLiveLocationTarget=ca;g._getBusinessRetailItem=da;g._getMessengerBusinessMessageTarget=ea;g._getMessengerRetailPromotionTarget=fa;g._getMessengerRetailReceiptTarget=ga;g._getPagesPlatformAttachmentTarget=ha;g._getPagesPlatformLeadGenInfoTarget=ia;g._getQuickInviteTarget=ja;g._getCrisisListingTarget=ka;g._getP2PTransferTarget=la;g._getP2PTransferRequestTarget=ma;g._getP2PTransferRequestWithIndividualRequests=na;g.transformStoryAttachment=oa;g.getExtensibleAttachmentPayload=pa;}),null);
__d('messengerAttachmentTransformerRe',['fbt','bs_array','bs_js_boolean','bs_pervasives','bs_js_primitive','MercuryAttachmentType','MercuryAttachmentContentType','messengerStoryAttachmentTransformerRe'],(function a(b,c,d,e,f,g,h){'use strict';function i(q){if(q.is_malicious){return {app_attribution:null,icon_type:c('MercuryAttachmentContentType').UNKNOWN,metadata:null,name:null,preview_height:null,preview_url:null,preview_width:null,rel:null,share:null,thumbnail_url:null,url:null,attach_type:c('MercuryAttachmentType').ERROR,error_msg:h._("This attachment has been marked as malicious."),url_shimhash:null,url_skipshim:null};}else{var r=q.attribution_app,s;if(c('bs_js_primitive').is_nil_undef(r)){s=null;}else{var t=r.square_logo;s={id:r.id,icon_url:c('bs_js_primitive').is_nil_undef(t)?null:t.uri,metadata:q.attribution_metadata,name:r.name};}var u=q.url;return {app_attribution:s,icon_type:q.content_type,metadata:null,name:q.filename,preview_height:null,preview_url:null,preview_width:null,rel:"ignore",share:null,thumbnail_url:null,url:c('bs_js_primitive').is_nil_undef(u)?null:u,attach_type:c('MercuryAttachmentType').FILE,error_msg:undefined,url_shimhash:q.url_shimhash,url_skipshim:q.url_skipshim};}}function j(q,r,s){var t=q.chat_image,u=c('bs_js_primitive').is_nil_undef(t)?[null,null,null]:[t.uri,t.width,t.height],v=u[0],w=q.chat_image,x=c('bs_js_primitive').is_nil_undef(w)?null:{width:w.width,height:w.height},y=q.large_image,z=c('bs_js_primitive').is_nil_undef(y)?[null,null]:[y.uri,{width:y.width,height:y.height}],aa=q.inbox_image,ba=c('bs_js_primitive').is_nil_undef(aa)?[null,null]:[aa.uri,{width:aa.width,height:aa.height}],ca=q.attribution_app,da;if(c('bs_js_primitive').is_nil_undef(ca)){da=null;}else{var ea=ca.square_logo;da={id:ca.id,icon_url:c('bs_js_primitive').is_nil_undef(ea)?null:ea.uri,metadata:q.attribution_metadata,name:ca.name};}return {app_attribution:da,attach_type:c('MercuryAttachmentType').VIDEO,name:q.filename,url:q.playable_url,rel:"async",preview_url:v,preview_width:u[1],preview_height:u[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c('MercuryAttachmentContentType').VIDEO,metadata:{fbid:q.legacy_attachment_id,render_as_sticker:c('bs_js_boolean').to_js_boolean(+(q.video_type==="SPEAKING_STICKER")),dimensions:{width:q.original_dimensions.x,height:q.original_dimensions.y},duration:q.playable_duration_in_ms,large_size:z[1],large_preview:z[0],chat_size:x,chat_preview:v,inbox_size:ba[1],inbox_preview:ba[0],pageid:s?r:undefined},thumbnail_url:v,share:null};}function k(q){var r=q.attribution_app,s;if(c('bs_js_primitive').is_nil_undef(r)){s=null;}else{var t=r.square_logo;s={id:r.id,icon_url:c('bs_js_primitive').is_nil_undef(t)?null:t.uri,metadata:q.attribution_metadata,name:r.name};}return {app_attribution:s,attach_type:c('MercuryAttachmentType').FILE,name:q.filename,url:q.playable_url,rel:"ignore",preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c('MercuryAttachmentContentType').MUSIC,metadata:{duration:q.playable_duration_in_ms,isVoicemail:q.is_voicemail?"1":"0",type:q.audio_type==="VOICE_MESSAGE"?"fb_voice_message":q.audio_type==="VOICE_MESSAGE_WITH_TRANSCRIPT"?"fb_voice_message_with_transcript":"file_attachment"},thumbnail_url:null,share:null,url_shimhash:q.url_shimhash,url_skipshim:q.url_skipshim};}function l(q,r,s){var t=q.preview_image,u=c('bs_js_primitive').is_nil_undef(t)?[null,null,null]:[t.uri,t.width,t.height],v=q.animated_image,w=c('bs_js_primitive').is_nil_undef(v)?null:v.uri,x=q.attribution_app,y;if(c('bs_js_primitive').is_nil_undef(x)){y=null;}else{var z=x.square_logo;y={id:x.id,icon_url:c('bs_js_primitive').is_nil_undef(z)?null:z.uri,metadata:q.attribution_metadata,name:x.name};}return {app_attribution:y,attach_type:c('MercuryAttachmentType').ANIMATED_IMAGE,name:q.filename,url:w,rel:"async",preview_url:u[0],preview_width:u[1],preview_height:u[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c('MercuryAttachmentContentType').PHOTO,metadata:{fbid:q.legacy_attachment_id,image:w,dimensions:c('bs_pervasives').string_of_int(q.original_dimensions.x)+(","+c('bs_pervasives').string_of_int(q.original_dimensions.y)),pageid:s?r:undefined},thumbnail_url:w,share:null};}function m(q){var r=q.original_extension==="gif"?c('MercuryAttachmentType').ANIMATED_IMAGE:q.render_as_sticker?c('MercuryAttachmentType').THIRDPARTYSTICKER:c('MercuryAttachmentType').PHOTO,s=q.preview,t=c('bs_js_primitive').is_nil_undef(s)?[null,null,null]:[s.uri,s.width,s.height],u;if(r===c('MercuryAttachmentType').PHOTO){var v=q.large_preview;u=c('bs_js_primitive').is_nil_undef(v)?[null,null,null]:[v.uri,v.width,v.height];}else u=[null,null,null];var w=q.attribution_app,x;if(c('bs_js_primitive').is_nil_undef(w)){x=null;}else{var y=w.square_logo;x={id:w.id,icon_url:c('bs_js_primitive').is_nil_undef(y)?null:y.uri,metadata:q.attribution_metadata,name:w.name};}var z=q.thumbnail;return {app_attribution:x,attach_type:r,name:q.filename,url:null,rel:"async",preview_url:t[0],preview_width:t[1],preview_height:t[2],large_preview_url:u[0],large_preview_width:u[1],large_preview_height:u[2],icon_type:c('MercuryAttachmentContentType').PHOTO,metadata:{fbid:q.legacy_attachment_id,dimensions:c('bs_pervasives').string_of_int(q.original_dimensions.x)+(","+c('bs_pervasives').string_of_int(q.original_dimensions.y))},thumbnail_url:c('bs_js_primitive').is_nil_undef(z)?null:z.uri,share:null};}function n(q,r){var s=r,t=q;if(q>=r){var u=c('bs_pervasives').min(120,t/2),v=u/(t/2);return [u|0,s/2*v|0];}else{var w=c('bs_pervasives').min(120,s/2),x=w/(s/2);return [t/2*x|0,w|0];}}function o(q){var r=n(q.width,q.height),s=q.pack,t=q.sprite_image,u=q.sprite_image_2x,v=q.padded_sprite_image,w=q.padded_sprite_image_2x;return {app_attribution:null,attach_type:c('MercuryAttachmentType').STICKER,name:null,url:q.url,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c('MercuryAttachmentContentType').UNKNOWN,metadata:{accessibilityLabel:q.label,stickerID:q.id,packID:c('bs_js_primitive').is_nil_undef(s)?null:s.id,frameCount:q.frame_count,frameRate:q.frame_rate,framesPerRow:q.frame_count>1?q.frames_per_row:1,framesPerCol:q.frame_count>1?q.frames_per_column:1,height:r[1],width:r[0],spriteURI:c('bs_js_primitive').is_nil_undef(t)?null:t.uri,spriteURI2x:c('bs_js_primitive').is_nil_undef(u)?null:u.uri,paddedSpriteURI:c('bs_js_primitive').is_nil_undef(v)?null:v.uri,paddedSpriteURI2x:c('bs_js_primitive').is_nil_undef(w)?null:w.uri,thumbnail_url:null,share:null}};}function p(q,r,s){var t=[],u=r.extensible_attachment;if(!c('bs_js_primitive').is_nil_undef(u))t.push(c('messengerStoryAttachmentTransformerRe').getExtensibleAttachmentPayload(q,u));var v=r.sticker;if(!c('bs_js_primitive').is_nil_undef(v))t.push(o(v));var w=r.blob_attachments;if(!c('bs_js_primitive').is_nil_undef(w))c('bs_array').iter(function(x){switch(x.tag|0){case 0:t.push(m(x[0]));return 0;case 1:t.push(l(x[0],q,s));return 0;case 2:t.push(k(x[0]));return 0;case 3:t.push(j(x[0],q,s));return 0;case 4:t.push(i(x[0]));return 0;}},w);return t;}g._getFilePayload=i;g._getVideoPayload=j;g._getAudioPayload=k;g._getAnimatedImagePayload=l;g._getImagePayload=m;g._getStickerDimensions=n;g._getStickerPayload=o;g.transformAttachment=p;}),null);
__d("InstantGameUpdateXMATUpdateType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({UNKNOWN:"unknown",GAME_SCORE:"game_score",CUSTOM_MESSAGE:"custom_message"});}),null);
__d('MessagingTagUtils',['MessagingSourceEnum','MessagingTagConstants','MercuryMessageSourceTags','Set'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('Set'))(Object.values(c('MessagingSourceEnum')));function i(l){for(var m=l,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;if(h.has(q))return q;}return c('MessagingSourceEnum').UNKNOWN;}function j(l){for(var m=l,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p,r=q.split(c('MessagingTagConstants').app_id_root);if(r.length>1)return r[1].trim();}return null;}function k(l,m){var n=[],o=j(l);if(o&&c('MessagingTagConstants').orca_app_ids.indexOf(o)!==-1)n.push(c('MercuryMessageSourceTags').MESSENGER);if(c('MessagingTagConstants').chat_sources.indexOf(m)!==-1)n.push(c('MercuryMessageSourceTags').CHAT);if(c('MessagingTagConstants').email_source===m)n.push(c('MercuryMessageSourceTags').EMAIL);if(c('MessagingTagConstants').mobile_sources.indexOf(m)!==-1)n.push(c('MercuryMessageSourceTags').MOBILE);return n;}f.exports={getSourceFromTags:i,getSourceTags:k};}),null);
__d('messengerMessageTransformerRe',['FBID','bs_array','bs_block','bs_string','getByPath','bs_js_boolean','MercuryIDs','bs_pervasives','bs_caml_format','CurrentUser','bs_js_primitive','MessagingTag','bs_js_null_undefined','MercuryActionType','MessagingTagUtils','MessagingSourceEnum','StoryAttachmentStyle','MNCommerceMessageType','MercuryLogMessageType','MessagingGenericAdminTextType','InstantGameUpdateXMATUpdateType','messengerAttachmentTransformerRe'],(function a(b,c,d,e,f,g){'use strict';function h(o,p,q){var r;if(o.__typename==="GroupPollExtensibleMessageAdminText"){var s=Object.assign({},o.question);Object.assign(s,{total_count:o.total_count,options:c('bs_array').map(function(t){var u=Object.assign({},t);return Object.assign(u,{total_count:t.voters.nodes.length,voters:c('bs_array').map(function(v){return v.id;},t.voters.nodes)});},o.question.options.nodes)});r={message_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingGenericAdminTextType')[p])),untypedData:{event_type:c('bs_string').lowercase(o.event_type),question_id:o.question.id,question_json:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(JSON.stringify(s)))}};}else r=o.__typename==="InstantGameUpdateExtensibleMessageAdminText"?{message_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingGenericAdminTextType')[p])),untypedData:{game_id:c('getByPath')(o,["game","id"]),update_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('InstantGameUpdateXMATUpdateType')[o.update_type])),collapsed_text:o.collapsed_text,expanded_text:o.expanded_text,cta_url:c('getByPath')(o,["instant_game_update_data","cta_url"]),cta_title:c('getByPath')(o,["instant_game_update_data","cta_title"]),custom_image_url:c('getByPath')(o,["instant_game_update_data","photo","image","uri"])}}:o.__typename==="ThemeColorExtensibleMessageAdminText"||o.__typename==="ThreadIconExtensibleMessageAdminText"||o.__typename==="ThreadNicknameExtensibleMessageAdminText"||o.__typename==="AcceptPendingThreadExtensibleMessageAdminText"||o.__typename==="AddContactExtensibleMessageAdminText"||o.__typename==="RtcCallLogExtensibleMessageAdminText"||o.__typename==="GameScoreExtensibleMessageAdminText"||o.__typename==="ConfirmFriendRequestExtensibleMessageAdminText"||o.__typename==="PartiesInviteExtensibleMessageAdminText"?{message_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingGenericAdminTextType')[p])),untypedData:Object.assign({},o)}:{message_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingGenericAdminTextType')[p])),untypedData:undefined};return {log_message_body:q,log_message_data:r,log_message_type:c('MercuryLogMessageType').GENERIC_ADMIN_TEXT};}function i(o){return c('bs_array').map(function(p){if(p==="p2p_transfer"){return c('StoryAttachmentStyle').ORION;}else if(p==="p2p_payment_request"){return c('StoryAttachmentStyle').ORION_REQUEST;}else return p;},o);}function j(o){var p=o.target,q;if(c('bs_js_primitive').is_nil_undef(p)){q=null;}else if(p.__typename==="CrisisListing"){q=c('bs_block').__(0,[{listing_type:p.listing_type,listing_category:p.listing_category,map_image:p.map_image}]);}else if(p.__typename==="PeerToPeerTransfer"){q=c('bs_block').__(1,[{sender:p.sender,receiver_profile:p.receiver_profile,transaction_amount:p.transaction_amount,transfer_status:p.transfer_status,transfer_id:p.transfer_id,completedTime:p.completedTime,updatedTime:p.updatedTime,creationTime:p.creationTime,transfer_context:p.transfer_context,amount_fb_discount:p.amount_fb_discount,funds_availability:p.funds_availability,group_thread_fbid:p.group_thread_fbid,platform_item:p.platform_item,id:p.id,status_description:p.status_description}]);}else if(p.__typename==="PeerToPeerPaymentRequest"){q=c('bs_block').__(2,[{amount:p.amount,transaction_amount:p.transaction_amount,requester:p.requester,requestee:p.requestee,request_status:p.request_status,request_theme:p.request_theme,id:p.id,memo_text:p.memo_text,transfer:p.transfer,creation_time:p.creation_time,group_thread_fbid:p.group_thread_fbid,updated_time:p.updated_time,status_description:p.status_description,individual_requests:p.individual_requests}]);}else if(p.__typename==="PaymentPlatformAttachment"){q=c('bs_block').__(3,[{payment_modules_client:p.payment_modules_client,is_viewer_seller:p.is_viewer_seller,payment_snippet:p.payment_snippet,item_list:p.item_list,components:p.components,payment_call_to_actions:p.payment_call_to_actions,click_action:p.click_action,invoicer_id:p.invoicer_id}]);}else if(p.__typename==="MomentsAppMessengerInvitation"){q=c('bs_block').__(4,[{snippet:p.snippet}]);}else if(p.__typename==="MomentsAppMessengerPhotoRequest"){q=c('bs_block').__(5,[{snippet:p.snippet}]);}else if(p.__typename==="MessengerRetailPromotion"){q=c('bs_block').__(6,[{message:p.message,call_to_actions:p.call_to_actions,promotion_items:p.promotion_items}]);}else if(p.__typename==="MessengerBusinessMessage"){q=c('bs_block').__(7,[{message:p.message,call_to_actions:p.call_to_actions,business_items:p.business_items}]);}else if(p.__typename==="Video"){q=c('bs_block').__(8,[{video_id:p.video_id}]);}else if(p.__typename==="PagesPlatformLeadGenInfo"){q=c('bs_block').__(9,[{field_data_list:p.field_data_list}]);}else if(p.__typename==="MessageLiveLocation"){q=c('bs_block').__(10,[{live_location_id:p.live_location_id,is_expired:p.is_expired,expiration_time:p.expiration_time,sender:p.sender,coordinate:p.coordinate,location_title:p.location_title,sender_destination:p.sender_destination,stop_reason:p.stop_reason}]);}else if(p.__typename==="QuickInvite"){q=c('bs_block').__(11,[{id:p.id,invite_sender:p.invite_sender,invite_recipient:p.invite_recipient}]);}else if(p.__typename==="PagesPlatformBookingMessage"){q=c('bs_block').__(12,[{id:p.id,page:p.page,message_bubble_type:p.message_bubble_type,user:p.user,native_component_flow_request:p.native_component_flow_request}]);}else if(p.__typename==="GenieMessage"){q=c('bs_block').__(13,[{genie_sender:p.genie_sender,story_attachment:p.story_attachment}]);}else if(p.__typename==="Event"){q=c('bs_block').__(14,[{eventID:p.eventID,guestStatus:p.guestStatus,canViewerJoin:p.canViewerJoin,timeString:p.timeString,event_place:p.event_place,social_context:p.social_context,watchStatus:p.watchStatus,connection_style:p.connection_style,canViewerWatch:p.canViewerWatch}]);}else if(p.__typename==="ExternalSong"){q=c('bs_block').__(15,[{application_name:p.application_name,artist_names:p.artist_names,audio_url:p.audio_url,duration_ms:p.duration_ms,music_title:p.music_title}]);}else if(p.__typename==="LightweightAction"){q=c('bs_block').__(16,[{lwa_state:p.lwa_state,lwa_type:p.lwa_type}]);}else if(p.__typename==="MessengerRetailItem"){q=c('bs_block').__(17,[{id:p.id,name:p.name,desc:p.desc,thumb_url:p.thumb_url,item_url:p.item_url,source:p.source,image_aspect_ratio:p.image_aspect_ratio,first_metaline:p.first_metaline,second_metaline:p.second_metaline,third_metaline:p.third_metaline,call_to_actions:p.call_to_actions}]);}else if(p.__typename==="AgentItemSuggestion"){q=c('bs_block').__(18,[{id:p.id,desc:p.desc,total_cost:p.total_cost,merchant_name:p.merchant_name,target_url:p.target_url,thumb_url:p.thumb_url,raw_amount:p.raw_amount,payment:p.payment,price_amount:p.price_amount,price_currency:p.price_currency,name:p.name}]);}else if(p.__typename==="FundraiserPersonToCharity"||p.__typename==="FundraiserPersonForPerson"){var r=p.fundraiser_detailed_progress_text,s=p.fundraiser_subtitle_text,t=p.focused_cover_photo;q=c('bs_block').__(19,[{id:p.id,canDonate:p.can_donate,hasViewerDonated:p.has_viewer_donated,fundraiserDetailedProgressText:c('bs_js_primitive').is_nil_undef(r)?null:r.text,fundraiserSubtitleText:c('bs_js_primitive').is_nil_undef(s)?null:s.text,focusedCoverPhoto:c('bs_js_primitive').is_nil_undef(t)?null:{src:t.photo.image.uri,data:{height:t.photo.image.height,width:t.photo.image.width}}}]);}else q=p.__typename==="MessengerRetailReceipt"?c('bs_block').__(20,[{account_holder_name:p.account_holder_name,adjustments:p.retail_adjustments,cancellation_url:p.cancellation_url,items:p.retail_items,merchant_name:p.merchant_name,messenger_commerce_bubble_type:p.bubble_type,order_id:p.receipt_id,order_time:p.order_time_for_display,order_url:p.receipt_url,payment_method:p.order_payment_method,receipt_id:p.id,recipient_name:p.recipient_name,shipping_cost:p.shipping_cost,shipping_method:p.shipping_method,status:p.status,structured_address:p.structured_address,subtotal:p.subtotal,total_cost:p.total,total_tax:p.tax,partner_logo:p.partner_log}]):p.__typename==="JobApplication"?c('bs_block').__(21,[{id:p.id}]):p.__typename==="GroupCommerceProductItem"?c('bs_block').__(22,[{group_commerce_item_description:p.group_commerce_item_description,group_commerce_item_seller:p.group_commerce_item_seller,formatted_price:p.formatted_price,group_commerce_item_title:p.group_commerce_item_title,primary_photo:p.primary_photo,url:p.url}]):p.__typename==="Page"?c('bs_block').__(23,[{address:p.address,top_category_name:p.top_category_name,cover_photo:p.cover_photo,location:p.location,name:p.name,overall_star_rating:p.overall_star_rating,id:p.id,price_range_description:p.price_range_description}]):p.__typename==="MessengerEventReminder"?c('bs_block').__(24,[{is_active:p.is_active}]):p.__typename==="AirlineBoardingPassCollectionMessageAttachment"?c('bs_block').__(25,[{tint_color:p.tint_color,logo:p.logo,flight_label:p.flight_label,boarding_time_label:p.boarding_time_label,departure_label:p.departure_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,flight_terminal_label:p.flight_terminal_label,flight_gate_label:p.flight_gate_label,view_boarding_pass_cta_label:p.view_boarding_pass_cta_label,boarding_passes:p.boarding_passes,share_cta_label:p.share_cta_label,message_cta_label:p.message_cta_label,boarding_pass_title_label:p.boarding_pass_title_label,boarding_pass_error_title_label:p.boarding_pass_error_title_label}]):p.__typename==="AirlineCheckInReminderMessageAttachment"?c('bs_block').__(26,[{pnr_number:p.pnr_number,tint_color:p.tint_color,checkin_url:p.checkin_url,booking_number_label:p.booking_number_label,flight_label:p.flight_label,arrival_time_label:p.arrival_time_label,departure_time_label:p.departure_time_label,checkin_cta_label:p.checkin_cta_label,logo:p.logo,flight_infos:p.flight_infos}]):p.__typename==="AirlineUpdateMessageAttachment"?c('bs_block').__(27,[{pnr_number:p.pnr_number,tint_color:p.tint_color,update_type:p.update_type,departure_time_label:p.departure_time_label,arrival_time_label:p.arrival_time_label,booking_number_label:p.booking_number_label,flight_gate_label:p.flight_gate_label,flight_label:p.flight_label,flight_status_label:p.flight_status_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,logo:p.logo,flight_info:p.flight_info,hightlighted_labels:p.hightlighted_labels}]):p.__typename==="AirlineItineraryMessageAttachment"?c('bs_block').__(28,[{confirmation_number:p.confirmation_number,pnr_number:p.pnr_number,tint_color:p.tint_color,formatted_total:p.formatted_total,itemized_price_infos:p.itemized_price_infos,formatted_tax:p.formatted_tax,formatted_base_price:p.formatted_base_price,passenger_infos:p.passenger_infos,logo:p.logo,aircraft_type_label:p.aircraft_type_label,arrival_time_label:p.arrival_time_label,base_price_label:p.base_price_label,booking_number_label:p.booking_number_label,cabin_type_label:p.cabin_type_label,departure_time_label:p.departure_time_label,flight_confirmation_label:p.flight_confirmation_label,flight_date_label:p.flight_date_label,flight_label:p.flight_label,flight_terminal_label:p.flight_terminal_label,itinerary_error_title_label:p.itinerary_error_title_label,itinerary_title_label:p.itinerary_title_label,passenger_name_label:p.passenger_name_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,purchase_summary_label:p.purchase_summary_label,taxes_label:p.taxes_label,total_label:p.total_label,view_details_cta_label:p.view_details_cta_label,itinerary_legs:p.itinerary_legs}]):p.__typename==="MessengerRetailShipmentTrackingEvent"?c('bs_block').__(29,[{id:p.id,shipment:p.shipment,tracking_event_time_for_display:p.tracking_event_time_for_display,shipment_tracking_event_type:p.shipment_tracking_event_type,messenger_commerce_location:p.messenger_commerce_location,tracking_event_description:p.tracking_event_description,bubble_type:p.bubble_type}]):p.__typename==="MessengerRetailShipment"?c('bs_block').__(30,[{id:p.id,tracking_number:p.tracking_number,shipdate_for_display:p.shipdate_for_display,estimated_delivery_time_for_display:p.estimated_delivery_time_for_display,commerce_origin:p.commerce_origin,commerce_destination:p.commerce_destination,retail_carrier:p.retail_carrier,shipment_tracking_events:p.shipment_tracking_events,receipt:p.receipt,recipient:p.recipient,retail_shipment_items:p.retail_shipment_items,bubble_type:p.bubble_type}]):null;return {description:o.description,media:o.media,source:o.source,style_list:i(o.style_list),title_with_entities:o.title_with_entities,properties:o.properties,url:o.url,deduplication_key:o.deduplication_key,action_links:o.action_links,messaging_attribution:o.messaging_attribution,target:q};}function k(o){var p=j({description:o.description,media:o.media,source:o.source,style_list:o.style_list,title_with_entities:o.title_with_entities,properties:o.properties,url:o.url,deduplication_key:o.deduplication_key,action_links:o.action_links,messaging_attribution:o.messaging_attribution,target:o.target});if(c('bs_js_primitive').is_nil_undef(p)){return null;}else{var q=c('bs_array').map(j,o.subattachments);return Object.assign({subattachments:q},p);}}function l(o){var p=o.blob_attachments,q=[];if(!c('bs_js_primitive').is_nil_undef(p))c('bs_array').iter(function(r){if(r.__typename==="MessageImage"){q.push(c('bs_block').__(0,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,preview:r.preview,large_preview:r.large_preview,thumbnail:r.thumbnail,legacy_attachment_id:r.legacy_attachment_id,original_dimensions:r.original_dimensions,original_extension:r.original_extension,render_as_sticker:r.render_as_sticker}]));return 0;}else if(r.__typename==="MessageAnimatedImage"){q.push(c('bs_block').__(1,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,animated_image:r.animated_image,legacy_attachment_id:r.legacy_attachment_id,preview_image:r.preview_image,original_dimensions:r.original_dimensions}]));return 0;}else if(r.__typename==="MessageAudio"){q.push(c('bs_block').__(2,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,playable_url:r.playable_url,playable_duration_in_ms:r.playable_duration_in_ms,is_voicemail:r.is_voicemail,audio_type:r.audio_type,url_shimhash:r.url_shimhash,url_skipshim:r.url_skipshim}]));return 0;}else if(r.__typename==="MessageVideo"){q.push(c('bs_block').__(3,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,playable_url:r.playable_url,playable_duration_in_ms:r.playable_duration_in_ms,legacy_attachment_id:r.legacy_attachment_id,chat_image:r.chat_image,video_type:r.video_type,original_dimensions:r.original_dimensions,large_image:r.large_image,inbox_image:r.inbox_image}]));return 0;}else if(r.__typename==="MessageFile"){q.push(c('bs_block').__(4,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,url:r.url,content_type:r.content_type,is_malicious:r.is_malicious,url_shimhash:r.url_shimhash,url_skipshim:r.url_skipshim}]));return 0;}else return 0;},p);return q;}function m(o){var p=o.message;if(c('bs_js_primitive').is_nil_undef(p)){return [];}else{var q=[];c('bs_array').iter(function(r){var s=r.entity;if(c('bs_js_primitive').is_nil_undef(s)){return 0;}else{var t=s.id,u=s.thread_key;if(c('bs_js_primitive').is_nil_undef(t)){if(c('bs_js_primitive').is_nil_undef(u)){return 0;}else{var v=u.thread_fbid;if(c('bs_js_primitive').is_nil_undef(v)){return 0;}else{q.push({id:v,offset:r.offset,length:r.length,type:r.__typename});return 0;}}}else{q.push({id:t,offset:r.offset,length:r.length,type:r.__typename});return 0;}}},p.ranges);return q;}}function n(o,p,q,r){var s={};c('bs_array').iter(function(qa){s[qa.user.id]=qa.reaction;return 0;},p.message_reactions);var t=+c('FBID').isUser(p.message_sender.id),u=t?c('MessagingTagUtils').getSourceFromTags(p.tags_list):c('MessagingSourceEnum').UNKNOWN,v=t?c('MessagingTagUtils').getSourceTags(p.tags_list,u):[],w=p.commerce_message_type,x=p.customizations,y={thread_id:q.thread_id,thread_fbid:q.thread_fbid,other_user_fbid:q.other_user_fbid,action_type:p.__typename==="UserMessage"?c('MercuryActionType').USER_GENERATED_MESSAGE:c('MercuryActionType').LOG_MESSAGE,message_id:p.message_id,threading_id:null,offline_threading_id:p.offline_threading_id,author:c('MercuryIDs').getParticipantIDFromUserID(p.message_sender.id),author_email:p.message_sender.email,ephemeral_ttl_mode:p.ttl,timestamp:c('bs_caml_format').caml_float_of_string(p.timestamp_precise),is_unread:p.unread,is_filtered_content:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').FILTERED_CONTENT)!==-1)),is_filtered_content_bh:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').FILTERED_CONTENT_BH)!==-1)),is_filtered_content_account:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').FILTERED_CONTENT_ACCOUNT)!==-1)),is_filtered_content_quasar:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').FILTERED_CONTENT_QUASAR)!==-1)),is_filtered_content_invalid_app:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').FILTERED_CONTENT_INVALID_APP)!==-1)),is_sponsored:p.is_sponsored,commerce_message_type:c('bs_js_primitive').is_nil_undef(w)?null:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MNCommerceMessageType')[w])),customizations:c('bs_js_primitive').is_nil_undef(x)?[]:x,source:u,source_tags:v,tags:p.tags_list,is_spoof_warning:c('bs_js_boolean').to_js_boolean(+(p.tags_list.indexOf(c('MessagingTag').DOMAIN_AUTH_FAIL)!==-1||p.tags_list.indexOf(c('MessagingTag').SPAM_SPOOFING)!==-1||p.tags_list.indexOf(c('MessagingTag').SPOOF_WARNING)!==-1)),folder:q.folder,platform_xmd:p.platform_xmd_encoded,message_source:p.message_source_data,montage_reply_data:p.montage_reply_data,skip_bump_thread:false,profile_ranges:m(p),reactions:s};if(p.__typename==="UserMessage"){var z=l(p),aa=p.extensible_attachment,ba;if(c('bs_js_primitive').is_nil_undef(aa)){ba=null;}else{var ca=aa.story_attachment;ba={legacy_attachment_id:aa.legacy_attachment_id,story_attachment:c('bs_js_primitive').is_nil_undef(ca)?null:k(ca)};}var da=c('messengerAttachmentTransformerRe').transformAttachment(o,{extensible_attachment:ba,blob_attachments:z,sticker:p.sticker},r),ea=p.message;Object.assign(y,{body:c('bs_js_primitive').is_nil_undef(ea)?null:ea.text,subject:null,has_attachment:c('bs_js_boolean').to_js_boolean(+(da.length>0)),attachments:da,raw_attachments:null,ranges:undefined,meta_ranges:p.meta_ranges.map(function(qa){return babelHelpers['extends']({},qa,{data:JSON.parse(qa.data)});})});}else if(p.__typename==="VoiceCallMessage"||p.__typename==="VideoCallMessage"){var fa=p.message_sender.id,ga=q.other_user_fbid,ha=c('bs_js_primitive').is_nil_undef(ga)?null:c('MercuryIDs').getParticipantIDFromUserID(fa===ga?c('CurrentUser').getID():ga),ia=p.answered;Object.assign(y,{log_message_type:c('MercuryLogMessageType').PHONE_CALL,log_message_data:{answered:c('bs_js_primitive').is_nil_undef(ia)?false:ia,caller:c('MercuryIDs').getParticipantIDFromUserID(fa),callee:ha},log_message_body:p.snippet});}else if(p.__typename==="ThreadNameMessage"){Object.assign(y,{log_message_type:c('MercuryLogMessageType').THREAD_NAME,log_message_data:{name:p.thread_name},log_message_body:p.snippet});}else if(p.__typename==="ThreadImageMessage"){var ja=p.image_with_metadata,ka;if(c('bs_js_primitive').is_nil_undef(ja)){ka=null;}else{var la=ja.preview;ka={preview_url:c('bs_js_primitive').is_nil_undef(la)?null:la.uri,metadata:{fbid:ja.legacy_attachment_id,dimensions:c('bs_pervasives').string_of_int(ja.original_dimensions.x)+(","+c('bs_pervasives').string_of_int(ja.original_dimensions.y))}};}Object.assign(y,{log_message_type:c('MercuryLogMessageType').THREAD_IMAGE,log_message_data:{image:ka},log_message_body:p.snippet});}else if(p.__typename==="ParticipantsAddedMessage"){var ma=p.participants_added;Object.assign(y,{log_message_type:c('MercuryLogMessageType').SUBSCRIBE,log_message_data:{added_participants:c('bs_js_primitive').is_nil_undef(ma)?[]:c('bs_array').map(function(qa){return c('MercuryIDs').getParticipantIDFromUserID(qa.id);},ma)},log_message_body:p.snippet});}else if(p.__typename==="ParticipantLeftMessage"){var na=p.participants_removed;Object.assign(y,{log_message_type:c('MercuryLogMessageType').UNSUBSCRIBE,log_message_data:{removed_participants:c('bs_js_primitive').is_nil_undef(na)?[]:c('bs_array').map(function(qa){return c('MercuryIDs').getParticipantIDFromUserID(qa.id);},na)},log_message_body:p.snippet});}else if(p.__typename==="GenericAdminTextMessage"){var oa=p.extensible_message_admin_text,pa=p.extensible_message_admin_text_type;if(c('bs_js_primitive').is_nil_undef(oa)){if(!c('bs_js_primitive').is_nil_undef(pa))Object.assign(y,{log_message_body:p.snippet,log_message_data:{message_type:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingGenericAdminTextType')[pa])),untypedData:undefined},log_message_type:c('MercuryLogMessageType').GENERIC_ADMIN_TEXT});}else if(!c('bs_js_primitive').is_nil_undef(pa))Object.assign(y,h(oa,pa,p.snippet));}return y;}g._getGenericAdminTextMessage=h;g._getStyleList=i;g.unsafeCastExtensibleAttachmentWithoutSubattachments=j;g.unsafeCastExtensibleAttachment=k;g.unsafeCastBlobAttachments=l;g._getProfileRanges=m;g.transformMessage=n;}),null);
__d('messengerRealtimeAttachmentTransformerRe',['bs_js_primitive','messengerMessageTransformerRe','messengerAttachmentTransformerRe'],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k){var l=c('messengerMessageTransformerRe').unsafeCastBlobAttachments(j),m=j.extensible_attachment,n;if(c('bs_js_primitive').is_nil_undef(m)){n=null;}else{var o=m.story_attachment;n={legacy_attachment_id:m.legacy_attachment_id,story_attachment:c('bs_js_primitive').is_nil_undef(o)?null:c('messengerMessageTransformerRe').unsafeCastExtensibleAttachment(o)};}return c('messengerAttachmentTransformerRe').transformAttachment(i,{extensible_attachment:n,blob_attachments:l,sticker:j.sticker},k);}g.transform=h;}),null);
__d('MercurySyncNewMessageTransformer',['FBID','IrisProtocolMessageLifetime','MercuryActionType','MercuryConfig','MercuryIDs','MercuryMessageCustomizations','MercuryProfileRanges','MercuryTimestamp','MessagingTag','messengerRealtimeAttachmentTransformerRe'],(function a(b,c,d,e,f,g){'use strict';var h=function j(k){var l={};try{l=JSON.parse(k);}catch(m){}return l;};function i(j,k){var l=parseInt(k.messageMetadata.timestamp,10),m=c('MercuryTimestamp').getFormatedTimestamp(l),n=k.messageMetadata.skipBumpThread,o=j!==k.messageMetadata.actorFbId,p=[];if(k.attachments){p=k.attachments.map(function(r){return r.mercury;});if(c('MercuryConfig').SulfurPostProcessor)p=p.map(function(r){var s=r.extensible_attachment,t=r.blob_attachment,u=r.sticker_attachment;if(!s&&!t&&!u)return null;var v=c('FBID').isUser(j),w=[];if(s){w=c('messengerRealtimeAttachmentTransformerRe').transform(j,{extensible_attachment:s},v);}else if(t){w=c('messengerRealtimeAttachmentTransformerRe').transform(j,{blob_attachments:[t]},v);}else w=c('messengerRealtimeAttachmentTransformerRe').transform(j,{sticker:u});return w.length>0?w[0]:null;});}p=p.filter(Boolean);var q=k.messageMetadata.tags?k.messageMetadata.tags[0]:undefined;return {message_id:k.messageMetadata.messageId,threading_id:null,offline_threading_id:k.messageMetadata.offlineThreadingId,author:c('MercuryIDs').getParticipantIDFromUserID(k.messageMetadata.actorFbId),author_email:k.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:k.ttl?c('IrisProtocolMessageLifetime')[k.ttl]:0,timestamp:l,is_unread:o,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,source:q,tags:k.messageMetadata.tags,is_spoof_warning:false,folder:c('MessagingTag').INBOX,thread_fbid:k.messageMetadata.threadKey.threadFbId,other_user_fbid:k.messageMetadata.threadKey.otherUserFbId,body:k.body!==undefined?k.body:'',html_body:null,subject:null,has_attachment:p.length>0,attachments:p,ranges:undefined,thread_id:null,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(k.data&&k.data.is_sponsored&&k.data.is_sponsored==='true'),commerce_message_type:k.data?k.data.commerce_message_type:null,customizations:k.data&&k.data.customization?c('MercuryMessageCustomizations').parseCustomizations(k.data.customization):null,platform_xmd:k.data&&k.data.platform_xmd?k.data.platform_xmd:null,profile_ranges:c('MercuryProfileRanges').extractFromDelta(k),message_source:k.data&&k.data.message_source_data?h(k.data.message_source_data).message_source:null,skip_bump_thread:n,montage_reply_data:k.data&&k.data.montage_reply_data?h(k.data.montage_reply_data):null,meta_ranges:k.data&&k.data.meta_ranges?h(k.data.meta_ranges):null};}f.exports={transform:i};}),null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c('MercuryLogMessageType').GENERIC_ADMIN_TEXT;return k;}f.exports={transform:h};}),null);
__d("LiveLocationStopReason",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({EXPIRED:1,CANCELED:2,ARRIVED:3});}),null);
__d('MercurySyncClientPayloadTransformer',['DateConsts','LiveLocationStopReason','MercuryActionType','MessageLiveLocationClientSyncProtocolStopReason','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')(c('LiveLocationStopReason')),i=8;function j(o){var p=o.payload;p=JSON.parse(String.fromCharCode.apply(null,p));var q=p&&p.deltas,r=q[0];if(r.deltaMessageReaction){return k(r.deltaMessageReaction);}else if(r.liveLocationData){return m(r.liveLocationData);}else return n(r);}function k(o){var p=o.messageId,q=o.offlineThreadingId,r=o.reaction,s=o.senderId,t=o.userId,u=o.threadKey.threadFbId||o.threadKey.otherUserFbId;return {action_type:c('MercuryActionType').REACTION_UPDATE,messageId:p,offlineThreadingId:q,reaction:l(r),senderId:s,thread_fbid:u.toString(),userId:t};}function l(o){if(!o)return undefined;try{return decodeURIComponent(window.escape(o));}catch(p){}return o;}function m(o){var p=o.threadKey;if(!p)return null;var q=p.threadFbId||p.otherUserFbId;if(!q)return null;if(!o.messageLiveLocations||o.messageLiveLocations.length!==1)return null;var r=o.messageLiveLocations[0],s=r.expirationTime,t=r.stopReason!=null||Date.now()/c('DateConsts').MS_PER_SEC>s,u=function y(z){return z/Math.pow(10,i);},v=r.coordinate?{latitude:u(r.coordinate.latitude),longitude:u(r.coordinate.longitude)}:null,w=null;if(r.destination)w={latitude:u(r.destination.latitude),longitude:u(r.destination.longitude),label:r.destination.label};var x=null;switch(r.stopReason){case c('MessageLiveLocationClientSyncProtocolStopReason').EXPIRED:x=h.EXPIRED;break;case c('MessageLiveLocationClientSyncProtocolStopReason').CANCELED:x=h.CANCELED;break;case c('MessageLiveLocationClientSyncProtocolStopReason').ARRIVED:x=h.ARRIVED;break;}return {action_type:c('MercuryActionType').LIVE_LOCATION_UPDATE,thread_fbid:q.toString(),messageId:r.messageId,liveLocation:{live_location_id:r.id.toString(),is_expired:t,expiration_time:s,sender:{id:r.senderId.toString()},coordinate:v,location_title:r.locationTitle,sender_destination:w,stop_reason:x}};}function n(o){var p=o&&o.deltaPaymentPinProtectionStatusData,q=p&&p.threadKey&&p.threadKey.otherUserFbId,r=p&&p.isPinProtected;if(!q)return null;var s=q.toString();return {action_type:c('MercuryActionType').IS_PIN_PROTECTED,thread_fbid:s,is_pin_protected:r};}f.exports={transform:j};}),null);
__d('MercurySyncDeliveryReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};}),null);
__d('MercurySyncMarkFolderSeenTransformer',['MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_SEEN,folder:c('MessagingTag').IRIS_MAPPING[j],timestamp:parseInt(i.timestamp,10)};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:c('MessagingTag').IRIS_MAPPING[j],timestamp:parseInt(i.watermarkTimestamp,10)};});return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkUnreadTransformer',['MercuryActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:false,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};}f.exports={transform:h};}),null);
__d("PagesMessagingEventType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3});}),null);
__d('MercurySyncPagesManagerEventTransformer',['MercuryActionType','PagesMessagingEventType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=JSON.parse(i.jsonBlob),k=j&&j.type;if(!k)return undefined;switch(k){case c('PagesMessagingEventType').FLAG:var l=!!(j&&j.flagData&&j.flagData.state),m={action_type:c('MercuryActionType').CHANGE_FLAG,mark_as_flag:l,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return m;default:return undefined;}}f.exports={transform:h};}),null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c('MercuryIDs').getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c('MercuryLogMessageType').UNSUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return c('MercuryIDs').getParticipantIDFromUserID(l.userFbId);})};k.log_message_type=c('MercuryLogMessageType').SUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i;k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c('MercuryIDs').getParticipantIDFromUserID(m),caller:c('MercuryIDs').getParticipantIDFromUserID(l)};k.log_message_type=c('MercuryLogMessageType').VIDEO_CALL;return k;}f.exports={transform:h};}),null);
__d('MercurySyncReadReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={watermark:parseInt(i.watermarkTimestampMs,10),action:parseInt(i.actionTimestampMs,10)},k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};}),null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c('MercurySyncNewMessageTransformer').transform(i,j),{action_type:c('MercuryActionType').REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId});}f.exports={transform:h};}),null);
__d('MercurySyncRtcCallDataTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.messageMetadata.threadKey&&i.messageMetadata.threadKey.threadFbId?i.messageMetadata.threadKey.threadFbId.toString():undefined,k=i.initiator&&i.initiator.userFbId?i.initiator.userFbId.toString():undefined;return {action_type:c('MercuryActionType').UPDATE_RTC_CALL_DATA,thread_fbid:j,call_state:i.callState,server_info_data:i.serverInfoData,initiator_fbid:k};}f.exports={transform:h};}),null);
__d("MessagingThreadAction",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"});}),null);
__d('MercurySyncThreadActionTransformer',['MercuryActionType','MessagingThreadAction'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,archived:i.action===c('MessagingThreadAction').ACTION_ARCHIVED};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsAddToGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j.userFbId);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsRemovedFromGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalModeTransformer',['MercuryActionType','MessengerApprovalModeTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').APPROVAL_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,approval_mode:c('MessengerApprovalModeTypes')[i.mode]};}f.exports={transform:h};}),null);
__d("MessengerApprovalQueueTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({REQUESTED:"REQUESTED",REMOVED:"REMOVED"});}),null);
__d('MercurySyncThreadApprovalQueueTransformer',['MercuryActionType','MercuryIDs','MessengerApprovalQueueTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('MercuryIDs').getParticipantIDFromUserID(i.recipientFbId);return {action_type:c('MercuryActionType').APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_id:i.action===c('MessengerApprovalQueueTypes').REMOVED?j:null,added_id:i.action===c('MessengerApprovalQueueTypes').REQUESTED?j:null};}f.exports={transform:h};}),null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId};});}f.exports={transform:h};}),null);
__d('MercurySyncThreadJoinableModeTransformer',['MercuryActionType','MessengerJoinableModeType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').JOINABLE_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,joinable_mode:{mode:c('MessengerJoinableModeType')[i.mode],link:i.link}};}f.exports={transform:h};}),null);
__d('MercurySyncThreadMuteSettingsTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_MUTE_SETTINGS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,mute_until:parseInt(i.expireTime,10)};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c('MercuryLogMessageType').THREAD_NAME;return k;}f.exports={transform:h};}),null);
__d('MercurySyncDispatcher',['MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncThreadAdminsAddToGroupTransformer','MercurySyncThreadAdminsRemovedFromGroupTransformer','MercurySyncAdminTextMessageTransformer','MercurySyncClientPayloadTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkFolderSeenTransformer','MercurySyncMarkReadTransformer','MercurySyncMarkUnreadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncPagesManagerEventTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadMuteSettingsTransformer','MercurySyncThreadNameTransformer','MercurySyncThreadActionTransformer','MercurySyncReplaceMessageTransformer','MercurySyncThreadJoinableModeTransformer','MercurySyncThreadApprovalModeTransformer','MercurySyncThreadApprovalQueueTransformer','MercurySyncRtcCallDataTransformer','MercurySyncDeltaTypes','MercurySingletonProvider','MontageActions'],(function a(b,c,d,e,f,g){'use strict';var h='FOLDER_MONTAGE';i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncDispatcher1=k;this.$MercurySyncDispatcher2=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDispatcher1);}i.prototype.process=function(k){var l=void 0,m=void 0;switch(k['class']){case c('MercurySyncDeltaTypes').NewMessage:l=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ReplaceMessage:l=c('MercurySyncReplaceMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').DeliveryReceipt:l=c('MercurySyncDeliveryReceiptTransformer').transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c('MercurySyncDeltaTypes').MarkRead:l=c('MercurySyncMarkReadTransformer').transform(k);var n=[],o=[];l.forEach(function(p){if(p.action_type===c('MercuryGlobalActionType').MARK_ALL_READ){n.push(p);}else o.push(p);});n.length&&this.$MercurySyncDispatcher5(n);o.length&&this.$MercurySyncDispatcher6(o);break;case c('MercurySyncDeltaTypes').MarkUnread:l=c('MercurySyncMarkUnreadTransformer').transform(k);this.$MercurySyncDispatcher6(l);break;case c('MercurySyncDeltaTypes').ParticipantLeftGroupThread:l=c('MercurySyncParticipantLeftGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ParticipantsAddedToGroupThread:l=c('MercurySyncParticipantsAddedToGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').RTCEventLog:l=c('MercurySyncRTCEventLogTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadName:l=c('MercurySyncThreadNameTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ReadReceipt:l=c('MercurySyncReadReceiptTransformer').transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c('MercurySyncDeltaTypes').AdminTextMessage:l=c('MercurySyncAdminTextMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MessageDelete:m=k.threadKey.threadFbId;if(m&&k.folder&&k.folder===h){c('MontageActions').requestUpdate(m);}else{l=c('MercurySyncMessageDeleteTransformer').transform(k);this.$MercurySyncDispatcher4(l);}break;case c('MercurySyncDeltaTypes').ThreadAction:l=c('MercurySyncThreadActionTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadDelete:l=c('MercurySyncThreadDeleteTransformer').transform(k);this.$MercurySyncDispatcher6(l);break;case c('MercurySyncDeltaTypes').AdminAddedToGroupThread:l=c('MercurySyncThreadAdminsAddToGroupTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').AdminRemovedFromGroupThread:l=c('MercurySyncThreadAdminsRemovedFromGroupTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadMuteSettings:l=c('MercurySyncThreadMuteSettingsTransformer').transform(k);this.$MercurySyncDispatcher6([l]);break;case c('MercurySyncDeltaTypes').PagesManagerEvent:l=c('MercurySyncPagesManagerEventTransformer').transform(k);if(!l)return;this.$MercurySyncDispatcher6([l]);break;case c('MercurySyncDeltaTypes').JoinableMode:l=c('MercurySyncThreadJoinableModeTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ApprovalMode:l=c('MercurySyncThreadApprovalModeTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ApprovalQueue:l=c('MercurySyncThreadApprovalQueueTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ClientPayload:l=c('MercurySyncClientPayloadTransformer').transform(k);if(!l)return;this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').GenieMessage:l=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,k.deltaNewMessage);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MontageMessage:m=k.newMessage.messageMetadata.actorFbId;if(m)c('MontageActions').requestUpdate(m);break;case c('MercurySyncDeltaTypes').RtcCallData:l=c('MercurySyncRtcCallDataTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MarkFolderSeen:l=c('MercurySyncMarkFolderSeenTransformer').transform(k);this.$MercurySyncDispatcher5(l);break;default:break;}};i.prototype.$MercurySyncDispatcher4=function(k){var l=k.other_user_fbid||k.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[k],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE},l);};i.prototype.$MercurySyncDispatcher5=function(k){this.$MercurySyncDispatcher3.handleUpdate({global_actions:k,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};i.prototype.$MercurySyncDispatcher6=function(k){this.$MercurySyncDispatcher3.handleUpdate({actions:k,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncDataFetcherImpl',['errorCode','Promise','AsyncRequest','AsyncResponse','MessagingConfig','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MessagingConfig').syncFetchRequestTimeoutMs;function j(l){return new (c('Promise'))(function(m,n){k(l,m,n,0);});}function k(l,m,n,o){if(o>c('MessagingConfig').syncFetchRetries){n();return;}var p=o===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,o);c('setTimeoutAcrossTransitions')(function(){var q=false,r=function s(t){if(q)return;q=true;if(t instanceof c('AsyncResponse'))if(t.error===1357001||t.error===1340004||t.error===1373034){n(true);return;}k(l,m,n,o+1);};new (c('AsyncRequest'))().setURI(l).setHandler(function(s){q=true;m(s);}).setErrorHandler(r).setTimeoutHandler(i,r).setAllowCrossPageTransition(true).send();},p);}f.exports={fetch:j};}),null);
__d('MercurySyncDataFetcher',['Promise','LogHistory','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_sync_data_fetcher');function i(){var l=0;for(var m=0;m<c('MessagingConfig').syncFetchRetries;m++){var n=m===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,m);l+=n+c('MessagingConfig').syncFetchRequestTimeoutMs;}return l;}var j=i();function k(l){return new (c('Promise'))(function(m,n){var o=function q(r){h.error('fetch_timeout',JSON.stringify({timeout:j,uri:l.toString()}));n(r);},p=c('setTimeoutAcrossTransitions')(o,j);c('MercurySyncDataFetcherImpl').fetch(l).done(function(){clearTimeout(p);m.apply(undefined,arguments);},o);});}f.exports={fetch:k,getMaxTimeoutMs:i};}),null);
__d("XMercuryFetchMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});}),null);
__d("XMercuryInvalidateGlobalStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{cachius_min_seq_id:{type:"Int"}});}),null);
__d("XMercuryInvalidateThreadStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});}),null);
__d('MercurySyncDFFDataFetcher',['Promise','ActorURI','AsyncRequest','MercuryConfig','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c('MercuryMessages').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c('MercuryThreads').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncDFFDataFetcher1);}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.fetchInvalidateGlobalState=function(j){var k=c('XMercuryInvalidateGlobalStateController').getURIBuilder();if(c('MercuryConfig').MessengerCachiusUseClientSeqIDWWW)k.setInt('cachius_min_seq_id',j);var l=k.getURI(),m=c('ActorURI').create(l,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(m);};h.prototype.fetchInvalidateThreadState=function(j,k){var l=11,m=3,n=j||k,o=this.__threadIDMap.getClientIDFromServerIDNow(n);if(!o)return c('Promise').resolve({getPayload:function s(){return {};}});var p=m+this.__messages.getCurrentlyLoadedMessages(o).length,q=c('XMercuryInvalidateThreadStateController').getURIBuilder().setInt('other_user_or_thread_fbid',n).setInt('num_messages',Math.max(p,l)).getURI(),r=c('ActorURI').create(q,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(r);};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=c('XMercuryFetchMessageController').getURIBuilder().setInt('other_user_or_thread_fbid',j||k).setString('mid',l).getURI(),n=c('ActorURI').create(m,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(n);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(k){return {getPayload:function l(){return {sequence_id:k};}};}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c('MercuryMessages').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c('MercurySyncDFFDataFetcher').getForFBID(this.$MercurySyncForcedFetchHandler1);}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c('Promise').resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m);};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId);};i.prototype.processGlobalDFF=function(k){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState(k);};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d("MercurySyncTopicType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DELTA:"delta",DELTAFLOW:"deltaflow",DELTAFLOWREJECT:"deltaflowreject"});}),null);
__d('MercurySyncDeltaHandler',['invariant','Arbiter','ChannelConstants','ChatReliabilityInstrumentation','CurrentUser','LogHistory','MercuryConfig','MessagingConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncChannelMonitor','MercurySyncConstants','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('LogHistory').getInstance('mercury_sync_delta_handler'),j=c('MessagingConfig').syncFetchRetries||0;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){this.$MercurySyncDeltaHandler1=m;this.$MercurySyncDeltaHandler2=c('MercurySyncDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler3=c('MercurySyncForcedFetchHandler').getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c('MercurySyncDeltaHolder').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler10=c('MercurySyncChannelMonitor').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler6=[];this.$MercurySyncDeltaHandler12=0;i.debug('constructor',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));c('Arbiter').subscribe('MercurySyncDeltaHandler/initSeqID',function(n,o){i.debug('initSeqID',JSON.stringify(o));var p=o&&o.seqID,q=o&&o.fbid;if(!q)return;if(q!==this.$MercurySyncDeltaHandler1)return;if(p){this.$MercurySyncDeltaHandler4.updateLastSeqID(p);}else this.$MercurySyncDeltaHandler4.updateLastSeqID(0);this.$MercurySyncDeltaHandler14();this.$MercurySyncDeltaHandler7=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('deltaflow'),function(r,s){if(!this.$MercurySyncDeltaHandler13)this.$MercurySyncDeltaHandler14();}.bind(this));}.bind(this));}k.prototype.$MercurySyncDeltaHandler14=function(){i.debug('setUpSubscriptionsToRealTimeUpdates',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));this.$MercurySyncDeltaHandler9=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('delta'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta,q=n&&n.obj&&n.obj.iseq;if(!p||!q)return;this.$MercurySyncDeltaHandler15(q,c('MercurySyncTopicType').DELTA);this.$MercurySyncDeltaHandler16(q,p);this.$MercurySyncDeltaHandler4.push(q,p);this.$MercurySyncDeltaHandler17();}.bind(this));this.$MercurySyncDeltaHandler11=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('deltaflowreject'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;if(this.$MercurySyncDeltaHandler13)this.$MercurySyncDeltaHandler18();}.bind(this));this.$MercurySyncDeltaHandler8=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o&&o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta;if(!p)return;this.$MercurySyncDeltaHandler6.push(p);this.$MercurySyncDeltaHandler17();}.bind(this));this.$MercurySyncDeltaHandler10.setupSubscriptions();this.$MercurySyncDeltaHandler13=true;};k.prototype.$MercurySyncDeltaHandler17=function(){if(this.$MercurySyncDeltaHandler5)return;if(this.$MercurySyncDeltaHandler6.length>0){var m=this.$MercurySyncDeltaHandler6.shift();this.$MercurySyncDeltaHandler19(this.$MercurySyncDeltaHandler4.getLastSeqID(),m);this.$MercurySyncDeltaHandler17();}var n=this.$MercurySyncDeltaHandler4.peek();if(!n)return;var o=n-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o===1){var p=this.$MercurySyncDeltaHandler4.pop();if(!p)return;var q=p.seqID,r=p.delta;this.$MercurySyncDeltaHandler19(q,r);this.$MercurySyncDeltaHandler17();}else if(o>1){this.$MercurySyncDeltaHandler20();}else{this.$MercurySyncDeltaHandler4.pop();this.$MercurySyncDeltaHandler17();}};k.prototype.$MercurySyncDeltaHandler19=function(m,n){this.$MercurySyncDeltaHandler4.updateLastSeqID(m);if(n['class']===c('MercurySyncDeltaTypes').ForcedFetch){i.debug('DFF',JSON.stringify(n));if(n.threadKey!==undefined&&n.messageId===undefined){this.$MercurySyncDeltaHandler21(m,n);}else if(n.threadKey!==undefined&&n.messageId!==undefined){this.$MercurySyncDeltaHandler22(m,n);}else{c('ChatReliabilityInstrumentation').logDFF_DELTA_INIT(JSON.stringify(n));this.$MercurySyncDeltaHandler23(m);}}else this.$MercurySyncDeltaHandler2.process(n);};k.prototype.$MercurySyncDeltaHandler20=function(){var m=JSON.stringify({$MercurySyncDeltaHandler24:this.$MercurySyncDeltaHandler4.getLastSeqID(),nextSeqID:this.$MercurySyncDeltaHandler4.peek()});i.warn('hole',m);var n=this.$MercurySyncDeltaHandler4.peek();!!n||h(0);var o=n-1;c('ChatReliabilityInstrumentation').logDFF_HOLE_INIT(m);this.$MercurySyncDeltaHandler23(o);};k.prototype.$MercurySyncDeltaHandler25=function(m,n,o,p){!this.$MercurySyncDeltaHandler5||h(0);this.$MercurySyncDeltaHandler5=true;i.debug('_scheduleDataFetch:start',JSON.stringify({seqID:m}));n().done(function(q){i.debug('_scheduleDataFetch:success',JSON.stringify({seqID:m}));o(m,q);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler17();}.bind(this),function(q){i.error('_scheduleDataFetch:failure',JSON.stringify({seqID:m}));p(m,q);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler17();}.bind(this));};k.prototype.$MercurySyncDeltaHandler23=function(m){if(!c('CurrentUser').isLoggedInNow())return;this.$MercurySyncDeltaHandler25(undefined,function(){return this.$MercurySyncDeltaHandler3.processGlobalDFF(m);}.bind(this),function(n,o){var p=o.getPayload();this.__payloadPreprocessor.handleUpdate(p);if(p.sequence_id){i.debug('_initiateGlobalDFF:success',JSON.stringify({seqID:p.sequence_id}));this.$MercurySyncDeltaHandler4.updateLastSeqID(p.sequence_id);}this.$MercurySyncDeltaHandler12=0;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RECOVER);}.bind(this),function(n,o){i.error('_initiateGlobalDFF:failure','');if(this.$MercurySyncDeltaHandler12>=j||o){if(this.$MercurySyncDeltaHandler13)this.$MercurySyncDeltaHandler18();if(c('MercuryConfig').chatDFFUpdateSeqID)this.$MercurySyncDeltaHandler4.updateLastSeqID(m);}else{this.$MercurySyncDeltaHandler12++;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RETRY);i.debug('_initiateGlobalDFF:retry','');this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler23(m);}}.bind(this));};k.prototype.$MercurySyncDeltaHandler21=function(m,n){this.$MercurySyncDeltaHandler25(m,function(){return this.$MercurySyncDeltaHandler3.processThreadDFF(m,n.threadKey,n.isLazy);}.bind(this),function(o,p){this.__payloadPreprocessor.handleUpdate(p.getPayload());this.$MercurySyncDeltaHandler4.updateLastSeqID(o);}.bind(this),function(){i.error('_initiateThreadDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.threadKey;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler22=function(m,n){this.$MercurySyncDeltaHandler25(m,function(){return this.$MercurySyncDeltaHandler3.processMessageDFF(m,n.threadKey,n.messageId,n.isLazy);}.bind(this),function(o,p){var q=p.getPayload(),r=q.other_user_fbid?q.other_user_fbid:q.thread_fbid,s=[babelHelpers['extends']({},q)],t=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:s,payload_source:t},r);this.$MercurySyncDeltaHandler4.updateLastSeqID(o);}.bind(this),function(){i.error('_initiateMessageDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.messageId;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler15=function(m,n){var o=m-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o!==1&&o!==0){if(!c('MercuryConfig').WWWSyncHolesLogging)return;new (c('MercurySyncHolesTypedLogger'))().setSeqID(m).setDifference(o).setTopicType(n).log();}};k.prototype.$MercurySyncDeltaHandler16=function(m,n){switch(n['class']){case c('MercurySyncDeltaTypes').NewMessage:i.debug('message_delta',JSON.stringify({seqID:m,threadKey:n.messageMetadata.threadKey,messageId:n.messageMetadata.messageId}));break;case c('MercurySyncDeltaTypes').ReadReceipt:i.debug('read_receipt_delta',JSON.stringify({seqID:m,threadKey:n.threadKey,actionTimestampMs:n.actionTimestampMs,watermarkTimestampMs:n.watermarkTimestampMs}));break;case c('MercurySyncDeltaTypes').DeliveryReceipt:i.debug('delivery_receipt_delta',JSON.stringify({seqID:m,deliveredWatermarkTimestampMs:n.deliveredWatermarkTimestampMs,messageIds:n.messageIds}));break;}};k.prototype.$MercurySyncDeltaHandler18=function(){this.$MercurySyncDeltaHandler13=false;c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler9);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler8);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler11);this.$MercurySyncDeltaHandler10.killSubscriptions();c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercurySyncEnvironment',['Arbiter','ChannelInitialData','CurrentUser','MercurySyncDeltaHandler'],(function a(b,c,d,e,f,g){'use strict';function h(){if(!c('ChannelInitialData').channelConfig)return;c('MercurySyncDeltaHandler').get();c('Arbiter').inform('MercurySyncDeltaHandler/initSeqID',{fbid:c('CurrentUser').getAccountID(),seqID:c('ChannelInitialData').channelConfig.sequenceId});}f.exports={setUp:h};}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;(n.global_actions||[]).forEach(function(x){if(x.action_type===c('MercuryGlobalActionType').MARK_ALL_SEEN)this.$MercuryUnseenState15(x.timestamp,[]);}.bind(p));if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y],aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){if(!c('MercuryThreadInfo').isMuted(fa)&&!(fa&&fa.last_read_timestamp>=z.timestamp))t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('OmniMActions',['MessengerFluxReduceDispatcher','keyMirror','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({BAR_DISMISSED:null,BAR_DISPLAYED:null,BAR_DISAPPEARED:null,BAR_TIMED_OUT:null,MERCURY_DISPATCHED:null,FETCH_SUGGESTIONS:null,PREFS_UPDATED:null,SUGGESTION_CLICKED:null,SUGGESTION_COMPLETED:null,SUGGESTION_DISMISSED:null,SUGGESTION_DISPLAYED:null,SUGGESTION_DISAPPEARED:null,SUGGESTION_MODE_SET:null,SUGGESTIONS_DISMISSED_FOR_THREAD:null}),i='omnim',j={Types:h,Namespace:i,mercuryDispatched:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.MERCURY_DISPATCHED,namespace:i,mercuryType:l,data:m});},messageFetched:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.FETCH_SUGGESTIONS,namespace:i,threadID:l,message:m});});},suggestionClicked:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_CLICKED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionCompleted:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_COMPLETED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionDismissed:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISMISSED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionsDismissedForThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTIONS_DISMISSED_FOR_THREAD,namespace:i,threadID:l});},suggestionDisplayed:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISPLAYED,namespace:i,option:l,position:m});});},suggestionDisappeared:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISAPPEARED,namespace:i,option:l,position:m});});},prefsUpdated:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREFS_UPDATED,namespace:i,prefs:l});},suggestionModeSet:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_MODE_SET,namespace:i,mode:l});},barDismissed:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISMISSED,namespace:i,options:l});},barDisplayed:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISPLAYED,namespace:i,options:l});});},barDisappeared:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISAPPEARED,namespace:i,options:l});});},barTimedOut:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_TIMED_OUT,namespace:i,options:m,threadID:l});});}};f.exports=j;}),null);
__d('OmniMHelpers',['MercuryConfig'],(function a(b,c,d,e,f,g){function h(i){if(!c('MercuryConfig').OmniMEditConfidenceThreshold)return 0;if(i&&i.has('suggestion_mode')){var j=i.get('suggestion_mode');return j!==null&&j!==undefined?j:1;}return 3;}f.exports={suggestionMode:h};}),null);
__d('MNOmniMConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({OMNIM:null,QUICKREPLIES:null});f.exports=babelHelpers['extends']({},h,{SUGGESTION_MODES:['conservative','balanced','aggressive','muted']});}),null);
__d("OmniMActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CREATE_EVENT:1,LOCATION:2,PAYMENT:3,POLL:4,STICKER:5,TEXT:6,TRANSPORTATION:7,ORDER_FOOD:8,MAKE_RESERVATION:9,SCHEDULE_CALL:10,LIVE_LOCATION:11,VIDEO_CALL:12,VOICE_CALL:13,SAVE_CONTENT:14,PLAY_GAME:15,SHARE_CONTACT:16,SEND_PHOTO:17,CREATE_REMINDER_DEPRECATED:18,CREATE_REMINDER:19,MARKETPLACE_SAFE_LOCATION:20,VIEW_SAVED:21,CHAT_EXTENSION:22,DAY_CAMERA:23,CALENDAR:24,GIF:25});}),null);
__d("OmniMDirectiveType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ADD_ACTIONS:1,CLEAR_ACTIONS:2,ADD_RANGES:3,INVOKE_NATIVE_AGENT:4,MUTATE_FLOW_STATE:5});}),null);
__d("OmniMLoggerEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({MESSAGE_ANALYZED:"omni_m_message_analyzed",INTENT_DETECTED:"omni_m_intent_detected",INTENT_HANDLED:"omni_m_intent_handled",SUGGESTION_GENERATED:"omni_m_suggestion_generated",SUGGESTIONS_FILTERED:"omni_m_suggestions_filtered",SUGGESTION_SENT:"omni_m_suggestion_sent",SUGGESTION_DISPLAYED:"omni_m_suggestion_displayed",SUGGESTION_CLICKED:"omni_m_suggestion_clicked",SUGGESTION_COMPLETED:"omni_m_suggestion_completed",SUGGESTION_DISMISSED:"omni_m_suggestion_dismissed",SUGGESTION_DISAPPEARED:"omni_m_suggestion_disappeared",BAR_DISMISSED:"omni_m_bar_dismissed",BAR_DISPLAYED:"omni_m_bar_displayed",BAR_DISAPPEARED:"omni_m_bar_disappeared",ORGANIC_CLICKED:"omni_m_organic_clicked",ORGANIC_COMPLETED:"omni_m_organic_completed",SETTINGS_ON:"omni_m_setting_turned_on",SETTINGS_OFF:"omni_m_setting_turned_off"});}),null);
__d('OmniMLogHelpers',['OmniMEventTypedLogger','MNOmniMConstants','OmniMLoggerEvents','CurrentUser'],(function a(b,c,d,e,f,g){function h(s){return c('MNOmniMConstants').SUGGESTION_MODES[s];}function i(s,t,u,v){new (c('OmniMEventTypedLogger'))().setEventName(s).setPosition(u+'').setMessageID(t.messageID).setPigeonID(t.suggestionID).setSuggestionMode(h(v)).setContextUserID(c('CurrentUser').getID()).setConfidence(Math.round(t.confidence*10000)).log();}function j(s,t,u){new (c('OmniMEventTypedLogger'))().setEventName(s).setSuggestionMode(h(u)).setContextUserID(c('CurrentUser').getID()).setSuggestionIds(t.map(function(v){return v.suggestionID;})).log();}function k(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISPLAYED,s,t,u);}function l(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISAPPEARED,s,t,u);}function m(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISMISSED,s,t,u);}function n(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_CLICKED,s,t,u);}function o(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_COMPLETED,s,t,u);}function p(s,t){j(c('OmniMLoggerEvents').BAR_DISAPPEARED,s,t);}function q(s,t){j(c('OmniMLoggerEvents').BAR_DISMISSED,s,t);}function r(s,t){j(c('OmniMLoggerEvents').BAR_DISPLAYED,s,t);}f.exports={barDisappeared:p,barDisplayed:r,barDismissed:q,suggestionDisplayed:k,suggestionDisappeared:l,suggestionDismissed:m,suggestionClicked:n,suggestionCompleted:o};}),null);
__d("XMessagingOmniMSetPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_omnim_prefs\/",{});}),null);
__d('OmniMReducer',['AsyncRequest','immutable','MercuryActionType','MercuryConfig','MercuryIDs','MercuryPayloadSource','MNOmniMConstants','OmniMActions','OmniMActionType','OmniMDirectiveType','OmniMLogHelpers','P2PGKValues','XMessagingOmniMSetPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i=c('OmniMActions').Types,j=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').REPLACE_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),k=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),l=2;function m(oa,pa){switch(oa.content_type){case 'text':return true;case 'location':if(pa===c('MNOmniMConstants').OMNIM)return c('MercuryConfig').OmniMLocationSuggestion;return true;case 'sticker':return c('MercuryConfig').MessengerStickerQuickReply;case 'ride_service':return c('MercuryConfig').MessengerRideServiceQuickReply;case 'p2p_payment':return c('P2PGKValues').P2PVisible&&c('MercuryConfig').MessengerP2PPaymentQuickReply;default:return false;}}function n(oa){return Array.isArray(oa);}function o(oa){if(!oa)return {};var pa=JSON.parse(oa)||{},qa=n(pa.quick_replies)?pa.quick_replies:[],ra=pa.m_directives;return {quickReplies:qa,directives:ra};}function p(oa){var pa=oa.other_user_fbid,qa=oa.thread_fbid;return pa?c('MercuryIDs').getThreadIDFromUserID(pa):c('MercuryIDs').getThreadIDFromThreadFBID(qa);}var q=c('immutable').Map((h={},h[c('OmniMActionType').CREATE_EVENT]='create_event',h[c('OmniMActionType').LOCATION]='location',h[c('OmniMActionType').PAYMENT]='p2p_payment',h[c('OmniMActionType').POLL]='poll',h[c('OmniMActionType').STICKER]='sticker',h[c('OmniMActionType').TEXT]='text',h[c('OmniMActionType').TRANSPORTATION]='ride_service',h[c('OmniMActionType').ORDER_FOOD]='order_food',h[c('OmniMActionType').MAKE_RESERVATION]='make_reservation',h[c('OmniMActionType').SCHEDULE_CALL]='schedule_call',h[c('OmniMActionType').LIVE_LOCATION]='live_location',h));function r(oa){var pa=oa.confidence,qa=oa.id,ra=oa.label,sa=oa.type,ta=oa.data,ua=oa.icon,va=oa.message_id,wa=oa.thread_key;return {content_type:q.get(sa+''),data:ta,image_url:ua,title:ra,confidence:pa,messageID:va,suggestionID:qa,threadID:p(wa),messageDepth:1};}function s(oa,pa){var qa=o(pa),ra=(qa.quickReplies||[]).filter(function(ta){return m(ta,c('MNOmniMConstants').QUICKREPLIES);}),sa=(qa.directives||[]).filter(function(ta){return ta.type===c('OmniMDirectiveType').ADD_ACTIONS;}).map(function(ta){return ta.data.actions;}).reduce(function(ta,ua){return ta.concat(ua);},[]).map(r).filter(function(ta){return m(ta,c('MNOmniMConstants').OMNIM);}).reduce(function(ta,ua){var va=ua.threadID;return ta.updateIn([va,'agentSuggestions'],[],function(wa){return wa.concat([ua]);});},c('immutable').Map({}));return sa.setIn([oa,'quickReplies'],ra);}function t(oa){var pa=oa.content_type;Object.keys(oa.data||{}).sort().map(function(qa){pa+=''+qa+oa.data[qa];});return pa;}function u(oa){var pa=c('immutable').Set(),qa=[];for(var ra=oa.length-1;ra>=0;ra--){var sa=oa[ra],ta=t(sa);if(!pa.has(ta)){pa=pa.add(ta);qa.unshift(sa);}}return qa;}function v(oa){var pa=0;return oa.filter(function(qa){if(qa.content_type==='sticker'){if(pa>=l)return false;pa+=1;}return true;});}function w(oa,pa,qa,ra){var sa=oa.getIn(['threadMetadata',pa,'timestamp']);if(sa&&sa>ra)return oa;var ta=qa.agentSuggestions,ua=qa.quickReplies,va=(oa.getIn(['suggestionsByThread',pa])||{}).agentSuggestions||[],wa=ta||[];if(va.length)wa=v(wa);var xa=u(wa.concat(va));return oa.setIn(['threadMetadata',pa,'timestamp'],ra).setIn(['suggestionsByThread',pa],{agentSuggestions:xa,quickReplies:ua});}function x(oa,pa,qa,ra,sa){var ta=s(pa,ra);return ta.reduce(function(ua,va,wa){return w(ua,wa,va.toJS(),sa);},oa);}function y(oa){if(!oa)return null;var pa=oa.agentSuggestions,qa=(pa||[]).reduce(function(ra,sa){if(sa.messageDepth>=c('MercuryConfig').OmniMMessagesToLive)return ra;return ra.concat([babelHelpers['extends']({},sa,{messageDepth:sa.messageDepth+1})]);},[]);return babelHelpers['extends']({},oa,{agentSuggestions:qa});}function z(oa,pa){var qa=pa.thread_id,ra=pa.message_id,sa=pa.platform_xmd,ta=pa.timestamp;if(k.has(pa.action_type))oa=oa.updateIn(['suggestionsByThread',qa],y);return x(oa,qa,ra,sa,ta);}function aa(oa,pa){if(pa.type!==i.MERCURY_DISPATCHED)return oa;var qa=pa.data;switch(pa.mercuryType){case 'update-messages':if(qa.payload_source!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)return oa;return qa.actions.filter(function(ra){return j.has(ra.action_type);}).reduce(z,oa);case 'invalidate-thread-state':return oa.deleteIn(['suggestionsByThread',qa.threadID]).deleteIn(['threadMetadata',qa.threadID]);case 'invalidate-global-state':return oa.set('suggestionsByThread',c('immutable').Map()).set('threadMetadata',c('immutable').Map());}return oa;}function ba(oa,pa){if(pa.type!==i.FETCH_SUGGESTIONS)return oa;var qa=pa.message,ra=pa.threadID;return x(oa,ra,qa.message_id,qa.platform_xmd,qa.timestamp);}function ca(oa){return oa.getIn(['prefs','suggestion_mode'],0);}function da(oa,pa){if(pa.type!==i.SUGGESTION_CLICKED)return oa;var qa=pa.option,ra=pa.position,sa=pa.source;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionClicked(qa,ra,ca(oa));return oa;}function ea(oa,pa){if(pa.type!==i.SUGGESTION_COMPLETED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.position,ta=pa.source;if(ta===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionCompleted(ra,sa,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function fa(oa,pa){if(pa.type!==i.SUGGESTION_DISMISSED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.source,ta=pa.position;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionDismissed(ra,ta,ca(oa));var ua=oa.getIn(['suggestionsByThread',qa]);if(!ua||!ua.agentSuggestions)return oa;var va=ua.agentSuggestions.map(function(wa){if(wa.suggestionID===ra.suggestionID)return babelHelpers['extends']({},wa,{dismissed:true});return wa;});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ua,{agentSuggestions:va}));}function ga(oa,pa){if(pa.type!==i.SUGGESTIONS_DISMISSED_FOR_THREAD)return oa;var qa=pa.threadID,ra=oa.getIn(['suggestionsByThread',qa]);if(!ra||!ra.agentSuggestions)return oa;c('OmniMLogHelpers').barDismissed(ra.agentSuggestions,ca(oa));var sa=ra.agentSuggestions.map(function(ta,ua){if(ta.dismissed)return ta;c('OmniMLogHelpers').suggestionDismissed(ta,ua,ca(oa));return babelHelpers['extends']({},ta,{dismissed:true});});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ra,{agentSuggestions:sa}));}function ha(oa,pa){if(pa.type!==i.PREFS_UPDATED)return oa;var qa=pa.prefs;return oa.updateIn(['prefs'],function(ra){return ra.merge(c('immutable').fromJS(qa));});}function ia(oa,pa){if(pa.type!==i.SUGGESTION_MODE_SET)return oa;var qa=pa.mode,ra=c('XMessagingOmniMSetPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(ra).setMethod('POST').setData({suggestion_mode:qa}).send();return oa.setIn(['prefs','suggestion_mode'],qa);}function ja(oa,pa){if(pa.type!==i.SUGGESTION_DISPLAYED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisplayed(qa,ra,ca(oa));return oa;}function ka(oa,pa){if(pa.type!==i.SUGGESTION_DISAPPEARED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisappeared(qa,ra,ca(oa));return oa;}function la(oa,pa){if(pa.type!==i.BAR_TIMED_OUT)return oa;var qa=pa.threadID,ra=pa.options;c('OmniMLogHelpers').barDisappeared(ra,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function ma(oa,pa){if(pa.type!==i.BAR_DISAPPEARED)return oa;c('OmniMLogHelpers').barDisappeared(pa.options,ca(oa));return oa;}function na(oa,pa){if(pa.type!==i.BAR_DISPLAYED)return oa;c('OmniMLogHelpers').barDisplayed(pa.options,ca(oa));return oa;}f.exports={barDisappeared:ma,barDisplayed:na,barTimedOut:la,mercuryDispatch:aa,messageFetched:ba,prefsUpdated:ha,suggestionClicked:da,suggestionCompleted:ea,suggestionDisappeared:ka,suggestionDismissed:fa,suggestionDisplayed:ja,suggestionModeSet:ia,suggestionsDismissedForThread:ga};}),null);
__d('OmniMState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={suggestionsByThread:c('immutable').Map(),threadMetadata:c('immutable').Map(),prefs:c('immutable').Map()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d("XMessagingOmniMPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/get_omnim_prefs\/",{});}),null);
__d('OmniMStore',['AsyncRequest','FluxReduceStore','MercuryConfig','MercuryDispatcher','MercuryMessages','MessengerFluxReduceDispatcher','OmniMHelpers','OmniMReducer','OmniMState','OmniMActions','XMessagingOmniMPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=5,k=[].concat(Object.values(c('OmniMReducer')));h=babelHelpers.inherits(l,c('FluxReduceStore'));i=h&&h.prototype;l.prototype.getInitialState=function(){return new (c('OmniMState'))();};l.prototype.reduce=function(m,n){if(n.namespace!==c('OmniMActions').Namespace)return m;return k.reduce(function(o,p){return p(o,n);},m);};l.prototype.$OmniMStore1=function(m){c('MercuryMessages').get().getThreadMessagesRange(m,0,1,function(n){if(n&&n.length){var o=n[0];c('OmniMActions').messageFetched(m,o);}});};l.prototype.$OmniMStore2=function(){var m=this.getState().get('prefs'),n=c('OmniMHelpers').suggestionMode(m),o=c('MercuryConfig').OmniMConfidenceThresholds[n];return o||.9;};l.prototype.$OmniMStore3=function(m){var n=this.$OmniMStore2();return (m||[]).filter(function(o){return o.confidence&&o.confidence>n;});};l.prototype.suggestionsForThread=function(m){var n=this.getState();if(!n.getIn(['threadMetadata',m]))this.$OmniMStore1(m);var o=n.getIn(['suggestionsByThread',m],{}),p=this.$OmniMStore3(o.agentSuggestions).slice(0,j);return babelHelpers['extends']({},o,{agentSuggestions:p});};l.prototype.prefs=function(){return this.getState().get('prefs');};l.prototype.$OmniMStore4=function(){var m=c('MercuryDispatcher').get();m.subscribe('update-messages',function(n,o){c('OmniMActions').mercuryDispatched(n,o);});m.subscribe('invalidate-thread-state',function(n,o){c('OmniMActions').mercuryDispatched(n,{threadID:o});});m.subscribe('invalidate-global-state',function(n){return c('OmniMActions').mercuryDispatched(n);});};l.prototype.$OmniMStore5=function(){if(c('MercuryConfig').OmniMEditConfidenceThreshold){var m=c('XMessagingOmniMPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(m).setAllowCrossPageTransition(true).setReadOnly(true).setMethod('POST').setHandler(function(n){return c('OmniMActions').prefsUpdated(n.payload);}).send();}};l.prototype.setUp=function(){this.$OmniMStore4();this.$OmniMStore5();};function l(){h.apply(this,arguments);}f.exports=new l(c('MessengerFluxReduceDispatcher'));}),null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','Map','P2PDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=36,k=void 0,l=void 0;h=babelHelpers.inherits(m,c('EventEmitter'));i=h&&h.prototype;function m(){i.constructor.call(this);l=new (c('Map'))();k=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}m.prototype.onEventDispatched=function(n){var o=n.data,p=n.type;switch(p){case c('P2PActionConstants').CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(o);this.emit('change');break;case c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(o);this.emit('change');break;}};m.prototype.getStateByThreadID=function(n){return l.get(n);};m.prototype.handleChatSendViewOpened=function(n){l.set(n.threadID,{amount:n.amount,groupSendRecipientUserIDs:n.groupSendRecipientUserIDs,groupSendReceiptDetails:n.groupSendReceiptDetails,groupThreadFBID:n.groupThreadFBID,onCompletion:n.onCompletion,openRequestTab:n.openRequestTab,memoText:n.memoText&&n.memoText.substr(0,j),platformData:n.platformData,referrer:n.referrer,paymentRequestID:n.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:n.sendMoneyNUXDismissed,useModal:n.useModal});};m.prototype.handleChatSendViewClosed=function(n){l.set(n.threadID,{amount:'',groupSendRecipientUserIDs:[],groupSendReceiptDetails:null,groupThreadFBID:'',onCompletion:null,openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false});};m.prototype.isAnyChatSendViewOpen=function(){for(var n=l.values(),o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.sendMoneyDialogShown)return true;}return false;};f.exports=new m();}),null);
__d('FantaTabsAppBase',['ChatAppActions','ChatAppStore','ChatPerfInstrumentation','CSS','JSLogger','Map'],(function a(b,c,d,e,f,g){'use strict';h.prototype.init=function(i,j,k){if(this.isInitialized()){c('JSLogger').create('chat_app').error('repeated_init');return;}this.$FantaTabsAppBase1=i;this.tabsElem=j;var l=c('ChatAppStore').addListener(function(){var m=c('ChatAppStore').getPreviousState(),n=c('ChatAppStore').getState();if(m.initialDisplayDone===false&&n.initialDisplayDone===true){c('ChatPerfInstrumentation').logDisplayDone();l.remove();}});c('ChatPerfInstrumentation').init();this.$FantaTabsAppBase2(k.initial_data);this.initializeFantaData(k.interstitial_data);this.initializeFantaUI();this.$FantaTabsAppBase3();c('ChatAppActions').tti();c('ChatPerfInstrumentation').logTTI();};h.prototype.isInitialized=function(){return !!c('ChatAppStore').getState().isInitialized;};h.prototype.isHidden=function(){var i=c('ChatAppStore').getState();return !!(!i.isInitialized||i.isHidden);};h.prototype.hide=function(){if(this.isHidden())return;c('CSS').hide(this.$FantaTabsAppBase1);c('ChatAppActions').hide();};h.prototype.unhide=function(){var i=c('ChatAppStore').getState();if(i.isInitialized){if(i.isHidden){c('CSS').show(this.$FantaTabsAppBase1);e(['Dock'],function(j){j.resizeAllFlyouts();});c('ChatAppActions').unhide();}}else if(!i.isLoaded){e(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});c('ChatAppActions').load();}};h.prototype.initializeFantaData=function(i){};h.prototype.initializeFantaUI=function(){};h.prototype.$FantaTabsAppBase2=function(i){e(['mercuryBlockedParticipantsRe','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryServerPayloadPreprocessor','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncEnvironment','P2PSendMoneyDialogStore','OmniMStore'],function(j,k,l,m,n,o,p,q,r,s,t,u){j.get();k.get();l.get();m.get();n;p.get();r.get();q.get();s.setUp();u.setUp();c('ChatPerfInstrumentation').logInitStores();o.get().handleUpdate(i);});};h.prototype.$FantaTabsAppBase3=function(){e(['HotLikeSound','ChatOptions'],function(i,j){i.setCheckSoundEnabledFunc(function(){return j.getSetting('sound');});c('ChatPerfInstrumentation').logInitSound();});};function h(){}f.exports=h;}),null);
__d('FBRTCMessageHandler',['invariant','Bootloader','FBRTCMessageListener','FBRTCSupport'],(function a(b,c,d,e,f,g,h){var i=null,j=false,k=null,l={init:function o(){if(!j&&c('FBRTCSupport').isReceiveWebrtcSupported()){j=true;c('FBRTCMessageListener').init(false);c('FBRTCMessageListener').once('messageReceived',function(p){m();});c('FBRTCMessageListener').once('multiwayMessageReceived',function(p){n(p);});}},resetListener:function o(){i||h(0);c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);}};function m(){if(!i)c('Bootloader').loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(o,p,q,r){i=new o(p,r,new q());c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);},'FBRTCMessageHandler');}function n(o){if(!k)c('Bootloader').loadModules(["FBRTCGroupCallIncomingController","FBRTCGroupCallIncomingDialog"],function(p,q){k=new p(q);c('FBRTCMessageListener').setMultiwayMessageHandler(k.onMessageReceived,k);k.onMessageReceived(o);},'FBRTCMessageHandler');}f.exports=l;}),null);